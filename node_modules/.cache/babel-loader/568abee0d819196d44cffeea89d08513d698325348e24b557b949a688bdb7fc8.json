{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, renderSlot as _renderSlot, mergeProps as _mergeProps } from \"vue\";\nconst _hoisted_1 = {\n  class: \"enhanced-datatable\"\n};\nconst _hoisted_2 = {\n  class: \"table-controls mb-3\"\n};\nconst _hoisted_3 = {\n  class: \"search-box\"\n};\nconst _hoisted_4 = {\n  class: \"control-buttons\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"advanced-search mb-3\"\n};\nconst _hoisted_6 = {\n  class: \"filter-actions\"\n};\nconst _hoisted_7 = {\n  class: \"logic-toggle\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_InputIcon = _resolveComponent(\"InputIcon\");\n  const _component_InputText = _resolveComponent(\"InputText\");\n  const _component_IconField = _resolveComponent(\"IconField\");\n  const _component_Button = _resolveComponent(\"Button\");\n  const _component_Dropdown = _resolveComponent(\"Dropdown\");\n  const _component_DataTable = _resolveComponent(\"DataTable\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Search and Column Controls \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_IconField, {\n    iconPosition: \"left\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_InputIcon, {\n      class: \"pi pi-search\"\n    }), _createVNode(_component_InputText, {\n      modelValue: $setup.localSearch,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.localSearch = $event),\n      placeholder: \"ค้นหาทั่วไป...\",\n      class: \"w-full\"\n    }, null, 8 /* PROPS */, [\"modelValue\"])]),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_Button, {\n    icon: $setup.advancedMode ? 'pi pi-times' : 'pi pi-filter',\n    label: $setup.advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง',\n    onClick: _cache[1] || (_cache[1] = $event => $setup.advancedMode = !$setup.advancedMode),\n    text: \"\",\n    severity: $setup.advancedMode ? 'danger' : 'info'\n  }, null, 8 /* PROPS */, [\"icon\", \"label\", \"severity\"])])]), _createCommentVNode(\" Advanced Search Filters \"), $setup.advancedMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.filters, (filter, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"filter-row\"\n    }, [_createVNode(_component_Dropdown, {\n      modelValue: filter.column,\n      \"onUpdate:modelValue\": $event => filter.column = $event,\n      options: $setup.searchableColumns,\n      optionLabel: \"header\",\n      optionValue: \"field\",\n      placeholder: \"เลือก Column\",\n      class: \"filter-column\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\", \"options\"]), _createVNode(_component_Dropdown, {\n      modelValue: filter.operator,\n      \"onUpdate:modelValue\": $event => filter.operator = $event,\n      options: $setup.operators,\n      optionLabel: \"label\",\n      optionValue: \"value\",\n      placeholder: \"เงื่อนไข\",\n      class: \"filter-operator\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), _createVNode(_component_InputText, {\n      modelValue: filter.value,\n      \"onUpdate:modelValue\": $event => filter.value = $event,\n      placeholder: \"ค่าที่ค้นหา\",\n      class: \"filter-value\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), _createVNode(_component_Button, {\n      icon: \"pi pi-times\",\n      severity: \"danger\",\n      text: \"\",\n      onClick: $event => $setup.removeFilter(index),\n      disabled: $setup.filters.length === 1\n    }, null, 8 /* PROPS */, [\"onClick\", \"disabled\"])]);\n  }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createVNode(_component_Button, {\n    label: 'AND',\n    severity: $setup.filterLogic === 'AND' ? 'primary' : 'secondary',\n    onClick: _cache[2] || (_cache[2] = $event => $setup.filterLogic = 'AND'),\n    size: \"small\"\n  }, null, 8 /* PROPS */, [\"severity\"]), _createVNode(_component_Button, {\n    label: 'OR',\n    severity: $setup.filterLogic === 'OR' ? 'primary' : 'secondary',\n    onClick: _cache[3] || (_cache[3] = $event => $setup.filterLogic = 'OR'),\n    size: \"small\"\n  }, null, 8 /* PROPS */, [\"severity\"])]), _createVNode(_component_Button, {\n    label: \"เพิ่มเงื่อนไข\",\n    icon: \"pi pi-plus\",\n    onClick: $setup.addFilter,\n    text: \"\",\n    size: \"small\"\n  }), _createVNode(_component_Button, {\n    label: \"ล้าง\",\n    icon: \"pi pi-refresh\",\n    onClick: $setup.resetFilters,\n    text: \"\",\n    size: \"small\",\n    severity: \"secondary\"\n  })])])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Pass through DataTable with filtered data \"), _createVNode(_component_DataTable, _mergeProps({\n    value: $setup.filteredData\n  }, _ctx.$attrs), {\n    default: _withCtx(() => [_renderSlot(_ctx.$slots, \"default\", {}, undefined, true)]),\n    _: 3 /* FORWARDED */\n  }, 16 /* FULL_PROPS */, [\"value\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_IconField","iconPosition","_component_InputIcon","_component_InputText","$setup","localSearch","$event","placeholder","_hoisted_4","_component_Button","icon","advancedMode","label","onClick","_cache","text","severity","_hoisted_5","_Fragment","_renderList","filters","filter","index","key","_component_Dropdown","column","options","searchableColumns","optionLabel","optionValue","operator","operators","value","removeFilter","disabled","length","_hoisted_6","_hoisted_7","filterLogic","size","addFilter","resetFilters","_component_DataTable","_mergeProps","filteredData","_ctx","$attrs","_renderSlot","$slots","undefined"],"sources":["D:\\frontend_cem\\src\\components\\EnhancedDataTable.vue"],"sourcesContent":["<template>\n  <div class=\"enhanced-datatable\">\n    <!-- Search and Column Controls -->\n    <div class=\"table-controls mb-3\">\n      <div class=\"search-box\">\n        <IconField iconPosition=\"left\">\n          <InputIcon class=\"pi pi-search\" />\n          <InputText v-model=\"localSearch\" placeholder=\"ค้นหาทั่วไป...\" class=\"w-full\" />\n        </IconField>\n      </div>\n      <div class=\"control-buttons\">\n        <Button \n          :icon=\"advancedMode ? 'pi pi-times' : 'pi pi-filter'\" \n          :label=\"advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง'\" \n          @click=\"advancedMode = !advancedMode\" \n          text \n          :severity=\"advancedMode ? 'danger' : 'info'\" \n        />\n      </div>\n    </div>\n\n    <!-- Advanced Search Filters -->\n    <div v-if=\"advancedMode\" class=\"advanced-search mb-3\">\n      <div v-for=\"(filter, index) in filters\" :key=\"index\" class=\"filter-row\">\n        <Dropdown \n          v-model=\"filter.column\" \n          :options=\"searchableColumns\" \n          optionLabel=\"header\" \n          optionValue=\"field\" \n          placeholder=\"เลือก Column\" \n          class=\"filter-column\" \n        />\n        <Dropdown \n          v-model=\"filter.operator\" \n          :options=\"operators\" \n          optionLabel=\"label\" \n          optionValue=\"value\" \n          placeholder=\"เงื่อนไข\" \n          class=\"filter-operator\" \n        />\n        <InputText \n          v-model=\"filter.value\" \n          placeholder=\"ค่าที่ค้นหา\" \n          class=\"filter-value\" \n        />\n        <Button \n          icon=\"pi pi-times\" \n          severity=\"danger\" \n          text \n          @click=\"removeFilter(index)\" \n          :disabled=\"filters.length === 1\" \n        />\n      </div>\n      <div class=\"filter-actions\">\n        <div class=\"logic-toggle\">\n          <Button :label=\"'AND'\" :severity=\"filterLogic === 'AND' ? 'primary' : 'secondary'\" \n            @click=\"filterLogic = 'AND'\" size=\"small\" />\n          <Button :label=\"'OR'\" :severity=\"filterLogic === 'OR' ? 'primary' : 'secondary'\" \n            @click=\"filterLogic = 'OR'\" size=\"small\" />\n        </div>\n        <Button label=\"เพิ่มเงื่อนไข\" icon=\"pi pi-plus\" @click=\"addFilter\" text size=\"small\" />\n        <Button label=\"ล้าง\" icon=\"pi pi-refresh\" @click=\"resetFilters\" text size=\"small\" severity=\"secondary\" />\n      </div>\n    </div>\n\n    <!-- Pass through DataTable with filtered data -->\n    <DataTable \n      :value=\"filteredData\" \n      v-bind=\"$attrs\"\n    >\n      <slot />\n    </DataTable>\n  </div>\n</template>\n\n<script setup>\n/* eslint-disable no-undef */\nimport { ref, computed, useSlots } from 'vue'\n\nconst props = defineProps({\n  data: {\n    type: Array,\n    default: () => []\n  },\n  value: {\n    type: Array,\n    default: () => []\n  },\n  columns: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst slots = useSlots()\n\nconst localSearch = ref('')\nconst advancedMode = ref(false)\nconst filterLogic = ref('AND') // AND or OR\nconst filters = ref([\n  { column: '', operator: 'contains', value: '' }\n])\n\nconst operators = [\n  { label: 'มีคำว่า', value: 'contains' },\n  { label: 'เท่ากับ', value: 'equals' },\n  { label: 'ไม่เท่ากับ', value: 'notEquals' },\n  { label: 'เริ่มต้นด้วย', value: 'startsWith' },\n  { label: 'ลงท้ายด้วย', value: 'endsWith' },\n  { label: 'มากกว่า', value: 'greaterThan' },\n  { label: 'น้อยกว่า', value: 'lessThan' }\n]\n\n// Get actual data (support both data and value props)\nconst tableData = computed(() => {\n  return props.data?.length ? props.data : (props.value || [])\n})\n\n// Normalize text for search\nconst normalizeText = (text) => {\n  if (!text) return ''\n  return String(text).toLowerCase().trim()\n}\n\n// Deep search in nested objects and arrays\nconst deepSearch = (obj, query) => {\n  if (obj === null || obj === undefined) return false\n  \n  // String or number - direct match\n  if (typeof obj === 'string' || typeof obj === 'number') {\n    return normalizeText(obj).includes(query)\n  }\n  \n  // Array - search each element\n  if (Array.isArray(obj)) {\n    return obj.some(item => deepSearch(item, query))\n  }\n  \n  // Object - search all values\n  if (typeof obj === 'object') {\n    return Object.values(obj).some(value => deepSearch(value, query))\n  }\n  \n  return false\n}\n\n// Get searchable columns from props or slots\nconst searchableColumns = computed(() => {\n  if (props.columns && props.columns.length > 0) {\n    return props.columns.filter(col => col.field)\n  }\n  \n  // Extract from slot children\n  const defaultSlot = slots.default?.()\n  if (defaultSlot) {\n    return defaultSlot\n      .filter(vnode => vnode.props?.field)\n      .map(vnode => ({\n        field: vnode.props.field,\n        header: vnode.props.header || vnode.props.field\n      }))\n  }\n  \n  // Auto-detect from first data item\n  if (tableData.value.length > 0) {\n    return Object.keys(tableData.value[0]).map(key => ({\n      field: key,\n      header: key\n    }))\n  }\n  \n  return []\n})\n\n// Get nested value by path (e.g., \"borrowRecord.name\")\nconst getNestedValue = (obj, path) => {\n  return path.split('.').reduce((acc, part) => acc?.[part], obj)\n}\n\n// Apply single filter\nconst applyFilter = (item, filter) => {\n  const fieldValue = normalizeText(getNestedValue(item, filter.column))\n  const searchValue = normalizeText(filter.value)\n\n  switch (filter.operator) {\n    case 'contains':\n      return fieldValue.includes(searchValue)\n    case 'equals':\n      return fieldValue === searchValue\n    case 'notEquals':\n      return fieldValue !== searchValue\n    case 'startsWith':\n      return fieldValue.startsWith(searchValue)\n    case 'endsWith':\n      return fieldValue.endsWith(searchValue)\n    case 'greaterThan':\n      return parseFloat(fieldValue) > parseFloat(searchValue)\n    case 'lessThan':\n      return parseFloat(fieldValue) < parseFloat(searchValue)\n    default:\n      return true\n  }\n}\n\n// Filter data based on search mode\nconst filteredData = computed(() => {\n  let result = tableData.value\n  \n  if (!result || !Array.isArray(result)) return []\n\n  // Advanced mode: column-specific filters with AND/OR\n  if (advancedMode.value) {\n    const validFilters = filters.value.filter(f => f.column && f.value)\n    \n    if (validFilters.length > 0) {\n      result = result.filter(item => {\n        if (filterLogic.value === 'OR') {\n          return validFilters.some(filter => applyFilter(item, filter))\n        }\n        return validFilters.every(filter => applyFilter(item, filter))\n      })\n    }\n  } \n  // Simple mode: global search with deep search\n  else if (localSearch.value) {\n    const query = normalizeText(localSearch.value)\n    result = result.filter(record => deepSearch(record, query))\n  }\n\n  return result\n})\n\nconst addFilter = () => {\n  filters.value.push({ column: '', operator: 'contains', value: '' })\n}\n\nconst removeFilter = (index) => {\n  if (filters.value.length > 1) {\n    filters.value.splice(index, 1)\n  }\n}\n\nconst resetFilters = () => {\n  filters.value = [{ column: '', operator: 'contains', value: '' }]\n}\n</script>\n\n<style scoped>\n.table-controls {\n  display: flex;\n  gap: 1rem;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  align-items: center;\n}\n\n.search-box {\n  flex: 1;\n  min-width: 250px;\n}\n\n.column-options {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  min-width: 200px;\n  max-height: 400px;\n  overflow-y: auto;\n}\n\n.column-option {\n  display: flex;\n  align-items: center;\n}\n\n.column-option label {\n  cursor: pointer;\n  user-select: none;\n  font-size: 0.9rem;\n}\n\n.control-buttons {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.advanced-search {\n  background: #f8f9fa;\n  border: 1px solid #dee2e6;\n  border-radius: 8px;\n  padding: 1rem;\n}\n\n.filter-row {\n  display: grid;\n  grid-template-columns: 2fr 1.5fr 2fr auto;\n  gap: 0.5rem;\n  align-items: center;\n  margin-bottom: 0.75rem;\n}\n\n.filter-column,\n.filter-operator,\n.filter-value {\n  width: 100%;\n}\n\n.filter-actions {\n  display: flex;\n  gap: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid #dee2e6;\n  align-items: center;\n}\n\n.logic-toggle {\n  display: flex;\n  gap: 0.25rem;\n  margin-right: 1rem;\n}\n\n@media (max-width: 768px) {\n  .table-controls {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .search-box {\n    width: 100%;\n  }\n  \n  .control-buttons {\n    width: 100%;\n    justify-content: space-between;\n  }\n\n  .filter-row {\n    grid-template-columns: 1fr;\n  }\n\n  .filter-actions {\n    flex-direction: column;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}