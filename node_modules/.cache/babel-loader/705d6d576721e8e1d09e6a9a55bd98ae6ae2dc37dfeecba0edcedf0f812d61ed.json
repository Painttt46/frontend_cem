{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { usePermissions } from '@/composables/usePermissions';\nimport LoginPage from '../views/LoginPage.vue';\nimport TwoFAAuthPage from '../views/TwoFAAuthPage.vue';\nimport ProfileView from '../views/profile/ProfileView.vue';\nimport CarBookingHome from '../views/car_booking/car_booking.vue';\nimport LeaveWork from '../views/leave_work/LeaveWork.vue';\nimport DailyWork from '../views/daily_work/DailyWork.vue';\nimport Projects from '../views/projects/Projects.vue';\nimport ManagementView from '../views/ManagementView.vue';\nimport UserManagement from '../views/management/UserManagement.vue';\nimport TaskManagement from '../views/management/TaskManagement.vue';\nimport ProjectsView from '../views/management/ProjectsView.vue';\nimport DailyWorkManagement from '../views/management/DailyWorkManagement.vue';\nimport SystemSettings from '../views/management/SystemSettings.vue';\nimport RolePermissions from '../views/management/RolePermissions.vue';\nimport LeaveManagement from '../views/management/LeaveManagement.vue';\nconst routes = [{\n  path: '/',\n  name: '',\n  redirect: 'daily_work'\n}, {\n  path: '/login',\n  name: 'login',\n  component: LoginPage,\n  meta: {\n    title: 'ลงชื่อเข้าใช้ - Gent-CEM'\n  }\n}, {\n  path: '/profile',\n  name: 'profile',\n  component: ProfileView,\n  meta: {\n    requiresAuth: true,\n    title: 'โปรไฟล์ - Gent-CEM'\n  }\n}, {\n  path: '/two-authentication',\n  name: 'two-authentication',\n  component: TwoFAAuthPage,\n  meta: {\n    title: 'ยืนยันตัวตน 2 ขั้นตอน - Gent-CEM'\n  }\n}, {\n  path: '/car_booking',\n  name: 'car booking',\n  component: CarBookingHome,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบเเจ้งใช้งานรถ - Gent-CEM'\n  }\n}, {\n  path: '/leave_work',\n  name: 'leave work',\n  component: LeaveWork,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบแจ้งลางาน - Gent-CEM'\n  }\n}, {\n  path: '/daily_work',\n  name: 'daily work',\n  component: DailyWork,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบลงงานรายวัน - Gent-CEM'\n  }\n}, {\n  path: '/projects',\n  name: 'projects-main',\n  component: Projects,\n  meta: {\n    requiresAuth: true,\n    title: 'โครงการ - Gent-CEM'\n  }\n}, {\n  path: '/management',\n  name: 'management',\n  component: ManagementView,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบจัดการ - Gent-CEM'\n  }\n}, {\n  path: '/management/users',\n  name: 'user-management',\n  component: UserManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการผู้ใช้งาน - Gent-CEM'\n  }\n}, {\n  path: '/management/tasks',\n  name: 'task-management',\n  component: TaskManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการงาน - Gent-CEM'\n  }\n}, {\n  path: '/management/projects',\n  name: 'management-projects',\n  component: ProjectsView,\n  meta: {\n    requiresAuth: true,\n    title: 'รายการงาน - Gent-CEM'\n  }\n}, {\n  path: '/management/daily-work',\n  name: 'daily-work-management',\n  component: DailyWorkManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'งานรายวัน - Gent-CEM'\n  }\n}, {\n  path: '/management/settings',\n  name: 'system-settings',\n  component: SystemSettings,\n  meta: {\n    requiresAuth: true,\n    title: 'ตั้งค่าระบบ - Gent-CEM'\n  }\n}, {\n  path: '/management/settings/role-permissions',\n  name: 'role-permissions',\n  component: RolePermissions,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการสิทธิ์การเข้าถึง - Gent-CEM'\n  }\n}, {\n  path: '/management/leave',\n  name: 'leave-management',\n  component: LeaveManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการการลางาน - Gent-CEM'\n  }\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: () => {\n    // Redirect to home for any undefined routes\n    return '/daily_work';\n  }\n}];\nconst router = createRouter({\n  mode: 'history',\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// ✅ Route Guard ตรวจสอบการ Login และสิทธิ์การเข้าถึง\nrouter.beforeEach(async (to, from, next) => {\n  const userId = localStorage.getItem(\"soc_user_id\");\n  const role = localStorage.getItem(\"soc_role\");\n  if (to.meta.requiresAuth) {\n    // ตรวจสอบว่ามี userId (แทนการตรวจสอบ token)\n    if (!userId) {\n      next(\"/login\");\n      return;\n    }\n\n    // Check permissions for protected routes (except profile and login)\n    if (role && to.path !== '/profile' && to.path !== '/login' && to.path !== '/two-authentication') {\n      const {\n        loadPermissions,\n        canAccessRoute,\n        permissionsLoaded\n      } = usePermissions();\n\n      // Load permissions if not loaded yet\n      if (!permissionsLoaded.value) {\n        await loadPermissions();\n      }\n\n      // Check if user has access to this route\n      if (!canAccessRoute(to.path)) {\n        // Redirect back to previous page or home\n        if (from.path && from.path !== to.path) {\n          next(from.path);\n        } else {\n          next(\"/daily_work\");\n        }\n        return;\n      }\n    }\n    next();\n  } else {\n    next();\n  }\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","usePermissions","LoginPage","TwoFAAuthPage","ProfileView","CarBookingHome","LeaveWork","DailyWork","Projects","ManagementView","UserManagement","TaskManagement","ProjectsView","DailyWorkManagement","SystemSettings","RolePermissions","LeaveManagement","routes","path","name","redirect","component","meta","title","requiresAuth","router","mode","history","process","env","BASE_URL","beforeEach","to","from","next","userId","localStorage","getItem","role","loadPermissions","canAccessRoute","permissionsLoaded","value"],"sources":["D:/frontend_cem/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\r\nimport { usePermissions } from '@/composables/usePermissions'\r\n\r\nimport LoginPage from '../views/LoginPage.vue';\r\nimport TwoFAAuthPage from '../views/TwoFAAuthPage.vue';\r\nimport ProfileView from '../views/profile/ProfileView.vue';\r\nimport CarBookingHome from '../views/car_booking/car_booking.vue';\r\nimport LeaveWork from '../views/leave_work/LeaveWork.vue';\r\nimport DailyWork from '../views/daily_work/DailyWork.vue';\r\nimport Projects from '../views/projects/Projects.vue';\r\nimport ManagementView from '../views/ManagementView.vue';\r\nimport UserManagement from '../views/management/UserManagement.vue';\r\nimport TaskManagement from '../views/management/TaskManagement.vue';\r\nimport ProjectsView from '../views/management/ProjectsView.vue';\r\nimport DailyWorkManagement from '../views/management/DailyWorkManagement.vue';\r\nimport SystemSettings from '../views/management/SystemSettings.vue';\r\nimport RolePermissions from '../views/management/RolePermissions.vue';\r\nimport LeaveManagement from '../views/management/LeaveManagement.vue';\r\n\r\nconst routes = [\r\n  {\r\n    path: '/',\r\n    name: '',\r\n    redirect: 'daily_work',\r\n  },\r\n  {\r\n    path: '/login',\r\n    name: 'login',\r\n    component: LoginPage,\r\n    meta: { title: 'ลงชื่อเข้าใช้ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/profile',\r\n    name: 'profile',\r\n    component: ProfileView,\r\n    meta: { requiresAuth: true, title: 'โปรไฟล์ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/two-authentication',\r\n    name: 'two-authentication',\r\n    component: TwoFAAuthPage,\r\n    meta: { title: 'ยืนยันตัวตน 2 ขั้นตอน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/car_booking',\r\n    name: 'car booking',\r\n    component: CarBookingHome,\r\n    meta: { requiresAuth: true, title: 'ระบบเเจ้งใช้งานรถ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/leave_work',\r\n    name: 'leave work',\r\n    component: LeaveWork,\r\n    meta: { requiresAuth: true, title: 'ระบบแจ้งลางาน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/daily_work',\r\n    name: 'daily work',\r\n    component: DailyWork,\r\n    meta: { requiresAuth: true, title: 'ระบบลงงานรายวัน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/projects',\r\n    name: 'projects-main',\r\n    component: Projects,\r\n    meta: { requiresAuth: true, title: 'โครงการ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management',\r\n    name: 'management',\r\n    component: ManagementView,\r\n    meta: { requiresAuth: true, title: 'ระบบจัดการ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/users',\r\n    name: 'user-management',\r\n    component: UserManagement,\r\n    meta: { requiresAuth: true, title: 'จัดการผู้ใช้งาน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/tasks',\r\n    name: 'task-management',\r\n    component: TaskManagement,\r\n    meta: { requiresAuth: true, title: 'จัดการงาน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/projects',\r\n    name: 'management-projects',\r\n    component: ProjectsView,\r\n    meta: { requiresAuth: true, title: 'รายการงาน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/daily-work',\r\n    name: 'daily-work-management',\r\n    component: DailyWorkManagement,\r\n    meta: { requiresAuth: true, title: 'งานรายวัน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/settings',\r\n    name: 'system-settings',\r\n    component: SystemSettings,\r\n    meta: { requiresAuth: true, title: 'ตั้งค่าระบบ - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/settings/role-permissions',\r\n    name: 'role-permissions',\r\n    component: RolePermissions,\r\n    meta: { requiresAuth: true, title: 'จัดการสิทธิ์การเข้าถึง - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/management/leave',\r\n    name: 'leave-management',\r\n    component: LeaveManagement,\r\n    meta: { requiresAuth: true, title: 'จัดการการลางาน - Gent-CEM' },\r\n  },\r\n  {\r\n    path: '/:pathMatch(.*)*',\r\n    redirect: () => {\r\n      // Redirect to home for any undefined routes\r\n      return '/daily_work'\r\n    }\r\n  }\r\n];\r\n\r\nconst router = createRouter({\r\n  mode: 'history',\r\n  history: createWebHistory(process.env.BASE_URL),\r\n  routes\r\n});\r\n\r\n// ✅ Route Guard ตรวจสอบการ Login และสิทธิ์การเข้าถึง\r\nrouter.beforeEach(async (to, from, next) => {\r\n  const userId = localStorage.getItem(\"soc_user_id\");\r\n  const role = localStorage.getItem(\"soc_role\");\r\n\r\n  if (to.meta.requiresAuth) {\r\n    // ตรวจสอบว่ามี userId (แทนการตรวจสอบ token)\r\n    if (!userId) {\r\n      next(\"/login\");\r\n      return;\r\n    }\r\n\r\n    // Check permissions for protected routes (except profile and login)\r\n    if (role && to.path !== '/profile' && to.path !== '/login' && to.path !== '/two-authentication') {\r\n      const { loadPermissions, canAccessRoute, permissionsLoaded } = usePermissions();\r\n      \r\n      // Load permissions if not loaded yet\r\n      if (!permissionsLoaded.value) {\r\n        await loadPermissions();\r\n      }\r\n\r\n      // Check if user has access to this route\r\n      if (!canAccessRoute(to.path)) {\r\n        // Redirect back to previous page or home\r\n        if (from.path && from.path !== to.path) {\r\n          next(from.path);\r\n        } else {\r\n          next(\"/daily_work\");\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n    next();\r\n  } else {\r\n    next();\r\n  }\r\n});\r\n\r\nexport default router;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}