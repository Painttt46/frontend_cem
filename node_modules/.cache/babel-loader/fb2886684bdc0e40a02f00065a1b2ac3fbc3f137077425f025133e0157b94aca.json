{"ast":null,"code":"import axios from '@/utils/axiosConfig';\nimport AutoComplete from 'primevue/autocomplete';\nimport Dropdown from 'primevue/dropdown';\nexport default {\n  name: 'LeaveForm',\n  components: {\n    AutoComplete,\n    Dropdown\n  },\n  async created() {\n    await this.loadLeaveTypes();\n    await this.loadUsers();\n    await this.loadQuotaData();\n    await this.loadHolidays();\n    // Initialize with limited users\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n  },\n  data() {\n    return {\n      formData: {\n        leaveType: '',\n        startDate: null,\n        startTime: null,\n        endDate: null,\n        endTime: null,\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      },\n      allowedTimes: [{\n        label: '09:00',\n        value: '09:00'\n      }, {\n        label: '09:30',\n        value: '09:30'\n      }, {\n        label: '10:00',\n        value: '10:00'\n      }, {\n        label: '10:30',\n        value: '10:30'\n      }, {\n        label: '11:00',\n        value: '11:00'\n      }, {\n        label: '11:30',\n        value: '11:30'\n      }, {\n        label: '12:00',\n        value: '12:00'\n      }, {\n        label: '13:00',\n        value: '13:00'\n      }, {\n        label: '13:30',\n        value: '13:30'\n      }, {\n        label: '14:00',\n        value: '14:00'\n      }, {\n        label: '14:30',\n        value: '14:30'\n      }, {\n        label: '15:00',\n        value: '15:00'\n      }, {\n        label: '15:30',\n        value: '15:30'\n      }, {\n        label: '16:00',\n        value: '16:00'\n      }, {\n        label: '16:30',\n        value: '16:30'\n      }, {\n        label: '17:00',\n        value: '17:00'\n      }, {\n        label: '17:30',\n        value: '17:30'\n      }, {\n        label: '18:00',\n        value: '18:00'\n      }],\n      leaveTypes: [],\n      delegationOptions: [{\n        label: 'ไม่มีการมอบหมายงาน',\n        value: 'no'\n      }, {\n        label: 'มีการมอบหมายงาน',\n        value: 'yes'\n      }],\n      users: [],\n      filteredUsers: [],\n      selectedDelegate: null,\n      maxDisplayUsers: 50,\n      quotaData: {},\n      selectedQuota: null,\n      holidays: []\n    };\n  },\n  watch: {\n    'formData.startDate'() {\n      this.updateStartDateTime();\n    },\n    'formData.endDate'() {\n      this.updateEndDateTime();\n    }\n  },\n  computed: {\n    currentUserName() {\n      const firstName = localStorage.getItem('soc_firstname') || '';\n      const lastName = localStorage.getItem('soc_lastname') || '';\n      return `${firstName} ${lastName}`.trim();\n    },\n    currentUserRole() {\n      return localStorage.getItem('soc_role') || '';\n    },\n    currentUserPosition() {\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง';\n    },\n    selectedLeaveTypeAdvanceDays() {\n      if (!this.formData.leaveType) return 0;\n      const type = this.leaveTypes.find(t => t.value === this.formData.leaveType);\n      return type?.advance_days || 0;\n    },\n    minStartDate() {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const advanceDays = this.selectedLeaveTypeAdvanceDays;\n      if (advanceDays > 0) {\n        today.setDate(today.getDate() + advanceDays);\n      }\n      return today;\n    },\n    holidayDates() {\n      return this.holidays.map(h => {\n        const d = new Date(h.holiday_date);\n        d.setHours(0, 0, 0, 0);\n        return d.getTime();\n      });\n    },\n    disabledDates() {\n      return this.holidays.map(h => new Date(h.holiday_date));\n    },\n    formatMinDate() {\n      return this.minStartDate.toLocaleDateString('th-TH', {\n        day: 'numeric',\n        month: 'short',\n        year: 'numeric'\n      });\n    },\n    calculateDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n\n        // คำนวณชั่วโมงทำงานจริง (9-12, 13-18 = 8 ชม./วัน)\n        const hoursPerDay = 8;\n        let totalHours = 0;\n        const startDate = new Date(start);\n        startDate.setHours(0, 0, 0, 0);\n        const endDate = new Date(end);\n        endDate.setHours(0, 0, 0, 0);\n        if (startDate.getTime() === endDate.getTime()) {\n          // วันเดียวกัน - คำนวณชั่วโมงตรงๆ (ถ้าไม่ใช่วันหยุด)\n          const day = startDate.getDay();\n          if (day !== 0 && day !== 6 && !this.holidayDates.includes(startDate.getTime())) {\n            totalHours = this.calculateWorkHours(start, end);\n          }\n        } else {\n          // หลายวัน\n          const current = new Date(startDate);\n          while (current <= endDate) {\n            const day = current.getDay();\n            const isHoliday = this.holidayDates.includes(current.getTime());\n            if (day !== 0 && day !== 6 && !isHoliday) {\n              // ไม่นับ เสาร์-อาทิตย์ และวันหยุด\n              if (current.getTime() === startDate.getTime()) {\n                // วันแรก - นับจากเวลาเริ่มถึงสิ้นสุดวัน\n                const dayEnd = new Date(current);\n                dayEnd.setHours(18, 0, 0, 0);\n                totalHours += this.calculateWorkHours(start, dayEnd);\n              } else if (current.getTime() === endDate.getTime()) {\n                // วันสุดท้าย - นับจากเริ่มวันถึงเวลาสิ้นสุด\n                const dayStart = new Date(current);\n                dayStart.setHours(9, 0, 0, 0);\n                totalHours += this.calculateWorkHours(dayStart, end);\n              } else {\n                // วันกลาง - นับเต็มวัน\n                totalHours += hoursPerDay;\n              }\n            }\n            current.setDate(current.getDate() + 1);\n          }\n        }\n        const days = (totalHours / hoursPerDay).toFixed(1);\n        return `${days} วัน (${totalHours.toFixed(1)} ชม.)`;\n      }\n      return '0 วัน (0 ชม.)';\n    },\n    leaveTypesWithQuota() {\n      return this.leaveTypes.map(type => {\n        const quota = this.quotaData[type.value];\n        const disabled = quota && quota.remainingDays <= 0;\n        return {\n          ...type,\n          disabled: disabled\n        };\n      });\n    }\n  },\n  methods: {\n    // Check if date is in advance days period\n    isAdvanceDay(dateObj) {\n      if (!this.selectedLeaveTypeAdvanceDays) return false;\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const checkDate = new Date(dateObj.year, dateObj.month, dateObj.day);\n      checkDate.setHours(0, 0, 0, 0);\n      const diffDays = Math.floor((checkDate - today) / (1000 * 60 * 60 * 24));\n      return diffDays >= 0 && diffDays < this.selectedLeaveTypeAdvanceDays;\n    },\n    getDateClass(dateObj) {\n      if (this.isAdvanceDay(dateObj)) {\n        return 'advance-day-blocked';\n      }\n      const checkDate = new Date(dateObj.year, dateObj.month, dateObj.day);\n      checkDate.setHours(0, 0, 0, 0);\n      if (this.holidayDates.includes(checkDate.getTime())) {\n        return 'holiday-date';\n      }\n      return '';\n    },\n    // รวม date + time เป็น DateTime\n    updateStartDateTime() {\n      if (this.formData.startDate && this.formData.startTime) {\n        const [hours, minutes] = this.formData.startTime.split(':').map(Number);\n        const date = new Date(this.formData.startDate);\n        date.setHours(hours, minutes, 0, 0);\n        this.formData.startDateTime = date;\n      }\n    },\n    updateEndDateTime() {\n      if (this.formData.endDate && this.formData.endTime) {\n        const [hours, minutes] = this.formData.endTime.split(':').map(Number);\n        const date = new Date(this.formData.endDate);\n        date.setHours(hours, minutes, 0, 0);\n        this.formData.endDateTime = date;\n      }\n    },\n    // คำนวณชั่วโมงทำงานระหว่างสองเวลา (9-12, 13-18)\n    calculateWorkHours(start, end) {\n      const startHour = start.getHours() + start.getMinutes() / 60;\n      const endHour = end.getHours() + end.getMinutes() / 60;\n      let hours = 0;\n      // ช่วงเช้า 9-12\n      const morningStart = Math.max(startHour, 9);\n      const morningEnd = Math.min(endHour, 12);\n      if (morningEnd > morningStart) {\n        hours += morningEnd - morningStart;\n      }\n      // ช่วงบ่าย 13-18\n      const afternoonStart = Math.max(startHour, 13);\n      const afternoonEnd = Math.min(endHour, 18);\n      if (afternoonEnd > afternoonStart) {\n        hours += afternoonEnd - afternoonStart;\n      }\n      return Math.max(0, hours);\n    },\n    async loadLeaveTypes() {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        this.leaveTypes = response.data;\n      } catch (error) {\n        // Fallback to default types if API fails\n        this.leaveTypes = [{\n          label: 'ลาป่วย',\n          value: 'sick'\n        }, {\n          label: 'ลากิจ',\n          value: 'personal'\n        }, {\n          label: 'ลาพักร้อน',\n          value: 'vacation'\n        }];\n      }\n    },\n    optionDisabled(option) {\n      return option.disabled;\n    },\n    async loadQuotaData() {\n      try {\n        const userId = localStorage.getItem('soc_user_id');\n        const response = await axios.get(`/api/leave/quota/${userId}`);\n        this.quotaData = response.data;\n\n        // Update selected quota if leave type is already selected\n        if (this.formData.leaveType) {\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\n        }\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'โหลดโควต้าไม่สำเร็จ',\n          detail: 'กรุณารีเฟรชหน้าเว็บ',\n          life: 4000\n        });\n      }\n    },\n    async loadHolidays() {\n      try {\n        const response = await axios.get('/api/leave/holidays');\n        this.holidays = response.data;\n      } catch {/* ignore */}\n    },\n    onLeaveTypeChange() {\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\n      } else {\n        this.selectedQuota = null;\n      }\n\n      // Clear dates if they're before the new minStartDate\n      const minDate = this.minStartDate;\n      if (this.formData.startDate && new Date(this.formData.startDate) < minDate) {\n        this.formData.startDate = null;\n        this.formData.startTime = null;\n        this.formData.startDateTime = null;\n      }\n      if (this.formData.endDate && new Date(this.formData.endDate) < minDate) {\n        this.formData.endDate = null;\n        this.formData.endTime = null;\n        this.formData.endDateTime = null;\n      }\n    },\n    getQuotaClass(remainingDays) {\n      if (remainingDays <= 0) return 'quota-zero';\n      if (remainingDays <= 2) return 'quota-low';\n      return 'quota-normal';\n    },\n    async submitForm() {\n      if (!this.formData.leaveType) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'กรุณากรอกข้อมูล',\n          detail: 'เลือกประเภทการลาก่อนส่งคำขอ',\n          life: 4000\n        });\n        return;\n      }\n\n      // Check quota before submitting\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'โควต้าหมด',\n          detail: 'โควต้าการลาประเภทนี้ใช้หมดแล้ว กรุณาเลือกประเภทอื่น',\n          life: 4000\n        });\n        return;\n      }\n\n      // Check if requested days exceed remaining quota\n      const requestedDays = this.calculateTotalDays();\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'เกินโควต้า',\n          detail: `ขอลา ${requestedDays} วัน แต่เหลือโควต้า ${this.selectedQuota.remainingDays} วัน`,\n          life: 4000\n        });\n        return;\n      }\n\n      // Check advance days requirement\n      const selectedLeaveType = this.leaveTypes.find(t => t.value === this.formData.leaveType);\n      if (selectedLeaveType && selectedLeaveType.advance_days > 0 && this.formData.startDateTime) {\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const startDate = new Date(this.formData.startDateTime);\n        startDate.setHours(0, 0, 0, 0);\n        const diffTime = startDate - today;\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n        if (diffDays < selectedLeaveType.advance_days) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'ลาล่วงหน้าไม่เพียงพอ',\n            detail: `${selectedLeaveType.label} ต้องลาล่วงหน้าอย่างน้อย ${selectedLeaveType.advance_days} วัน (คุณลาล่วงหน้า ${diffDays} วัน)`,\n            life: 5000\n          });\n          return;\n        }\n      }\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'วันที่ไม่ถูกต้อง',\n            detail: 'วันสิ้นสุดต้องไม่ก่อนวันเริ่มลา',\n            life: 4000\n          });\n          return;\n        }\n      }\n      try {\n        // Upload files first if any\n        let uploadedFiles = [];\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\n          const formData = new FormData();\n          this.formData.attachments.forEach(file => {\n            formData.append('files', file);\n          });\n          const uploadResponse = await axios.post('/api/files/upload', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          uploadedFiles = uploadResponse.data.files;\n        }\n\n        // Calculate total days\n        const totalDays = this.calculateTotalDays();\n\n        // Prepare data for API\n        const leaveData = {\n          user_id: localStorage.getItem('soc_user_id'),\n          leave_type: this.formData.leaveType,\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\n          total_days: totalDays,\n          reason: this.formData.reason || 'ไม่ระบุ',\n          has_delegation: this.formData.delegationOption === 'yes',\n          delegate_name: this.formData.delegateName || null,\n          delegate_position: this.formData.delegatePosition || null,\n          delegate_department: this.formData.delegateDepartment || null,\n          delegate_contact: this.formData.delegateContact || null,\n          work_details: this.formData.workDetails || null,\n          attachments: uploadedFiles\n        };\n\n        // Send to backend\n        const response = await axios.post('/api/leave', leaveData, {\n          headers: {}\n        });\n        this.$toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\n          life: 3000\n        });\n        this.$emit('submit-leave', response.data);\n        this.resetForm();\n      } catch (error) {\n        let errorMessage = 'กรุณาลองใหม่อีกครั้ง หรือติดต่อผู้ดูแลระบบ';\n        if (error.response?.data?.error) {\n          errorMessage = error.response.data.error;\n        }\n        this.$toast.add({\n          severity: 'error',\n          summary: 'บันทึกไม่สำเร็จ',\n          detail: errorMessage,\n          life: 5000\n        });\n      }\n    },\n    calculateTotalDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n        const hoursPerDay = 8;\n        let totalHours = 0;\n        const startDate = new Date(start);\n        startDate.setHours(0, 0, 0, 0);\n        const endDate = new Date(end);\n        endDate.setHours(0, 0, 0, 0);\n        if (startDate.getTime() === endDate.getTime()) {\n          // วันเดียวกัน\n          totalHours = this.calculateWorkHours(start, end);\n        } else {\n          // หลายวัน\n          const current = new Date(startDate);\n          while (current <= endDate) {\n            const day = current.getDay();\n            if (day !== 0 && day !== 6) {\n              if (current.getTime() === startDate.getTime()) {\n                const dayEnd = new Date(current);\n                dayEnd.setHours(18, 0, 0, 0);\n                totalHours += this.calculateWorkHours(start, dayEnd);\n              } else if (current.getTime() === endDate.getTime()) {\n                const dayStart = new Date(current);\n                dayStart.setHours(9, 0, 0, 0);\n                totalHours += this.calculateWorkHours(dayStart, end);\n              } else {\n                totalHours += hoursPerDay;\n              }\n            }\n            current.setDate(current.getDate() + 1);\n          }\n        }\n        return parseFloat((totalHours / hoursPerDay).toFixed(2));\n      }\n      return 0;\n    },\n    formatDateTime(date) {\n      if (!date) return null;\n      return new Date(date).toISOString();\n    },\n    resetForm() {\n      this.formData = {\n        leaveType: '',\n        startDate: null,\n        startTime: null,\n        endDate: null,\n        endTime: null,\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      };\n      this.selectedDelegate = null;\n    },\n    handleFileUpload(event) {\n      const files = Array.from(event.target.files);\n      this.formData.attachments = [...this.formData.attachments, ...files];\n    },\n    removeFile(index) {\n      this.formData.attachments.splice(index, 1);\n    },\n    async loadUsers() {\n      try {\n        const response = await axios.get('/api/users');\n        if (response.data && Array.isArray(response.data)) {\n          // กรองผู้ใช้ปัจจุบันออก\n          const currentUserName = this.currentUserName;\n          this.users = response.data.filter(user => {\n            const userName = `${user.firstname} ${user.lastname}`.trim();\n            return userName !== currentUserName;\n          }).map(user => ({\n            ...user,\n            displayName: `${user.firstname} ${user.lastname}`.trim()\n          }));\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n        } else {\n          this.setFallbackUsers();\n        }\n      } catch (error) {\n        this.setFallbackUsers();\n      }\n    },\n    setFallbackUsers() {\n      this.users = [{\n        id: 1,\n        username: 'admin',\n        firstname: 'Admin',\n        lastname: 'User',\n        role: 'admin',\n        displayName: 'Admin User'\n      }, {\n        id: 2,\n        username: 'hr',\n        firstname: 'HR',\n        lastname: 'Manager',\n        role: 'hr',\n        displayName: 'HR Manager'\n      }, {\n        id: 3,\n        username: 'john',\n        firstname: 'John',\n        lastname: 'Doe',\n        role: 'user',\n        displayName: 'John Doe'\n      }];\n      this.filteredUsers = this.users;\n    },\n    searchUsers(event) {\n      const query = event.query.toLowerCase().trim();\n      if (query === '') {\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n      } else {\n        // ค้นหาและจำกัดผลลัพธ์\n        const filtered = this.users.filter(user => user.displayName.toLowerCase().includes(query) || user.username.toLowerCase().includes(query) || user.position && user.position.toLowerCase().includes(query) || user.department && user.department.toLowerCase().includes(query));\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers);\n      }\n    },\n    showAllUsers() {\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n    },\n    onDelegateSelect(event) {\n      const user = event.value;\n      if (user) {\n        this.formData.delegateName = user.displayName;\n        this.formData.delegatePosition = user.position || '';\n        this.formData.delegateDepartment = user.department || '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","AutoComplete","Dropdown","name","components","created","loadLeaveTypes","loadUsers","loadQuotaData","loadHolidays","filteredUsers","users","slice","maxDisplayUsers","data","formData","leaveType","startDate","startTime","endDate","endTime","startDateTime","endDateTime","reason","delegationOption","delegateName","delegatePosition","delegateDepartment","delegateContact","workDetails","attachments","allowedTimes","label","value","leaveTypes","delegationOptions","selectedDelegate","quotaData","selectedQuota","holidays","watch","formData.startDate","updateStartDateTime","formData.endDate","updateEndDateTime","computed","currentUserName","firstName","localStorage","getItem","lastName","trim","currentUserRole","currentUserPosition","selectedLeaveTypeAdvanceDays","type","find","t","advance_days","minStartDate","today","Date","setHours","advanceDays","setDate","getDate","holidayDates","map","h","d","holiday_date","getTime","disabledDates","formatMinDate","toLocaleDateString","day","month","year","calculateDays","start","end","hoursPerDay","totalHours","getDay","includes","calculateWorkHours","current","isHoliday","dayEnd","dayStart","days","toFixed","leaveTypesWithQuota","quota","disabled","remainingDays","methods","isAdvanceDay","dateObj","checkDate","diffDays","Math","floor","getDateClass","hours","minutes","split","Number","date","startHour","getHours","getMinutes","endHour","morningStart","max","morningEnd","min","afternoonStart","afternoonEnd","response","get","error","optionDisabled","option","userId","$toast","add","severity","summary","detail","life","onLeaveTypeChange","minDate","getQuotaClass","submitForm","requestedDays","calculateTotalDays","selectedLeaveType","diffTime","ceil","uploadedFiles","length","FormData","forEach","file","append","uploadResponse","post","headers","files","totalDays","leaveData","user_id","leave_type","start_datetime","formatDateTime","end_datetime","total_days","has_delegation","delegate_name","delegate_position","delegate_department","delegate_contact","work_details","$emit","resetForm","errorMessage","parseFloat","toISOString","handleFileUpload","event","Array","from","target","removeFile","index","splice","isArray","filter","user","userName","firstname","lastname","displayName","setFallbackUsers","id","username","role","searchUsers","query","toLowerCase","filtered","position","department","showAllUsers","onDelegateSelect"],"sources":["D:\\frontend_cem\\src\\views\\leave_work\\LeaveForm.vue"],"sourcesContent":["<template>\n  <div>\n    <Toast />\n    <Card class=\"form-card\">\n    <template #content>\n      <form @submit.prevent=\"submitForm\" class=\"leave-form\">\n        <div class=\"form-grid\">\n          <div class=\"input-group\">\n            <label for=\"name\" class=\"input-label\">ชื่อ-นามสกุล</label>\n            <InputText id=\"name\" :value=\"currentUserName\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"position\" class=\"input-label\">ตำแหน่ง</label>\n            <InputText id=\"position\" :value=\"currentUserPosition\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"leaveType\" class=\"input-label\">ประเภทการลา *</label>\n            <Dropdown v-model=\"formData.leaveType\" :options=\"leaveTypesWithQuota\" optionLabel=\"label\" optionValue=\"value\"\n              :optionDisabled=\"optionDisabled\" class=\"corporate-dropdown\" required @change=\"onLeaveTypeChange\">\n              <template #option=\"slotProps\">\n                <div class=\"leave-type-option\" :class=\"{ 'disabled-option': slotProps.option.disabled }\">\n                  <div class=\"leave-type-main\">\n                    <span>{{ slotProps.option.label }}</span>\n                    <span v-if=\"slotProps.option.disabled\" class=\"quota-status\">หมดโควต้า</span>\n                  </div>\n                  <small v-if=\"slotProps.option.advance_days > 0\" class=\"advance-hint\">\n                    ต้องลาล่วงหน้า {{ slotProps.option.advance_days }} วัน\n                  </small>\n                </div>\n              </template>\n            </Dropdown>\n            <small v-if=\"selectedLeaveTypeAdvanceDays > 0\" class=\"advance-days-warning\">\n              <i class=\"pi pi-info-circle\"></i> ต้องลาล่วงหน้าอย่างน้อย {{ selectedLeaveTypeAdvanceDays }} วัน (เริ่มลาได้ตั้งแต่ {{ formatMinDate }})\n            </small>\n          </div>\n\n          <!-- Quota Display -->\n          <div class=\"quota-display\" :class=\"{ 'quota-placeholder': !selectedQuota }\">\n            <div v-if=\"selectedQuota\" class=\"quota-info\">\n              <span class=\"quota-label\">โควต้าคงเหลือ:</span>\n              <span class=\"quota-value\" :class=\"getQuotaClass(selectedQuota.remainingDays)\">\n                {{ selectedQuota.remainingDays }} วัน ({{ selectedQuota.remainingHours }} ชม.)\n              </span>\n              <span class=\"quota-total\">(จาก {{ selectedQuota.quota }} วัน / {{ selectedQuota.quotaHours }} ชม.)</span>\n            </div>\n            <div v-else class=\"quota-placeholder-text\">\n              เลือกประเภทการลาเพื่อดูโควต้า\n            </div>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"startDateTime\" class=\"input-label\">วันเวลาเริ่มลา *</label>\n            <div class=\"datetime-picker\">\n              <Calendar v-model=\"formData.startDate\" dateFormat=\"dd/mm/yy\"\n                class=\"corporate-input date-only advance-calendar\" :manualInput=\"false\" required\n                :minDate=\"minStartDate\" :disabledDates=\"disabledDates\" placeholder=\"เลือกวันที่\">\n                <template #date=\"slotProps\">\n                  <span :class=\"getDateClass(slotProps.date)\" class=\"date-cell\">\n                    {{ slotProps.date.day }}\n                  </span>\n                </template>\n              </Calendar>\n              <Dropdown v-model=\"formData.startTime\" :options=\"allowedTimes\" optionLabel=\"label\" optionValue=\"value\"\n                class=\"corporate-input time-dropdown\" placeholder=\"เวลา\" @change=\"updateStartDateTime\" />\n            </div>\n            <small class=\"time-hint\">เวลาทำการ: 09:00-12:00, 13:00-18:00</small>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"endDateTime\" class=\"input-label\">วันเวลาสิ้นสุดการลา *</label>\n            <div class=\"datetime-picker\">\n              <Calendar v-model=\"formData.endDate\" dateFormat=\"dd/mm/yy\"\n                :minDate=\"formData.startDate || minStartDate\" :disabledDates=\"disabledDates\" class=\"corporate-input date-only advance-calendar\" :manualInput=\"false\" required\n                placeholder=\"เลือกวันที่\">\n                <template #date=\"slotProps\">\n                  <span :class=\"getDateClass(slotProps.date)\" class=\"date-cell\">\n                    {{ slotProps.date.day }}\n                  </span>\n                </template>\n              </Calendar>\n              <Dropdown v-model=\"formData.endTime\" :options=\"allowedTimes\" optionLabel=\"label\" optionValue=\"value\"\n                class=\"corporate-input time-dropdown\" placeholder=\"เวลา\" @change=\"updateEndDateTime\" />\n            </div>\n            <small class=\"time-hint\">เวลาทำการ: 09:00-12:00, 13:00-18:00</small>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"totalDays\" class=\"input-label\">จำนวนวันลา</label>\n            <InputText id=\"totalDays\" :value=\"calculateDays\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group full-width\">\n            <label for=\"reason\" class=\"input-label\">เหตุผลการลา</label>\n            <Textarea id=\"reason\" v-model=\"formData.reason\" rows=\"3\" class=\"corporate-input\" />\n          </div>\n\n          <div class=\"input-group full-width\">\n            <label class=\"input-label\">แนบเอกสารประกอบ (Attachments)</label>\n            <div class=\"file-upload-wrapper\">\n              <input ref=\"fileInput\" @change=\"handleFileUpload\" type=\"file\"\n                accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif\" multiple class=\"file-input\" id=\"attachments\">\n              <Button type=\"button\"\n                :label=\"formData.attachments?.length > 0 ? `เลือกแล้ว ${formData.attachments.length} ไฟล์` : 'เลือกไฟล์'\"\n                icon=\"pi pi-upload\" severity=\"secondary\" outlined @click=\"$refs.fileInput.click()\" />\n            </div>\n            <div v-if=\"formData.attachments?.length > 0\" class=\"file-list\">\n              <div v-for=\"(file, index) in formData.attachments\" :key=\"index\" class=\"file-item\">\n                <i class=\"pi pi-file\"></i>\n                <span class=\"file-name\">{{ file.name }}</span>\n                <Button icon=\"pi pi-times\" severity=\"danger\" text size=\"small\" @click=\"removeFile(index)\" />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"delegationOption\" class=\"input-label\">มอบหมายงานระหว่างลา *</label>\n            <Dropdown v-model=\"formData.delegationOption\" :options=\"delegationOptions\" optionLabel=\"label\"\n              optionValue=\"value\" class=\"corporate-dropdown\" required />\n          </div>\n\n          <template v-if=\"formData.delegationOption === 'yes'\">\n            <div class=\"input-group\">\n              <label for=\"delegateUser\" class=\"input-label\">ชื่อผู้รับผิดชอบงานแทน *</label>\n              <AutoComplete \n                v-model=\"selectedDelegate\" \n                :suggestions=\"filteredUsers\" \n                @complete=\"searchUsers\" \n                @item-select=\"onDelegateSelect\"\n                @dropdown-click=\"showAllUsers\"\n                optionLabel=\"displayName\" \n                placeholder=\"ค้นหาหรือเลือกพนักงาน...\" \n                class=\"corporate-input\"\n                :dropdown=\"true\"\n                :forceSelection=\"true\"\n                :scrollHeight=\"200\"\n                required\n              >\n                <template #option=\"slotProps\">\n                  <div class=\"user-option\">\n                    <div class=\"user-name\">{{ slotProps.option.displayName }}</div>\n                    <div class=\"user-role\">{{ slotProps.option.position }} - {{ slotProps.option.department }}</div>\n                  </div>\n                </template>\n              </AutoComplete>\n            </div>\n\n            <div class=\"input-group\">\n              <label for=\"delegatePosition\" class=\"input-label\">ตำแหน่ง</label>\n              <InputText \n                id=\"delegatePosition\" \n                :value=\"formData.delegatePosition\" \n                readonly \n                class=\"corporate-input readonly-field\" \n              />\n            </div>\n\n            <div class=\"input-group\">\n              <label for=\"delegateDepartment\" class=\"input-label\">แผนก</label>\n              <InputText \n                id=\"delegateDepartment\" \n                :value=\"formData.delegateDepartment\" \n                readonly \n                class=\"corporate-input readonly-field\" \n              />\n            </div>\n            <div class=\"input-group full-width\">\n              <label for=\"delegateContact\" class=\"input-label\">ช่องทางติดต่อผู้รับผิดชอบงานเเทน *</label>\n              <InputText id=\"delegateContact\" v-model=\"formData.delegateContact\"\n                placeholder=\"เบอร์โทร, อีเมล, หรือช่องทางอื่นๆ\" required class=\"corporate-input\" />\n            </div>\n\n            <div class=\"input-group full-width\">\n              <label for=\"workDetails\" class=\"input-label\">รายละเอียดงานที่มอบหมาย *</label>\n              <Textarea id=\"workDetails\" v-model=\"formData.workDetails\" rows=\"4\" \n                placeholder=\"ระบุรายละเอียดงานที่ต้องดำเนินการระหว่างลา...\" \n                required class=\"corporate-input\" />\n            </div>\n\n          </template>\n        </div>\n\n        <Divider />\n\n        <div class=\"form-actions\">\n          <Button type=\"button\" label=\"ล้างข้อมูล\" icon=\"pi pi-refresh\" severity=\"secondary\" outlined\n            @click=\"resetForm\" />\n          <Button type=\"submit\" label=\"ส่งคำขอลางาน\" icon=\"pi pi-check\" severity=\"success\" />\n        </div>\n      </form>\n    </template>\n  </Card>\n  </div>\n</template>\n\n<script>\nimport axios from '@/utils/axiosConfig'\nimport AutoComplete from 'primevue/autocomplete'\nimport Dropdown from 'primevue/dropdown'\n\nexport default {\n  name: 'LeaveForm',\n  components: {\n    AutoComplete,\n    Dropdown\n  },\n  async created() {\n    await this.loadLeaveTypes();\n    await this.loadUsers();\n    await this.loadQuotaData();\n    await this.loadHolidays();\n    // Initialize with limited users\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n  },\n  data() {\n    return {\n      formData: {\n        leaveType: '',\n        startDate: null,\n        startTime: null,\n        endDate: null,\n        endTime: null,\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      },\n      allowedTimes: [\n        { label: '09:00', value: '09:00' },\n        { label: '09:30', value: '09:30' },\n        { label: '10:00', value: '10:00' },\n        { label: '10:30', value: '10:30' },\n        { label: '11:00', value: '11:00' },\n        { label: '11:30', value: '11:30' },\n        { label: '12:00', value: '12:00' },\n        { label: '13:00', value: '13:00' },\n        { label: '13:30', value: '13:30' },\n        { label: '14:00', value: '14:00' },\n        { label: '14:30', value: '14:30' },\n        { label: '15:00', value: '15:00' },\n        { label: '15:30', value: '15:30' },\n        { label: '16:00', value: '16:00' },\n        { label: '16:30', value: '16:30' },\n        { label: '17:00', value: '17:00' },\n        { label: '17:30', value: '17:30' },\n        { label: '18:00', value: '18:00' }\n      ],\n      leaveTypes: [],\n      delegationOptions: [\n        { label: 'ไม่มีการมอบหมายงาน', value: 'no' },\n        { label: 'มีการมอบหมายงาน', value: 'yes' }\n      ],\n      users: [],\n      filteredUsers: [],\n      selectedDelegate: null,\n      maxDisplayUsers: 50,\n      quotaData: {},\n      selectedQuota: null,\n      holidays: []\n    }\n  },\n  watch: {\n    'formData.startDate'() {\n      this.updateStartDateTime()\n    },\n    'formData.endDate'() {\n      this.updateEndDateTime()\n    }\n  },\n  computed: {\n    currentUserName() {\n      const firstName = localStorage.getItem('soc_firstname') || ''\n      const lastName = localStorage.getItem('soc_lastname') || ''\n      return `${firstName} ${lastName}`.trim()\n    },\n    currentUserRole() {\n      return localStorage.getItem('soc_role') || ''\n    },\n    currentUserPosition() {\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง'\n    },\n    selectedLeaveTypeAdvanceDays() {\n      if (!this.formData.leaveType) return 0\n      const type = this.leaveTypes.find(t => t.value === this.formData.leaveType)\n      return type?.advance_days || 0\n    },\n    minStartDate() {\n      const today = new Date()\n      today.setHours(0, 0, 0, 0)\n      const advanceDays = this.selectedLeaveTypeAdvanceDays\n      if (advanceDays > 0) {\n        today.setDate(today.getDate() + advanceDays)\n      }\n      return today\n    },\n    holidayDates() {\n      return this.holidays.map(h => {\n        const d = new Date(h.holiday_date)\n        d.setHours(0, 0, 0, 0)\n        return d.getTime()\n      })\n    },\n    disabledDates() {\n      return this.holidays.map(h => new Date(h.holiday_date))\n    },\n    formatMinDate() {\n      return this.minStartDate.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' })\n    },\n    calculateDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime)\n        const end = new Date(this.formData.endDateTime)\n        \n        // คำนวณชั่วโมงทำงานจริง (9-12, 13-18 = 8 ชม./วัน)\n        const hoursPerDay = 8\n        let totalHours = 0\n        \n        const startDate = new Date(start)\n        startDate.setHours(0, 0, 0, 0)\n        const endDate = new Date(end)\n        endDate.setHours(0, 0, 0, 0)\n        \n        if (startDate.getTime() === endDate.getTime()) {\n          // วันเดียวกัน - คำนวณชั่วโมงตรงๆ (ถ้าไม่ใช่วันหยุด)\n          const day = startDate.getDay()\n          if (day !== 0 && day !== 6 && !this.holidayDates.includes(startDate.getTime())) {\n            totalHours = this.calculateWorkHours(start, end)\n          }\n        } else {\n          // หลายวัน\n          const current = new Date(startDate)\n          while (current <= endDate) {\n            const day = current.getDay()\n            const isHoliday = this.holidayDates.includes(current.getTime())\n            if (day !== 0 && day !== 6 && !isHoliday) { // ไม่นับ เสาร์-อาทิตย์ และวันหยุด\n              if (current.getTime() === startDate.getTime()) {\n                // วันแรก - นับจากเวลาเริ่มถึงสิ้นสุดวัน\n                const dayEnd = new Date(current)\n                dayEnd.setHours(18, 0, 0, 0)\n                totalHours += this.calculateWorkHours(start, dayEnd)\n              } else if (current.getTime() === endDate.getTime()) {\n                // วันสุดท้าย - นับจากเริ่มวันถึงเวลาสิ้นสุด\n                const dayStart = new Date(current)\n                dayStart.setHours(9, 0, 0, 0)\n                totalHours += this.calculateWorkHours(dayStart, end)\n              } else {\n                // วันกลาง - นับเต็มวัน\n                totalHours += hoursPerDay\n              }\n            }\n            current.setDate(current.getDate() + 1)\n          }\n        }\n        \n        const days = (totalHours / hoursPerDay).toFixed(1)\n        return `${days} วัน (${totalHours.toFixed(1)} ชม.)`\n      }\n      return '0 วัน (0 ชม.)'\n    },\n    leaveTypesWithQuota() {\n      return this.leaveTypes.map(type => {\n        const quota = this.quotaData[type.value];\n        const disabled = quota && quota.remainingDays <= 0;\n        return {\n          ...type,\n          disabled: disabled\n        };\n      });\n    }\n  },\n  methods: {\n    // Check if date is in advance days period\n    isAdvanceDay(dateObj) {\n      if (!this.selectedLeaveTypeAdvanceDays) return false\n      const today = new Date()\n      today.setHours(0, 0, 0, 0)\n      const checkDate = new Date(dateObj.year, dateObj.month, dateObj.day)\n      checkDate.setHours(0, 0, 0, 0)\n      const diffDays = Math.floor((checkDate - today) / (1000 * 60 * 60 * 24))\n      return diffDays >= 0 && diffDays < this.selectedLeaveTypeAdvanceDays\n    },\n    getDateClass(dateObj) {\n      if (this.isAdvanceDay(dateObj)) {\n        return 'advance-day-blocked'\n      }\n      const checkDate = new Date(dateObj.year, dateObj.month, dateObj.day)\n      checkDate.setHours(0, 0, 0, 0)\n      if (this.holidayDates.includes(checkDate.getTime())) {\n        return 'holiday-date'\n      }\n      return ''\n    },\n    // รวม date + time เป็น DateTime\n    updateStartDateTime() {\n      if (this.formData.startDate && this.formData.startTime) {\n        const [hours, minutes] = this.formData.startTime.split(':').map(Number)\n        const date = new Date(this.formData.startDate)\n        date.setHours(hours, minutes, 0, 0)\n        this.formData.startDateTime = date\n      }\n    },\n    updateEndDateTime() {\n      if (this.formData.endDate && this.formData.endTime) {\n        const [hours, minutes] = this.formData.endTime.split(':').map(Number)\n        const date = new Date(this.formData.endDate)\n        date.setHours(hours, minutes, 0, 0)\n        this.formData.endDateTime = date\n      }\n    },\n    \n    // คำนวณชั่วโมงทำงานระหว่างสองเวลา (9-12, 13-18)\n    calculateWorkHours(start, end) {\n      const startHour = start.getHours() + start.getMinutes() / 60\n      const endHour = end.getHours() + end.getMinutes() / 60\n      \n      let hours = 0\n      // ช่วงเช้า 9-12\n      const morningStart = Math.max(startHour, 9)\n      const morningEnd = Math.min(endHour, 12)\n      if (morningEnd > morningStart) {\n        hours += morningEnd - morningStart\n      }\n      // ช่วงบ่าย 13-18\n      const afternoonStart = Math.max(startHour, 13)\n      const afternoonEnd = Math.min(endHour, 18)\n      if (afternoonEnd > afternoonStart) {\n        hours += afternoonEnd - afternoonStart\n      }\n      return Math.max(0, hours)\n    },\n    \n    async loadLeaveTypes() {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        this.leaveTypes = response.data;\n      } catch (error) {\n        \n        // Fallback to default types if API fails\n        this.leaveTypes = [\n          { label: 'ลาป่วย', value: 'sick' },\n          { label: 'ลากิจ', value: 'personal' },\n          { label: 'ลาพักร้อน', value: 'vacation' }\n        ];\n      }\n    },\n    optionDisabled(option) {\n      return option.disabled;\n    },\n\n    async loadQuotaData() {\n      try {\n        const userId = localStorage.getItem('soc_user_id');\n        const response = await axios.get(`/api/leave/quota/${userId}`);\n        this.quotaData = response.data;\n        \n        // Update selected quota if leave type is already selected\n        if (this.formData.leaveType) {\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\n        }\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'โหลดโควต้าไม่สำเร็จ',\n          detail: 'กรุณารีเฟรชหน้าเว็บ',\n          life: 4000\n        });\n      }\n    },\n\n    async loadHolidays() {\n      try {\n        const response = await axios.get('/api/leave/holidays');\n        this.holidays = response.data;\n      } catch { /* ignore */ }\n    },\n\n    onLeaveTypeChange() {\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\n      } else {\n        this.selectedQuota = null;\n      }\n      \n      // Clear dates if they're before the new minStartDate\n      const minDate = this.minStartDate\n      if (this.formData.startDate && new Date(this.formData.startDate) < minDate) {\n        this.formData.startDate = null\n        this.formData.startTime = null\n        this.formData.startDateTime = null\n      }\n      if (this.formData.endDate && new Date(this.formData.endDate) < minDate) {\n        this.formData.endDate = null\n        this.formData.endTime = null\n        this.formData.endDateTime = null\n      }\n    },\n\n    getQuotaClass(remainingDays) {\n      if (remainingDays <= 0) return 'quota-zero';\n      if (remainingDays <= 2) return 'quota-low';\n      return 'quota-normal';\n    },\n\n    async submitForm() {\n      if (!this.formData.leaveType) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'กรุณากรอกข้อมูล',\n          detail: 'เลือกประเภทการลาก่อนส่งคำขอ',\n          life: 4000\n        })\n        return\n      }\n\n      // Check quota before submitting\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'โควต้าหมด',\n          detail: 'โควต้าการลาประเภทนี้ใช้หมดแล้ว กรุณาเลือกประเภทอื่น',\n          life: 4000\n        })\n        return\n      }\n\n      // Check if requested days exceed remaining quota\n      const requestedDays = this.calculateTotalDays();\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'เกินโควต้า',\n          detail: `ขอลา ${requestedDays} วัน แต่เหลือโควต้า ${this.selectedQuota.remainingDays} วัน`,\n          life: 4000\n        })\n        return\n      }\n\n      // Check advance days requirement\n      const selectedLeaveType = this.leaveTypes.find(t => t.value === this.formData.leaveType)\n      if (selectedLeaveType && selectedLeaveType.advance_days > 0 && this.formData.startDateTime) {\n        const today = new Date()\n        today.setHours(0, 0, 0, 0)\n        const startDate = new Date(this.formData.startDateTime)\n        startDate.setHours(0, 0, 0, 0)\n        \n        const diffTime = startDate - today\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))\n        \n        if (diffDays < selectedLeaveType.advance_days) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'ลาล่วงหน้าไม่เพียงพอ',\n            detail: `${selectedLeaveType.label} ต้องลาล่วงหน้าอย่างน้อย ${selectedLeaveType.advance_days} วัน (คุณลาล่วงหน้า ${diffDays} วัน)`,\n            life: 5000\n          })\n          return\n        }\n      }\n\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'วันที่ไม่ถูกต้อง',\n            detail: 'วันสิ้นสุดต้องไม่ก่อนวันเริ่มลา',\n            life: 4000\n          })\n          return\n        }\n      }\n\n      try {\n        // Upload files first if any\n        let uploadedFiles = []\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\n          const formData = new FormData()\n          this.formData.attachments.forEach(file => {\n            formData.append('files', file)\n          })\n          \n          const uploadResponse = await axios.post('/api/files/upload', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          })\n          uploadedFiles = uploadResponse.data.files\n        }\n\n        // Calculate total days\n        const totalDays = this.calculateTotalDays();\n        \n        // Prepare data for API\n        const leaveData = {\n          user_id: localStorage.getItem('soc_user_id'),\n          leave_type: this.formData.leaveType,\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\n          total_days: totalDays,\n          reason: this.formData.reason || 'ไม่ระบุ',\n          has_delegation: this.formData.delegationOption === 'yes',\n          delegate_name: this.formData.delegateName || null,\n          delegate_position: this.formData.delegatePosition || null,\n          delegate_department: this.formData.delegateDepartment || null,\n          delegate_contact: this.formData.delegateContact || null,\n          work_details: this.formData.workDetails || null,\n          attachments: uploadedFiles\n        }\n\n        // Send to backend\n        const response = await axios.post('/api/leave', leaveData, {\n          headers: {\n          }\n        })\n        \n        this.$toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\n          life: 3000\n        })\n\n        this.$emit('submit-leave', response.data)\n        this.resetForm()\n        \n      } catch (error) {\n        \n        let errorMessage = 'กรุณาลองใหม่อีกครั้ง หรือติดต่อผู้ดูแลระบบ'\n        \n        if (error.response?.data?.error) {\n          errorMessage = error.response.data.error\n        }\n        \n        this.$toast.add({\n          severity: 'error',\n          summary: 'บันทึกไม่สำเร็จ',\n          detail: errorMessage,\n          life: 5000\n        })\n      }\n    },\n    calculateTotalDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime)\n        const end = new Date(this.formData.endDateTime)\n        \n        const hoursPerDay = 8\n        let totalHours = 0\n        \n        const startDate = new Date(start)\n        startDate.setHours(0, 0, 0, 0)\n        const endDate = new Date(end)\n        endDate.setHours(0, 0, 0, 0)\n        \n        if (startDate.getTime() === endDate.getTime()) {\n          // วันเดียวกัน\n          totalHours = this.calculateWorkHours(start, end)\n        } else {\n          // หลายวัน\n          const current = new Date(startDate)\n          while (current <= endDate) {\n            const day = current.getDay()\n            if (day !== 0 && day !== 6) {\n              if (current.getTime() === startDate.getTime()) {\n                const dayEnd = new Date(current)\n                dayEnd.setHours(18, 0, 0, 0)\n                totalHours += this.calculateWorkHours(start, dayEnd)\n              } else if (current.getTime() === endDate.getTime()) {\n                const dayStart = new Date(current)\n                dayStart.setHours(9, 0, 0, 0)\n                totalHours += this.calculateWorkHours(dayStart, end)\n              } else {\n                totalHours += hoursPerDay\n              }\n            }\n            current.setDate(current.getDate() + 1)\n          }\n        }\n        \n        return parseFloat((totalHours / hoursPerDay).toFixed(2))\n      }\n      return 0\n    },\n    formatDateTime(date) {\n      if (!date) return null\n      return new Date(date).toISOString()\n    },\n    resetForm() {\n      this.formData = {\n        leaveType: '',\n        startDate: null,\n        startTime: null,\n        endDate: null,\n        endTime: null,\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      }\n      this.selectedDelegate = null\n    },\n    handleFileUpload(event) {\n      const files = Array.from(event.target.files)\n      this.formData.attachments = [...this.formData.attachments, ...files]\n    },\n    removeFile(index) {\n      this.formData.attachments.splice(index, 1)\n    },\n    async loadUsers() {\n      try {\n        const response = await axios.get('/api/users')\n        \n        if (response.data && Array.isArray(response.data)) {\n          // กรองผู้ใช้ปัจจุบันออก\n          const currentUserName = this.currentUserName\n          this.users = response.data\n            .filter(user => {\n              const userName = `${user.firstname} ${user.lastname}`.trim()\n              return userName !== currentUserName\n            })\n            .map(user => ({\n              ...user,\n              displayName: `${user.firstname} ${user.lastname}`.trim()\n            }))\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n        } else {\n          this.setFallbackUsers()\n        }\n      } catch (error) {\n        this.setFallbackUsers()\n      }\n    },\n    setFallbackUsers() {\n      this.users = [\n        { id: 1, username: 'admin', firstname: 'Admin', lastname: 'User', role: 'admin', displayName: 'Admin User' },\n        { id: 2, username: 'hr', firstname: 'HR', lastname: 'Manager', role: 'hr', displayName: 'HR Manager' },\n        { id: 3, username: 'john', firstname: 'John', lastname: 'Doe', role: 'user', displayName: 'John Doe' }\n      ]\n      this.filteredUsers = this.users\n    },\n    searchUsers(event) {\n      const query = event.query.toLowerCase().trim()\n      \n      if (query === '') {\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n      } else {\n        // ค้นหาและจำกัดผลลัพธ์\n        const filtered = this.users.filter(user => \n          user.displayName.toLowerCase().includes(query) ||\n          user.username.toLowerCase().includes(query) ||\n          (user.position && user.position.toLowerCase().includes(query)) ||\n          (user.department && user.department.toLowerCase().includes(query))\n        )\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers)\n      }\n    },\n    showAllUsers() {\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n    },\n    onDelegateSelect(event) {\n      const user = event.value\n      if (user) {\n        this.formData.delegateName = user.displayName\n        this.formData.delegatePosition = user.position || ''\n        this.formData.delegateDepartment = user.department || ''\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.quota-display {\n  margin-top: 0.5rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border-left: 4px solid #007bff;\n}\n\n.quota-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n}\n\n.quota-label {\n  color: #6c757d;\n  font-weight: 500;\n}\n\n.quota-value {\n  font-weight: bold;\n  font-size: 1rem;\n}\n\n.quota-value.quota-normal {\n  color: #28a745;\n}\n\n.quota-value.quota-low {\n  color: #ffc107;\n}\n\n.quota-value.quota-zero {\n  color: #dc3545;\n}\n\n.quota-total {\n  color: #6c757d;\n  font-size: 0.85rem;\n}\n\n.form-card {\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);\n  border: 1px solid #e9ecef;\n}\n\n.leave-form {\n  padding: 1rem;\n}\n\n.form-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.full-width {\n  grid-column: 1 / -1;\n}\n\n.input-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.date-range-group {\n  display: flex;\n  flex-direction: row;\n  gap: 1rem;\n}\n\n.datetime-picker {\n  display: flex;\n  gap: 0.5rem;\n  width: 100%;\n}\n\n.datetime-picker .date-only {\n  flex: 1;\n}\n\n.datetime-picker .time-dropdown {\n  flex: 0 0 100px;\n}\n\n:deep(.datetime-picker .p-calendar),\n:deep(.datetime-picker .p-dropdown) {\n  width: 100% !important;\n}\n\n@media (max-width: 768px) {\n  .datetime-picker .time-dropdown {\n    flex: 0 0 90px;\n  }\n}\n\n.input-label {\n  font-weight: 500;\n  color: #495057;\n  font-size: 0.9rem;\n}\n\n.corporate-input,\n.corporate-dropdown {\n  border: 2px solid #e9ecef;\n  border-radius: 6px;\n  padding: 0.75rem;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n}\n\n.corporate-input:focus,\n.corporate-dropdown:focus {\n  border-color: #28a745;\n  box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);\n}\n\n.readonly-field {\n  background: #f8f9fa;\n  color: #6c757d;\n}\n\n.section-divider {\n  grid-column: 1 / -1;\n  margin: 1rem 0;\n  padding: 1rem 0;\n  border-top: 2px solid #e9ecef;\n}\n\n.section-title {\n  margin: 0;\n  color: #495057;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n\n.checkbox-group {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 0;\n}\n\n.checkbox-label {\n  font-weight: 600;\n  color: #495057;\n  font-size: 1rem;\n  cursor: pointer;\n}\n\n.file-upload-wrapper {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.file-input {\n  display: none;\n}\n\n.file-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border: 1px solid #e9ecef;\n}\n\n.file-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  background: white;\n  border-radius: 4px;\n  border: 1px solid #e9ecef;\n}\n\n.file-item i {\n  color: #6c757d;\n  font-size: 1rem;\n}\n\n.file-name {\n  flex: 1;\n  font-size: 0.9rem;\n  color: #495057;\n  word-break: break-all;\n}\n\n.form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  margin-top: 1.5rem;\n}\n\n.form-actions .p-button {\n  min-width: 140px;\n  padding: 0.75rem 1.5rem;\n  font-weight: 500;\n}\n\n@media (max-width: 768px) {\n  .form-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .form-actions {\n    flex-direction: column;\n  }\n\n  .leave-form {\n    padding: 0.5rem;\n  }\n\n  .corporate-input,\n  .corporate-dropdown {\n    padding: 0.6rem;\n    font-size: 0.9rem;\n  }\n\n  .input-label {\n    font-size: 0.85rem;\n  }\n\n  .checkbox-label {\n    font-size: 0.9rem;\n  }\n\n  .file-list {\n    padding: 0.5rem;\n  }\n\n  .file-item {\n    padding: 0.4rem;\n  }\n\n  .file-name {\n    font-size: 0.85rem;\n  }\n}\n\n/* DateTime input styling */\n.datetime-inputs {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.date-input {\n  flex: 2;\n}\n\n.time-input {\n  flex: 1;\n}\n\n@media (max-width: 768px) {\n  .datetime-inputs {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .date-input, .time-input {\n    flex: 1;\n  }\n}\n\n@media (max-width: 480px) {\n  .leave-form {\n    padding: 0.25rem;\n  }\n\n  .form-grid {\n    gap: 1rem;\n  }\n\n  .corporate-input,\n  .corporate-dropdown {\n    padding: 0.5rem;\n    font-size: 0.85rem;\n  }\n\n  .input-label {\n    font-size: 0.8rem;\n  }\n\n  .form-actions .p-button {\n    min-width: 100%;\n    padding: 0.6rem 1rem;\n    font-size: 0.9rem;\n  }\n\n  .checkbox-group {\n    padding: 0.75rem 0;\n  }\n\n  .checkbox-label {\n    font-size: 0.85rem;\n  }\n}\n\n.user-option {\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n}\n\n.user-name {\n  font-weight: 500;\n  color: #495057;\n}\n\n.user-role {\n  font-size: 0.875rem;\n  color: #6c757d;\n  margin-top: 0.25rem;\n}\n\n.corporate-input :deep(.p-autocomplete-panel) {\n  max-height: 250px;\n  overflow-y: auto;\n}\n\n.quota-display {\n  margin-top: 0.5rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border-left: 4px solid #007bff;\n  min-height: 3rem;\n  display: flex;\n  align-items: center;\n}\n\n.quota-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n}\n\n.quota-label {\n  font-weight: 500;\n  color: #495057;\n}\n\n.quota-value {\n  font-weight: bold;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n}\n\n.quota-normal {\n  background: #d4edda;\n  color: #155724;\n}\n\n.quota-low {\n  background: #fff3cd;\n  color: #856404;\n}\n\n.quota-zero {\n  background: #f8d7da;\n  color: #721c24;\n}\n\n.quota-total {\n  color: #6c757d;\n  font-size: 0.85rem;\n}\n\n.leave-type-option {\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  gap: 0.25rem;\n}\n\n.disabled-option {\n  background-color: #f8f9fa !important;\n  color: #6c757d !important;\n  cursor: not-allowed !important;\n}\n\n.quota-status {\n  font-size: 0.75rem;\n  color: #dc3545;\n  font-weight: 500;\n  background: #f8d7da;\n  padding: 0.2rem 0.4rem;\n  border-radius: 3px;\n}\n\n.quota-placeholder {\n  background: #f8f9fa;\n  border-left: 4px solid #dee2e6;\n}\n\n.quota-placeholder-text {\n  color: #6c757d;\n  font-style: italic;\n  font-size: 0.9rem;\n}\n\n.time-hint {\n  color: #6c757d;\n  font-size: 0.75rem;\n  margin-top: 0.25rem;\n  display: block;\n}\n\n.leave-type-main {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n}\n\n.advance-hint {\n  display: block;\n  font-size: 0.75rem;\n  color: #f59e0b;\n  margin-top: 0.25rem;\n}\n\n.advance-days-warning {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n  color: #f59e0b;\n  font-size: 0.8rem;\n  margin-top: 0.5rem;\n}\n\n.advance-days-warning i {\n  font-size: 0.9rem;\n}\n\n.date-cell {\n  width: 2.5rem;\n  height: 2.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n}\n\n.advance-day-blocked {\n  background-color: #f59e0b !important;\n  color: #fff !important;\n  font-weight: 600;\n  cursor: not-allowed;\n}\n\n.holiday-date {\n  background-color: #ef4444 !important;\n  color: #fff !important;\n  font-weight: 600;\n}\n\n.advance-calendar :deep(.p-datepicker-calendar td) {\n  padding: 0.25rem;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}