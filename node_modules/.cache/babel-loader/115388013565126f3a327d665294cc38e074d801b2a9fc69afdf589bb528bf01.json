{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport axios from '@/utils/axiosConfig';\nimport router from '@/router';\n/* eslint-disable */\nimport InputText from 'primevue/inputtext';\n// import Password from 'primevue/password';\n\nimport { useToast } from 'primevue/usetoast';\nexport default {\n  __name: 'TwoFAAuthPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const toast = useToast();\n    /* eslint-disable */\n    var isUserValid = false;\n    var isPasswordValid = false;\n    var qrcode = ref(localStorage.getItem('two-authentication'));\n    var code = ref(\"\");\n    var twofa = ref(localStorage.getItem('twofa'));\n    var secret = ref(localStorage.getItem('secret'));\n    onMounted(() => {\n      // if (localStorage.length > 0) {\n      //   localStorage.clear();\n      // \n      // qrcode = localStorage.getItem('two-authentication')\n    });\n    function handleLogin() {\n      auth(code.value);\n    }\n    function auth(code) {\n      localStorage.getItem('soc_user_id');\n      var ip = \"/auth/verifyotp\";\n      var data = {\n        \"totp\": code,\n        \"userId\": localStorage.getItem('soc_user_id')\n      };\n      axios.post(ip, data).then(function (response) {\n        localStorage.removeItem(\"two-authentication\");\n        if (response.data.status == 200) {\n          router.push(\"/dashboard\");\n        } else {\n          toast.add({\n            severity: 'error',\n            summary: 'Fail',\n            detail: 'code incorrect.',\n            life: 3000\n          });\n        }\n      }).catch(function (auth_error) {\n        if (auth_error.message == \"Network Error\") {\n          toast.add({\n            severity: 'error',\n            summary: 'Fail',\n            detail: auth_error.message,\n            life: 3000\n          });\n        } else if (auth_error.message.includes(\"timeout\")) {\n          toast.add({\n            severity: 'error',\n            summary: 'Fail',\n            detail: 'Timeout',\n            life: 3000\n          });\n        } else {\n          toast.add({\n            severity: 'error',\n            summary: 'Fail',\n            detail: 'code incorrect.',\n            life: 3000\n          });\n        }\n      });\n    }\n    const __returned__ = {\n      toast,\n      get isUserValid() {\n        return isUserValid;\n      },\n      set isUserValid(v) {\n        isUserValid = v;\n      },\n      get isPasswordValid() {\n        return isPasswordValid;\n      },\n      set isPasswordValid(v) {\n        isPasswordValid = v;\n      },\n      get qrcode() {\n        return qrcode;\n      },\n      set qrcode(v) {\n        qrcode = v;\n      },\n      get code() {\n        return code;\n      },\n      set code(v) {\n        code = v;\n      },\n      get twofa() {\n        return twofa;\n      },\n      set twofa(v) {\n        twofa = v;\n      },\n      get secret() {\n        return secret;\n      },\n      set secret(v) {\n        secret = v;\n      },\n      handleLogin,\n      auth,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get router() {\n        return router;\n      },\n      get InputText() {\n        return InputText;\n      },\n      get useToast() {\n        return useToast;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","router","InputText","useToast","toast","isUserValid","isPasswordValid","qrcode","localStorage","getItem","code","twofa","secret","handleLogin","auth","value","ip","data","post","then","response","removeItem","status","push","add","severity","summary","detail","life","catch","auth_error","message","includes"],"sources":["D:/frontend_cem/src/views/TwoFAAuthPage.vue"],"sourcesContent":["/* eslint-disable no-alert, no-console */\r\n<template>\r\n  <Toast />\r\n  <!-- <div class=\"\" style=\"margin-top: calc(20vh)\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-11 col-sm-8 col-md-6 col-xl-3 justify-content-center\">\r\n        <div class=\"card\">\r\n          <div class=\"card-header\">\r\n            <h3 class=\"text-center\">ระบบยืนยันตัวตน 2 ขั้นตอน</h3>\r\n          </div>\r\n          <div class=\"card-body\">\r\n            <form @submit.prevent=\"handleLogin\">\r\n              <div class=\" mt-3 pt-3\">\r\n                <FloatLabel>\r\n                  <InputText type=\"text\" class=\"form-control\" id=\"username\" v-model=\"username\" :invalid=\"isUserValid\" />\r\n                  <label for=\"username\">ชื่อผู้ใช้</label>\r\n                </FloatLabel>\r\n              </div>\r\n              <div class=\" mt-3 pt-3\">\r\n                <FloatLabel>\r\n                  <Password v-model=\"password\" :feedback=\"false\" id=\"password\" toggle-mask=\"\" :invalid=\"isPasswordValid\"\r\n                    class=\" w-100\" />\r\n                  <label for=\"password\">รหัสผ่าน</label>\r\n                </FloatLabel>\r\n              </div>\r\n              <div style=\"text-align: center;\">\r\n                <button type=\"submit\" class=\"btn btn-primary btn-block mt-4 w-100\">เข้าสู่ระบบ</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div> -->\r\n  <div class=\"\" style=\"margin-top: calc(5vh)\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-12 justify-content-center\">\r\n        <h2 class=\"text-center\">ระบบยืนยันตัวตน 2 ขั้นตอน</h2>\r\n        <h3 class=\"text-center\">โปรดใช้แอพ Microsoft Authenticator หรือ Google Authenticator เพื่อยืนยันตัวตนกับบัญชีของคุณ</h3>\r\n        <div v-if=\"twofa !== null && twofa == 0\">\r\n          <div class=\"row justify-content-center mt-5\">\r\n            <div class=\"col-4\">\r\n              <h4><b>ขั้นตอนที่ 1: เชื่อมต่อ Authenticator เข้ากับบัญชี</b></h4>\r\n              <h5>ทางเลือกที่ 1: เปิดแอพ เลือกเพิ่มบัญชีด้วยการสแกน QR Code และสแกน QR Code ด้านล่างนี้</h5>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"row justify-content-center\">\r\n            <div class=\"col-2 justify-content-center\" style=\"text-align: center\">\r\n              <img class=\"justify-content-center\" :src=qrcode style=\"width: 70%; height: auto;\" />\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"row justify-content-center mt-5\">\r\n            <div class=\"col-4\">\r\n              <h5>ทางเลือกที่ 2: เปิดแอพ เลือกเพิ่มบัญชีด้วยการกรอก key และกรอก key ที่อยู่ด้านล่างนี้</h5>\r\n              <h5>Key: {{secret}}</h5>\r\n            </div>\r\n          </div>\r\n          <form @submit.prevent=\"handleLogin\">\r\n            <div class=\"row justify-content-center mt-5\">\r\n              <div class=\"col-4\">\r\n                <h4><b>ขั้นตอนที่ 2: กรอกหมายเลขที่ได้รับจาก Authenticator ใส่ลงในช่องด้านล่าง</b></h4>\r\n                <!-- <FloatLabel> -->\r\n                <InputText v-model=\"code\" :feedback=\"false\" id=\"password\" toggle-mask=\"\" placeholder=\"Authentication code\"/>\r\n                <div class=\"row\">\r\n                  <div class=\"col-4\">\r\n                    <button type=\"submit\" class=\"btn btn-primary btn-block mt-3\">ยืนยัน</button>\r\n                  </div>\r\n                </div>\r\n                <!-- </FloatLabel> -->\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n        <div v-if=\"twofa !== null && twofa == 1\">\r\n          <form @submit.prevent=\"handleLogin\">\r\n            <div class=\"row justify-content-center mt-5\">\r\n              <div class=\"col-4 justify-content-center text-center\">\r\n                <img src=\"../assets/images/mobile.png\" style=\" height: 200px; margin-left: 50px;\" />\r\n                <h4 class=\"text-center mt-5\" ><b>กรอกหมายเลขที่ได้รับจาก Authenticator ใส่ลงในช่องด้านล่าง</b></h4>\r\n                <!-- <FloatLabel> -->\r\n                <InputText v-model=\"code\" :feedback=\"false\" id=\"password\" toggle-mask=\"\" placeholder=\"Authentication code\"/>\r\n                <div class=\"row justify-content-center\">\r\n                  <div class=\"col-4 justify-content-center\">\r\n                    <button type=\"submit\" class=\"btn btn-primary btn-block mt-3\">ยืนยัน</button>\r\n                  </div>\r\n                </div>\r\n                <!-- </FloatLabel> -->\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport axios from '@/utils/axiosConfig';\r\nimport router from '@/router';\r\n/* eslint-disable */\r\nimport InputText from 'primevue/inputtext';\r\n// import Password from 'primevue/password';\r\n\r\nimport { useToast } from 'primevue/usetoast';\r\n\r\nconst toast = useToast();\r\n/* eslint-disable */\r\nvar isUserValid = false;\r\nvar isPasswordValid = false;\r\nvar qrcode = ref(localStorage.getItem('two-authentication'));\r\nvar code = ref(\"\");\r\nvar twofa = ref(localStorage.getItem('twofa'));\r\nvar secret = ref(localStorage.getItem('secret'));\r\n\r\nonMounted(() => {\r\n  // if (localStorage.length > 0) {\r\n  //   localStorage.clear();\r\n  // \r\n  // qrcode = localStorage.getItem('two-authentication')\r\n});\r\nfunction handleLogin() {\r\n  auth(code.value);\r\n}\r\n\r\nfunction auth(code) {\r\n  localStorage.getItem('soc_user_id')\r\n  var ip = \"/auth/verifyotp\";\r\n  var data = {\r\n    \"totp\": code,\r\n    \"userId\": localStorage.getItem('soc_user_id')\r\n  };\r\n\r\n  axios.post(ip, data).then(function (response) {\r\n    localStorage.removeItem(\"two-authentication\");\r\n    if (response.data.status == 200) {\r\n      router.push(\"/dashboard\");\r\n    }else{\r\n      toast.add({\r\n        severity: 'error', summary: 'Fail', detail: 'code incorrect.', life: 3000\r\n      });\r\n    }\r\n  }).catch(function (auth_error) {\r\n    if (auth_error.message == \"Network Error\") {\r\n      toast.add({\r\n        severity: 'error', summary: 'Fail', detail: auth_error.message, life: 3000\r\n      });\r\n    } else if (auth_error.message.includes(\"timeout\")) {\r\n      toast.add({\r\n        severity: 'error', summary: 'Fail', detail: 'Timeout', life: 3000\r\n      });\r\n    }\r\n    else {\r\n      toast.add({\r\n        severity: 'error', summary: 'Fail', detail: 'code incorrect.', life: 3000\r\n      });\r\n    }\r\n  });\r\n}\r\n</script>\r\n\r\n<style>\r\nbody {\r\n  width: 100%;\r\n}\r\n</style>\r\n\r\n/* eslint-disable no-alert, no-console */\r\n"],"mappings":"AAmGA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,OAAOC,KAAK,MAAM,qBAAqB;AACvC,OAAOC,MAAM,MAAM,UAAU;AAC7B;AACA,OAAOC,SAAS,MAAM,oBAAoB;AAC1C;;AAEA,SAASC,QAAQ,QAAQ,mBAAmB;;;;;;;IAE5C,MAAMC,KAAK,GAAGD,QAAQ,CAAC,CAAC;IACxB;IACA,IAAIE,WAAW,GAAG,KAAK;IACvB,IAAIC,eAAe,GAAG,KAAK;IAC3B,IAAIC,MAAM,GAAGT,GAAG,CAACU,YAAY,CAACC,OAAO,CAAC,oBAAoB,CAAC,CAAC;IAC5D,IAAIC,IAAI,GAAGZ,GAAG,CAAC,EAAE,CAAC;IAClB,IAAIa,KAAK,GAAGb,GAAG,CAACU,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAC;IAC9C,IAAIG,MAAM,GAAGd,GAAG,CAACU,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAEhDV,SAAS,CAAC,MAAM;MACd;MACA;MACA;MACA;IAAA,CACD,CAAC;IACF,SAASc,WAAWA,CAAA,EAAG;MACrBC,IAAI,CAACJ,IAAI,CAACK,KAAK,CAAC;IAClB;IAEA,SAASD,IAAIA,CAACJ,IAAI,EAAE;MAClBF,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;MACnC,IAAIO,EAAE,GAAG,iBAAiB;MAC1B,IAAIC,IAAI,GAAG;QACT,MAAM,EAAEP,IAAI;QACZ,QAAQ,EAAEF,YAAY,CAACC,OAAO,CAAC,aAAa;MAC9C,CAAC;MAEDT,KAAK,CAACkB,IAAI,CAACF,EAAE,EAAEC,IAAI,CAAC,CAACE,IAAI,CAAC,UAAUC,QAAQ,EAAE;QAC5CZ,YAAY,CAACa,UAAU,CAAC,oBAAoB,CAAC;QAC7C,IAAID,QAAQ,CAACH,IAAI,CAACK,MAAM,IAAI,GAAG,EAAE;UAC/BrB,MAAM,CAACsB,IAAI,CAAC,YAAY,CAAC;QAC3B,CAAC,MAAI;UACHnB,KAAK,CAACoB,GAAG,CAAC;YACRC,QAAQ,EAAE,OAAO;YAAEC,OAAO,EAAE,MAAM;YAAEC,MAAM,EAAE,iBAAiB;YAAEC,IAAI,EAAE;UACvE,CAAC,CAAC;QACJ;MACF,CAAC,CAAC,CAACC,KAAK,CAAC,UAAUC,UAAU,EAAE;QAC7B,IAAIA,UAAU,CAACC,OAAO,IAAI,eAAe,EAAE;UACzC3B,KAAK,CAACoB,GAAG,CAAC;YACRC,QAAQ,EAAE,OAAO;YAAEC,OAAO,EAAE,MAAM;YAAEC,MAAM,EAAEG,UAAU,CAACC,OAAO;YAAEH,IAAI,EAAE;UACxE,CAAC,CAAC;QACJ,CAAC,MAAM,IAAIE,UAAU,CAACC,OAAO,CAACC,QAAQ,CAAC,SAAS,CAAC,EAAE;UACjD5B,KAAK,CAACoB,GAAG,CAAC;YACRC,QAAQ,EAAE,OAAO;YAAEC,OAAO,EAAE,MAAM;YAAEC,MAAM,EAAE,SAAS;YAAEC,IAAI,EAAE;UAC/D,CAAC,CAAC;QACJ,CAAC,MACI;UACHxB,KAAK,CAACoB,GAAG,CAAC;YACRC,QAAQ,EAAE,OAAO;YAAEC,OAAO,EAAE,MAAM;YAAEC,MAAM,EAAE,iBAAiB;YAAEC,IAAI,EAAE;UACvE,CAAC,CAAC;QACJ;MACF,CAAC,CAAC;IACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}