{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport { usePermissions } from '@/composables/usePermissions';\n\n// Lazy load components\nconst LoginPage = () => import('../views/LoginPage.vue');\nconst TwoFAAuthPage = () => import('../views/TwoFAAuthPage.vue');\nconst ProfileView = () => import('../views/profile/ProfileView.vue');\nconst CarBookingHome = () => import('../views/car_booking/car_booking.vue');\nconst LeaveWork = () => import('../views/leave_work/LeaveWork.vue');\nconst DailyWork = () => import('../views/daily_work/DailyWork.vue');\nconst Projects = () => import('../views/projects/Projects.vue');\nconst ManagementView = () => import('../views/ManagementView.vue');\nconst UserManagement = () => import('../views/management/UserManagement.vue');\nconst TaskManagement = () => import('../views/management/TaskManagement.vue');\nconst ProjectsView = () => import('../views/management/ProjectsView.vue');\nconst DailyWorkManagement = () => import('../views/management/DailyWorkManagement.vue');\nconst SystemSettings = () => import('../views/management/SystemSettings.vue');\nconst RolePermissions = () => import('../views/management/RolePermissions.vue');\nconst LeaveManagement = () => import('../views/management/LeaveManagement.vue');\nconst Dashboard = () => import('../views/management/Dashboard.vue');\nconst routes = [{\n  path: '/',\n  name: '',\n  redirect: 'daily_work'\n}, {\n  path: '/login',\n  name: 'login',\n  component: LoginPage,\n  meta: {\n    title: 'ลงชื่อเข้าใช้ - Gent-CEM'\n  }\n}, {\n  path: '/profile',\n  name: 'profile',\n  component: ProfileView,\n  meta: {\n    requiresAuth: true,\n    title: 'โปรไฟล์ - Gent-CEM'\n  }\n}, {\n  path: '/two-authentication',\n  name: 'two-authentication',\n  component: TwoFAAuthPage,\n  meta: {\n    title: 'ยืนยันตัวตน 2 ขั้นตอน - Gent-CEM'\n  }\n}, {\n  path: '/car_booking',\n  name: 'car booking',\n  component: CarBookingHome,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบเเจ้งใช้งานรถ - Gent-CEM'\n  }\n}, {\n  path: '/leave_work',\n  name: 'leave work',\n  component: LeaveWork,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบแจ้งลางาน - Gent-CEM'\n  }\n}, {\n  path: '/daily_work',\n  name: 'daily work',\n  component: DailyWork,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบลงงานรายวัน - Gent-CEM'\n  }\n}, {\n  path: '/projects',\n  name: 'projects-main',\n  component: Projects,\n  meta: {\n    requiresAuth: true,\n    title: 'โครงการ - Gent-CEM'\n  }\n}, {\n  path: '/management',\n  name: 'management',\n  component: ManagementView,\n  meta: {\n    requiresAuth: true,\n    title: 'ระบบจัดการ - Gent-CEM'\n  }\n}, {\n  path: '/management/users',\n  name: 'user-management',\n  component: UserManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการผู้ใช้งาน - Gent-CEM'\n  }\n}, {\n  path: '/management/tasks',\n  name: 'task-management',\n  component: TaskManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการงาน - Gent-CEM'\n  }\n}, {\n  path: '/management/projects',\n  name: 'management-projects',\n  component: ProjectsView,\n  meta: {\n    requiresAuth: true,\n    title: 'รายการงาน - Gent-CEM'\n  }\n}, {\n  path: '/management/daily-work',\n  name: 'daily-work-management',\n  component: DailyWorkManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'งานรายวัน - Gent-CEM'\n  }\n}, {\n  path: '/management/settings',\n  name: 'system-settings',\n  component: SystemSettings,\n  meta: {\n    requiresAuth: true,\n    title: 'ตั้งค่าระบบ - Gent-CEM'\n  }\n}, {\n  path: '/management/settings/role-permissions',\n  name: 'role-permissions',\n  component: RolePermissions,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการสิทธิ์การเข้าถึง - Gent-CEM'\n  }\n}, {\n  path: '/management/leave',\n  name: 'leave-management',\n  component: LeaveManagement,\n  meta: {\n    requiresAuth: true,\n    title: 'จัดการการลางาน - Gent-CEM'\n  }\n}, {\n  path: '/management/dashboard',\n  name: 'dashboard',\n  component: Dashboard,\n  meta: {\n    requiresAuth: true,\n    title: 'Dashboard - Gent-CEM'\n  }\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: () => {\n    // Redirect to home for any undefined routes\n    return '/daily_work';\n  }\n}];\nconst router = createRouter({\n  mode: 'history',\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// ✅ Route Guard ตรวจสอบการ Login และสิทธิ์การเข้าถึง\nrouter.beforeEach(async (to, from, next) => {\n  const userId = localStorage.getItem(\"soc_user_id\");\n  const role = localStorage.getItem(\"soc_role\");\n  if (to.meta.requiresAuth) {\n    // ตรวจสอบว่ามี userId (แทนการตรวจสอบ token)\n    if (!userId) {\n      next(\"/login\");\n      return;\n    }\n\n    // Check permissions for protected routes (except profile and login)\n    if (role && to.path !== '/profile' && to.path !== '/login' && to.path !== '/two-authentication') {\n      const {\n        loadPermissions,\n        canAccessRoute,\n        permissionsLoaded\n      } = usePermissions();\n\n      // Load permissions if not loaded yet\n      if (!permissionsLoaded.value) {\n        await loadPermissions();\n      }\n\n      // Check if user has access to this route\n      if (!canAccessRoute(to.path)) {\n        // Redirect back to previous page or home\n        if (from.path && from.path !== to.path) {\n          next(from.path);\n        } else {\n          next(\"/daily_work\");\n        }\n        return;\n      }\n    }\n    next();\n  } else {\n    next();\n  }\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","usePermissions","LoginPage","TwoFAAuthPage","ProfileView","CarBookingHome","LeaveWork","DailyWork","Projects","ManagementView","UserManagement","TaskManagement","ProjectsView","DailyWorkManagement","SystemSettings","RolePermissions","LeaveManagement","Dashboard","routes","path","name","redirect","component","meta","title","requiresAuth","router","mode","history","process","env","BASE_URL","beforeEach","to","from","next","userId","localStorage","getItem","role","loadPermissions","canAccessRoute","permissionsLoaded","value"],"sources":["D:/frontend_cem/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport { usePermissions } from '@/composables/usePermissions'\n\n// Lazy load components\nconst LoginPage = () => import('../views/LoginPage.vue')\nconst TwoFAAuthPage = () => import('../views/TwoFAAuthPage.vue')\nconst ProfileView = () => import('../views/profile/ProfileView.vue')\nconst CarBookingHome = () => import('../views/car_booking/car_booking.vue')\nconst LeaveWork = () => import('../views/leave_work/LeaveWork.vue')\nconst DailyWork = () => import('../views/daily_work/DailyWork.vue')\nconst Projects = () => import('../views/projects/Projects.vue')\nconst ManagementView = () => import('../views/ManagementView.vue')\nconst UserManagement = () => import('../views/management/UserManagement.vue')\nconst TaskManagement = () => import('../views/management/TaskManagement.vue')\nconst ProjectsView = () => import('../views/management/ProjectsView.vue')\nconst DailyWorkManagement = () => import('../views/management/DailyWorkManagement.vue')\nconst SystemSettings = () => import('../views/management/SystemSettings.vue')\nconst RolePermissions = () => import('../views/management/RolePermissions.vue')\nconst LeaveManagement = () => import('../views/management/LeaveManagement.vue')\nconst Dashboard = () => import('../views/management/Dashboard.vue')\n\nconst routes = [\n  {\n    path: '/',\n    name: '',\n    redirect: 'daily_work',\n  },\n  {\n    path: '/login',\n    name: 'login',\n    component: LoginPage,\n    meta: { title: 'ลงชื่อเข้าใช้ - Gent-CEM' },\n  },\n  {\n    path: '/profile',\n    name: 'profile',\n    component: ProfileView,\n    meta: { requiresAuth: true, title: 'โปรไฟล์ - Gent-CEM' },\n  },\n  {\n    path: '/two-authentication',\n    name: 'two-authentication',\n    component: TwoFAAuthPage,\n    meta: { title: 'ยืนยันตัวตน 2 ขั้นตอน - Gent-CEM' },\n  },\n  {\n    path: '/car_booking',\n    name: 'car booking',\n    component: CarBookingHome,\n    meta: { requiresAuth: true, title: 'ระบบเเจ้งใช้งานรถ - Gent-CEM' },\n  },\n  {\n    path: '/leave_work',\n    name: 'leave work',\n    component: LeaveWork,\n    meta: { requiresAuth: true, title: 'ระบบแจ้งลางาน - Gent-CEM' },\n  },\n  {\n    path: '/daily_work',\n    name: 'daily work',\n    component: DailyWork,\n    meta: { requiresAuth: true, title: 'ระบบลงงานรายวัน - Gent-CEM' },\n  },\n  {\n    path: '/projects',\n    name: 'projects-main',\n    component: Projects,\n    meta: { requiresAuth: true, title: 'โครงการ - Gent-CEM' },\n  },\n  {\n    path: '/management',\n    name: 'management',\n    component: ManagementView,\n    meta: { requiresAuth: true, title: 'ระบบจัดการ - Gent-CEM' },\n  },\n  {\n    path: '/management/users',\n    name: 'user-management',\n    component: UserManagement,\n    meta: { requiresAuth: true, title: 'จัดการผู้ใช้งาน - Gent-CEM' },\n  },\n  {\n    path: '/management/tasks',\n    name: 'task-management',\n    component: TaskManagement,\n    meta: { requiresAuth: true, title: 'จัดการงาน - Gent-CEM' },\n  },\n  {\n    path: '/management/projects',\n    name: 'management-projects',\n    component: ProjectsView,\n    meta: { requiresAuth: true, title: 'รายการงาน - Gent-CEM' },\n  },\n  {\n    path: '/management/daily-work',\n    name: 'daily-work-management',\n    component: DailyWorkManagement,\n    meta: { requiresAuth: true, title: 'งานรายวัน - Gent-CEM' },\n  },\n  {\n    path: '/management/settings',\n    name: 'system-settings',\n    component: SystemSettings,\n    meta: { requiresAuth: true, title: 'ตั้งค่าระบบ - Gent-CEM' },\n  },\n  {\n    path: '/management/settings/role-permissions',\n    name: 'role-permissions',\n    component: RolePermissions,\n    meta: { requiresAuth: true, title: 'จัดการสิทธิ์การเข้าถึง - Gent-CEM' },\n  },\n  {\n    path: '/management/leave',\n    name: 'leave-management',\n    component: LeaveManagement,\n    meta: { requiresAuth: true, title: 'จัดการการลางาน - Gent-CEM' },\n  },\n  {\n    path: '/management/dashboard',\n    name: 'dashboard',\n    component: Dashboard,\n    meta: { requiresAuth: true, title: 'Dashboard - Gent-CEM' },\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: () => {\n      // Redirect to home for any undefined routes\n      return '/daily_work'\n    }\n  }\n];\n\nconst router = createRouter({\n  mode: 'history',\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// ✅ Route Guard ตรวจสอบการ Login และสิทธิ์การเข้าถึง\nrouter.beforeEach(async (to, from, next) => {\n  const userId = localStorage.getItem(\"soc_user_id\");\n  const role = localStorage.getItem(\"soc_role\");\n\n  if (to.meta.requiresAuth) {\n    // ตรวจสอบว่ามี userId (แทนการตรวจสอบ token)\n    if (!userId) {\n      next(\"/login\");\n      return;\n    }\n\n    // Check permissions for protected routes (except profile and login)\n    if (role && to.path !== '/profile' && to.path !== '/login' && to.path !== '/two-authentication') {\n      const { loadPermissions, canAccessRoute, permissionsLoaded } = usePermissions();\n      \n      // Load permissions if not loaded yet\n      if (!permissionsLoaded.value) {\n        await loadPermissions();\n      }\n\n      // Check if user has access to this route\n      if (!canAccessRoute(to.path)) {\n        // Redirect back to previous page or home\n        if (from.path && from.path !== to.path) {\n          next(from.path);\n        } else {\n          next(\"/daily_work\");\n        }\n        return;\n      }\n    }\n\n    next();\n  } else {\n    next();\n  }\n});\n\nexport default router;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}