{"ast":null,"code":"import { ref } from 'vue';\nimport axios from 'axios';\nconst permissions = ref([]);\nconst permissionsLoaded = ref(false);\nexport function usePermissions() {\n  const loadPermissions = async () => {\n    try {\n      const role = localStorage.getItem('soc_role');\n      if (!role) return false;\n\n      // ไม่ต้องส่ง Authorization header (ใช้ cookie อัตโนมัติ)\n      const response = await axios.get(`/api/role-permissions/${role}`);\n      permissions.value = response.data.permissions || [];\n      permissionsLoaded.value = true;\n      return true;\n    } catch (error) {\n      // ถ้า token หมดอายุ - axios interceptor จะ handle\n\n      permissions.value = [];\n      permissionsLoaded.value = true;\n      return false;\n    }\n  };\n  const hasAccess = path => {\n    const role = localStorage.getItem('soc_role');\n\n    // Superadmin has access to everything\n    if (role === 'superadmin') return true;\n\n    // Check if permissions are loaded\n    if (!permissionsLoaded.value) return false;\n\n    // Find permission for this path\n    const permission = permissions.value.find(p => p.page_path === path);\n    return permission ? permission.has_access : false;\n  };\n  const canAccessRoute = path => {\n    return hasAccess(path);\n  };\n  const getFirstAccessibleRoute = () => {\n    const accessible = permissions.value.find(p => p.has_access);\n    return accessible ? accessible.page_path : '/profile';\n  };\n  return {\n    permissions,\n    permissionsLoaded,\n    loadPermissions,\n    hasAccess,\n    canAccessRoute,\n    getFirstAccessibleRoute\n  };\n}","map":{"version":3,"names":["ref","axios","permissions","permissionsLoaded","usePermissions","loadPermissions","role","localStorage","getItem","response","get","value","data","error","hasAccess","path","permission","find","p","page_path","has_access","canAccessRoute","getFirstAccessibleRoute","accessible"],"sources":["D:/frontend_cem/src/composables/usePermissions.js"],"sourcesContent":["import { ref } from 'vue'\nimport axios from 'axios'\n\nconst permissions = ref([])\nconst permissionsLoaded = ref(false)\n\nexport function usePermissions() {\n  const loadPermissions = async () => {\n    try {\n      const role = localStorage.getItem('soc_role')\n      if (!role) return false\n\n      // ไม่ต้องส่ง Authorization header (ใช้ cookie อัตโนมัติ)\n      const response = await axios.get(`/api/role-permissions/${role}`)\n\n      permissions.value = response.data.permissions || []\n      permissionsLoaded.value = true\n      return true\n    } catch (error) {\n      \n      \n      // ถ้า token หมดอายุ - axios interceptor จะ handle\n      \n      permissions.value = []\n      permissionsLoaded.value = true\n      return false\n    }\n  }\n\n  const hasAccess = (path) => {\n    const role = localStorage.getItem('soc_role')\n    \n    // Superadmin has access to everything\n    if (role === 'superadmin') return true\n\n    // Check if permissions are loaded\n    if (!permissionsLoaded.value) return false\n\n    // Find permission for this path\n    const permission = permissions.value.find(p => p.page_path === path)\n    return permission ? permission.has_access : false\n  }\n\n  const canAccessRoute = (path) => {\n    return hasAccess(path)\n  }\n\n  const getFirstAccessibleRoute = () => {\n    const accessible = permissions.value.find(p => p.has_access)\n    return accessible ? accessible.page_path : '/profile'\n  }\n\n  return {\n    permissions,\n    permissionsLoaded,\n    loadPermissions,\n    hasAccess,\n    canAccessRoute,\n    getFirstAccessibleRoute\n  }\n}\n"],"mappings":"AAAA,SAASA,GAAG,QAAQ,KAAK;AACzB,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,WAAW,GAAGF,GAAG,CAAC,EAAE,CAAC;AAC3B,MAAMG,iBAAiB,GAAGH,GAAG,CAAC,KAAK,CAAC;AAEpC,OAAO,SAASI,cAAcA,CAAA,EAAG;EAC/B,MAAMC,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAI;MACF,MAAMC,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MAC7C,IAAI,CAACF,IAAI,EAAE,OAAO,KAAK;;MAEvB;MACA,MAAMG,QAAQ,GAAG,MAAMR,KAAK,CAACS,GAAG,CAAC,yBAAyBJ,IAAI,EAAE,CAAC;MAEjEJ,WAAW,CAACS,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACV,WAAW,IAAI,EAAE;MACnDC,iBAAiB,CAACQ,KAAK,GAAG,IAAI;MAC9B,OAAO,IAAI;IACb,CAAC,CAAC,OAAOE,KAAK,EAAE;MAGd;;MAEAX,WAAW,CAACS,KAAK,GAAG,EAAE;MACtBR,iBAAiB,CAACQ,KAAK,GAAG,IAAI;MAC9B,OAAO,KAAK;IACd;EACF,CAAC;EAED,MAAMG,SAAS,GAAIC,IAAI,IAAK;IAC1B,MAAMT,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;;IAE7C;IACA,IAAIF,IAAI,KAAK,YAAY,EAAE,OAAO,IAAI;;IAEtC;IACA,IAAI,CAACH,iBAAiB,CAACQ,KAAK,EAAE,OAAO,KAAK;;IAE1C;IACA,MAAMK,UAAU,GAAGd,WAAW,CAACS,KAAK,CAACM,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,SAAS,KAAKJ,IAAI,CAAC;IACpE,OAAOC,UAAU,GAAGA,UAAU,CAACI,UAAU,GAAG,KAAK;EACnD,CAAC;EAED,MAAMC,cAAc,GAAIN,IAAI,IAAK;IAC/B,OAAOD,SAAS,CAACC,IAAI,CAAC;EACxB,CAAC;EAED,MAAMO,uBAAuB,GAAGA,CAAA,KAAM;IACpC,MAAMC,UAAU,GAAGrB,WAAW,CAACS,KAAK,CAACM,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACE,UAAU,CAAC;IAC5D,OAAOG,UAAU,GAAGA,UAAU,CAACJ,SAAS,GAAG,UAAU;EACvD,CAAC;EAED,OAAO;IACLjB,WAAW;IACXC,iBAAiB;IACjBE,eAAe;IACfS,SAAS;IACTO,cAAc;IACdC;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}