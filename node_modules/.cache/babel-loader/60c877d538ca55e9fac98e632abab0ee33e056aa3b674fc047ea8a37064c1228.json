{"ast":null,"code":"import { ref, computed } from 'vue';\nexport default {\n  __name: 'EnhancedDataTable',\n  props: {\n    data: {\n      type: Array,\n      required: true\n    },\n    columns: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    /* eslint-disable no-undef */\n    const props = __props;\n    const localSearch = ref('');\n    const advancedMode = ref(false);\n    const filters = ref([{\n      column: '',\n      operator: 'contains',\n      value: ''\n    }]);\n    const operators = [{\n      label: 'มีคำว่า',\n      value: 'contains'\n    }, {\n      label: 'เท่ากับ',\n      value: 'equals'\n    }, {\n      label: 'ไม่เท่ากับ',\n      value: 'notEquals'\n    }, {\n      label: 'เริ่มต้นด้วย',\n      value: 'startsWith'\n    }, {\n      label: 'ลงท้ายด้วย',\n      value: 'endsWith'\n    }, {\n      label: 'มากกว่า',\n      value: 'greaterThan'\n    }, {\n      label: 'น้อยกว่า',\n      value: 'lessThan'\n    }];\n\n    // Normalize Thai text for search - simpler version\n    const normalizeText = text => {\n      if (!text) return '';\n      return String(text).toLowerCase().trim();\n    };\n\n    // Get searchable columns\n    const searchableColumns = computed(() => {\n      return props.columns.filter(col => col.field);\n    });\n\n    // Apply single filter\n    const applyFilter = (item, filter) => {\n      const fieldValue = normalizeText(item[filter.column]);\n      const searchValue = normalizeText(filter.value);\n      switch (filter.operator) {\n        case 'contains':\n          return fieldValue.includes(searchValue);\n        case 'equals':\n          return fieldValue === searchValue;\n        case 'notEquals':\n          return fieldValue !== searchValue;\n        case 'startsWith':\n          return fieldValue.startsWith(searchValue);\n        case 'endsWith':\n          return fieldValue.endsWith(searchValue);\n        case 'greaterThan':\n          return parseFloat(fieldValue) > parseFloat(searchValue);\n        case 'lessThan':\n          return parseFloat(fieldValue) < parseFloat(searchValue);\n        default:\n          return true;\n      }\n    };\n\n    // Filter data based on search mode\n    const filteredData = computed(() => {\n      let result = props.data;\n\n      // Advanced mode: column-specific AND filters\n      if (advancedMode.value) {\n        const validFilters = filters.value.filter(f => f.column && f.value);\n        if (validFilters.length > 0) {\n          result = result.filter(item => {\n            return validFilters.every(filter => applyFilter(item, filter));\n          });\n        }\n      }\n      // Simple mode: global search - FIXED for Thai and mapped values\n      else if (localSearch.value) {\n        const query = normalizeText(localSearch.value);\n        result = result.filter(record => {\n          // Search in all fields\n          return Object.values(record).some(value => {\n            if (value === null || value === undefined) return false;\n            const strValue = normalizeText(value);\n\n            // Check if it's an object with label/value\n            if (typeof value === 'object' && value.label) {\n              return normalizeText(value.label).includes(query);\n            }\n\n            // Direct match\n            if (strValue.includes(query)) return true;\n\n            // For status/category fields, also check in slot content\n            // This allows searching by display label even if stored as code\n            return false;\n          });\n        });\n      }\n      return result;\n    });\n    const addFilter = () => {\n      filters.value.push({\n        column: '',\n        operator: 'contains',\n        value: ''\n      });\n    };\n    const removeFilter = index => {\n      if (filters.value.length > 1) {\n        filters.value.splice(index, 1);\n      }\n    };\n    const resetFilters = () => {\n      filters.value = [{\n        column: '',\n        operator: 'contains',\n        value: ''\n      }];\n    };\n    const __returned__ = {\n      props,\n      localSearch,\n      advancedMode,\n      filters,\n      operators,\n      normalizeText,\n      searchableColumns,\n      applyFilter,\n      filteredData,\n      addFilter,\n      removeFilter,\n      resetFilters,\n      ref,\n      computed\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","props","__props","localSearch","advancedMode","filters","column","operator","value","operators","label","normalizeText","text","String","toLowerCase","trim","searchableColumns","columns","filter","col","field","applyFilter","item","fieldValue","searchValue","includes","startsWith","endsWith","parseFloat","filteredData","result","data","validFilters","f","length","every","query","record","Object","values","some","undefined","strValue","addFilter","push","removeFilter","index","splice","resetFilters"],"sources":["D:/frontend_cem/src/components/EnhancedDataTable.vue"],"sourcesContent":["<template>\r\n  <div class=\"enhanced-datatable\">\r\n    <!-- Search and Column Controls -->\r\n    <div class=\"table-controls mb-3\">\r\n      <div class=\"search-box\">\r\n        <IconField iconPosition=\"left\">\r\n          <InputIcon class=\"pi pi-search\" />\r\n          <InputText v-model=\"localSearch\" placeholder=\"ค้นหาทั่วไป...\" class=\"w-full\" />\r\n        </IconField>\r\n      </div>\r\n      <div class=\"control-buttons\">\r\n        <Button \r\n          :icon=\"advancedMode ? 'pi pi-times' : 'pi pi-filter'\" \r\n          :label=\"advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง'\" \r\n          @click=\"advancedMode = !advancedMode\" \r\n          text \r\n          :severity=\"advancedMode ? 'danger' : 'info'\" \r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Advanced Search Filters -->\r\n    <div v-if=\"advancedMode\" class=\"advanced-search mb-3\">\r\n      <div v-for=\"(filter, index) in filters\" :key=\"index\" class=\"filter-row\">\r\n        <Dropdown \r\n          v-model=\"filter.column\" \r\n          :options=\"searchableColumns\" \r\n          optionLabel=\"header\" \r\n          optionValue=\"field\" \r\n          placeholder=\"เลือก Column\" \r\n          class=\"filter-column\" \r\n        />\r\n        <Dropdown \r\n          v-model=\"filter.operator\" \r\n          :options=\"operators\" \r\n          optionLabel=\"label\" \r\n          optionValue=\"value\" \r\n          placeholder=\"เงื่อนไข\" \r\n          class=\"filter-operator\" \r\n        />\r\n        <InputText \r\n          v-model=\"filter.value\" \r\n          placeholder=\"ค่าที่ค้นหา\" \r\n          class=\"filter-value\" \r\n        />\r\n        <Button \r\n          icon=\"pi pi-times\" \r\n          severity=\"danger\" \r\n          text \r\n          @click=\"removeFilter(index)\" \r\n          :disabled=\"filters.length === 1\" \r\n        />\r\n      </div>\r\n      <div class=\"filter-actions\">\r\n        <Button label=\"เพิ่มเงื่อนไข (AND)\" icon=\"pi pi-plus\" @click=\"addFilter\" text size=\"small\" />\r\n        <Button label=\"ล้าง\" icon=\"pi pi-refresh\" @click=\"resetFilters\" text size=\"small\" severity=\"secondary\" />\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Pass through DataTable with filtered data -->\r\n    <DataTable \r\n      :value=\"filteredData\" \r\n      v-bind=\"$attrs\"\r\n    >\r\n      <slot />\r\n    </DataTable>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n/* eslint-disable no-undef */\r\nimport { ref, computed } from 'vue'\r\n\r\nconst props = defineProps({\r\n  data: {\r\n    type: Array,\r\n    required: true\r\n  },\r\n  columns: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n\r\nconst localSearch = ref('')\r\nconst advancedMode = ref(false)\r\nconst filters = ref([\r\n  { column: '', operator: 'contains', value: '' }\r\n])\r\n\r\nconst operators = [\r\n  { label: 'มีคำว่า', value: 'contains' },\r\n  { label: 'เท่ากับ', value: 'equals' },\r\n  { label: 'ไม่เท่ากับ', value: 'notEquals' },\r\n  { label: 'เริ่มต้นด้วย', value: 'startsWith' },\r\n  { label: 'ลงท้ายด้วย', value: 'endsWith' },\r\n  { label: 'มากกว่า', value: 'greaterThan' },\r\n  { label: 'น้อยกว่า', value: 'lessThan' }\r\n]\r\n\r\n// Normalize Thai text for search - simpler version\r\nconst normalizeText = (text) => {\r\n  if (!text) return ''\r\n  return String(text).toLowerCase().trim()\r\n}\r\n\r\n// Get searchable columns\r\nconst searchableColumns = computed(() => {\r\n  return props.columns.filter(col => col.field)\r\n})\r\n\r\n// Apply single filter\r\nconst applyFilter = (item, filter) => {\r\n  const fieldValue = normalizeText(item[filter.column])\r\n  const searchValue = normalizeText(filter.value)\r\n\r\n  switch (filter.operator) {\r\n    case 'contains':\r\n      return fieldValue.includes(searchValue)\r\n    case 'equals':\r\n      return fieldValue === searchValue\r\n    case 'notEquals':\r\n      return fieldValue !== searchValue\r\n    case 'startsWith':\r\n      return fieldValue.startsWith(searchValue)\r\n    case 'endsWith':\r\n      return fieldValue.endsWith(searchValue)\r\n    case 'greaterThan':\r\n      return parseFloat(fieldValue) > parseFloat(searchValue)\r\n    case 'lessThan':\r\n      return parseFloat(fieldValue) < parseFloat(searchValue)\r\n    default:\r\n      return true\r\n  }\r\n}\r\n\r\n// Filter data based on search mode\r\nconst filteredData = computed(() => {\r\n  let result = props.data\r\n\r\n  // Advanced mode: column-specific AND filters\r\n  if (advancedMode.value) {\r\n    const validFilters = filters.value.filter(f => f.column && f.value)\r\n    \r\n    if (validFilters.length > 0) {\r\n      result = result.filter(item => {\r\n        return validFilters.every(filter => applyFilter(item, filter))\r\n      })\r\n    }\r\n  } \r\n  // Simple mode: global search - FIXED for Thai and mapped values\r\n  else if (localSearch.value) {\r\n    const query = normalizeText(localSearch.value)\r\n    result = result.filter(record => {\r\n      // Search in all fields\r\n      return Object.values(record).some((value) => {\r\n        if (value === null || value === undefined) return false\r\n        const strValue = normalizeText(value)\r\n        \r\n        // Check if it's an object with label/value\r\n        if (typeof value === 'object' && value.label) {\r\n          return normalizeText(value.label).includes(query)\r\n        }\r\n        \r\n        // Direct match\r\n        if (strValue.includes(query)) return true\r\n        \r\n        // For status/category fields, also check in slot content\r\n        // This allows searching by display label even if stored as code\r\n        return false\r\n      })\r\n    })\r\n  }\r\n\r\n  return result\r\n})\r\n\r\nconst addFilter = () => {\r\n  filters.value.push({ column: '', operator: 'contains', value: '' })\r\n}\r\n\r\nconst removeFilter = (index) => {\r\n  if (filters.value.length > 1) {\r\n    filters.value.splice(index, 1)\r\n  }\r\n}\r\n\r\nconst resetFilters = () => {\r\n  filters.value = [{ column: '', operator: 'contains', value: '' }]\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.table-controls {\r\n  display: flex;\r\n  gap: 1rem;\r\n  margin-bottom: 1rem;\r\n  flex-wrap: wrap;\r\n  align-items: center;\r\n}\r\n\r\n.search-box {\r\n  flex: 1;\r\n  min-width: 250px;\r\n}\r\n\r\n.column-options {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n  padding: 0.5rem;\r\n  min-width: 200px;\r\n  max-height: 400px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.column-option {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.column-option label {\r\n  cursor: pointer;\r\n  user-select: none;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.control-buttons {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.advanced-search {\r\n  background: #f8f9fa;\r\n  border: 1px solid #dee2e6;\r\n  border-radius: 8px;\r\n  padding: 1rem;\r\n}\r\n\r\n.filter-row {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1.5fr 2fr auto;\r\n  gap: 0.5rem;\r\n  align-items: center;\r\n  margin-bottom: 0.75rem;\r\n}\r\n\r\n.filter-column,\r\n.filter-operator,\r\n.filter-value {\r\n  width: 100%;\r\n}\r\n\r\n.filter-actions {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  padding-top: 0.5rem;\r\n  border-top: 1px solid #dee2e6;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .table-controls {\r\n    flex-direction: column;\r\n    align-items: stretch;\r\n  }\r\n\r\n  .search-box {\r\n    width: 100%;\r\n  }\r\n  \r\n  .control-buttons {\r\n    width: 100%;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .filter-row {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .filter-actions {\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}