{"ast":null,"code":"import { ref } from 'vue';\nimport axios from 'axios';\nconst permissions = ref([]);\nconst permissionsLoaded = ref(false);\nexport function usePermissions() {\n  const loadPermissions = async () => {\n    try {\n      const role = localStorage.getItem('soc_role');\n      if (!role) return false;\n\n      // ไม่ต้องส่ง Authorization header (ใช้ cookie อัตโนมัติ)\n      const response = await axios.get(`/api/role-permissions/${role}`);\n      permissions.value = response.data.permissions || [];\n      permissionsLoaded.value = true;\n      return true;\n    } catch (error) {\n      console.error('Error loading permissions:', error);\n\n      // ถ้า token หมดอายุ - axios interceptor จะ handle\n\n      permissions.value = [];\n      permissionsLoaded.value = true;\n      return false;\n    }\n  };\n  const hasAccess = path => {\n    const role = localStorage.getItem('soc_role');\n\n    // Superadmin has access to everything\n    if (role === 'superadmin') return true;\n\n    // Check if permissions are loaded\n    if (!permissionsLoaded.value) return false;\n\n    // Find permission for this path\n    const permission = permissions.value.find(p => p.page_path === path);\n    return permission ? permission.has_access : false;\n  };\n  const canAccessRoute = path => {\n    return hasAccess(path);\n  };\n  const getFirstAccessibleRoute = () => {\n    const accessible = permissions.value.find(p => p.has_access);\n    return accessible ? accessible.page_path : '/profile';\n  };\n  return {\n    permissions,\n    permissionsLoaded,\n    loadPermissions,\n    hasAccess,\n    canAccessRoute,\n    getFirstAccessibleRoute\n  };\n}","map":{"version":3,"names":["ref","axios","permissions","permissionsLoaded","usePermissions","loadPermissions","role","localStorage","getItem","response","get","value","data","error","console","hasAccess","path","permission","find","p","page_path","has_access","canAccessRoute","getFirstAccessibleRoute","accessible"],"sources":["D:/GEN-T/WEB/GenT-CEM/frontend_cem/src/composables/usePermissions.js"],"sourcesContent":["import { ref } from 'vue'\r\nimport axios from 'axios'\r\n\r\nconst permissions = ref([])\r\nconst permissionsLoaded = ref(false)\r\n\r\nexport function usePermissions() {\r\n  const loadPermissions = async () => {\r\n    try {\r\n      const role = localStorage.getItem('soc_role')\r\n      if (!role) return false\r\n\r\n      // ไม่ต้องส่ง Authorization header (ใช้ cookie อัตโนมัติ)\r\n      const response = await axios.get(`/api/role-permissions/${role}`)\r\n\r\n      permissions.value = response.data.permissions || []\r\n      permissionsLoaded.value = true\r\n      return true\r\n    } catch (error) {\r\n      console.error('Error loading permissions:', error)\r\n      \r\n      // ถ้า token หมดอายุ - axios interceptor จะ handle\r\n      \r\n      permissions.value = []\r\n      permissionsLoaded.value = true\r\n      return false\r\n    }\r\n  }\r\n\r\n  const hasAccess = (path) => {\r\n    const role = localStorage.getItem('soc_role')\r\n    \r\n    // Superadmin has access to everything\r\n    if (role === 'superadmin') return true\r\n\r\n    // Check if permissions are loaded\r\n    if (!permissionsLoaded.value) return false\r\n\r\n    // Find permission for this path\r\n    const permission = permissions.value.find(p => p.page_path === path)\r\n    return permission ? permission.has_access : false\r\n  }\r\n\r\n  const canAccessRoute = (path) => {\r\n    return hasAccess(path)\r\n  }\r\n\r\n  const getFirstAccessibleRoute = () => {\r\n    const accessible = permissions.value.find(p => p.has_access)\r\n    return accessible ? accessible.page_path : '/profile'\r\n  }\r\n\r\n  return {\r\n    permissions,\r\n    permissionsLoaded,\r\n    loadPermissions,\r\n    hasAccess,\r\n    canAccessRoute,\r\n    getFirstAccessibleRoute\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,GAAG,QAAQ,KAAK;AACzB,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,WAAW,GAAGF,GAAG,CAAC,EAAE,CAAC;AAC3B,MAAMG,iBAAiB,GAAGH,GAAG,CAAC,KAAK,CAAC;AAEpC,OAAO,SAASI,cAAcA,CAAA,EAAG;EAC/B,MAAMC,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAI;MACF,MAAMC,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MAC7C,IAAI,CAACF,IAAI,EAAE,OAAO,KAAK;;MAEvB;MACA,MAAMG,QAAQ,GAAG,MAAMR,KAAK,CAACS,GAAG,CAAC,yBAAyBJ,IAAI,EAAE,CAAC;MAEjEJ,WAAW,CAACS,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACV,WAAW,IAAI,EAAE;MACnDC,iBAAiB,CAACQ,KAAK,GAAG,IAAI;MAC9B,OAAO,IAAI;IACb,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;;MAElD;;MAEAX,WAAW,CAACS,KAAK,GAAG,EAAE;MACtBR,iBAAiB,CAACQ,KAAK,GAAG,IAAI;MAC9B,OAAO,KAAK;IACd;EACF,CAAC;EAED,MAAMI,SAAS,GAAIC,IAAI,IAAK;IAC1B,MAAMV,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;;IAE7C;IACA,IAAIF,IAAI,KAAK,YAAY,EAAE,OAAO,IAAI;;IAEtC;IACA,IAAI,CAACH,iBAAiB,CAACQ,KAAK,EAAE,OAAO,KAAK;;IAE1C;IACA,MAAMM,UAAU,GAAGf,WAAW,CAACS,KAAK,CAACO,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,SAAS,KAAKJ,IAAI,CAAC;IACpE,OAAOC,UAAU,GAAGA,UAAU,CAACI,UAAU,GAAG,KAAK;EACnD,CAAC;EAED,MAAMC,cAAc,GAAIN,IAAI,IAAK;IAC/B,OAAOD,SAAS,CAACC,IAAI,CAAC;EACxB,CAAC;EAED,MAAMO,uBAAuB,GAAGA,CAAA,KAAM;IACpC,MAAMC,UAAU,GAAGtB,WAAW,CAACS,KAAK,CAACO,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACE,UAAU,CAAC;IAC5D,OAAOG,UAAU,GAAGA,UAAU,CAACJ,SAAS,GAAG,UAAU;EACvD,CAAC;EAED,OAAO;IACLlB,WAAW;IACXC,iBAAiB;IACjBE,eAAe;IACfU,SAAS;IACTO,cAAc;IACdC;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}