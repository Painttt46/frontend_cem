{"ast":null,"code":"import axios from '@/utils/axiosConfig';\nimport AutoComplete from 'primevue/autocomplete';\nexport default {\n  name: 'LeaveForm',\n  components: {\n    AutoComplete\n  },\n  async created() {\n    await this.loadLeaveTypes();\n    await this.loadUsers();\n    await this.loadQuotaData();\n    // Initialize with limited users\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n  },\n  data() {\n    return {\n      formData: {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      },\n      leaveTypes: [],\n      delegationOptions: [{\n        label: 'ไม่มีการมอบหมายงาน',\n        value: 'no'\n      }, {\n        label: 'มีการมอบหมายงาน',\n        value: 'yes'\n      }],\n      users: [],\n      filteredUsers: [],\n      selectedDelegate: null,\n      maxDisplayUsers: 50,\n      quotaData: {},\n      selectedQuota: null\n    };\n  },\n  computed: {\n    currentUserName() {\n      const firstName = localStorage.getItem('soc_firstname') || '';\n      const lastName = localStorage.getItem('soc_lastname') || '';\n      return `${firstName} ${lastName}`.trim();\n    },\n    currentUserRole() {\n      return localStorage.getItem('soc_role') || '';\n    },\n    currentUserPosition() {\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง';\n    },\n    calculateDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n        start.setHours(0, 0, 0, 0);\n        end.setHours(0, 0, 0, 0);\n        let count = 0;\n        const current = new Date(start);\n        while (current <= end) {\n          const day = current.getDay();\n          if (day !== 0 && day !== 6) count++; // ไม่นับ อาทิตย์(0) และ เสาร์(6)\n          current.setDate(current.getDate() + 1);\n        }\n        return count + ' วัน';\n      }\n      return '0 วัน';\n    },\n    leaveTypesWithQuota() {\n      return this.leaveTypes.map(type => {\n        const quota = this.quotaData[type.value];\n        const disabled = quota && quota.remainingDays <= 0;\n        return {\n          ...type,\n          disabled: disabled\n        };\n      });\n    }\n  },\n  methods: {\n    async loadLeaveTypes() {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        this.leaveTypes = response.data;\n      } catch (error) {\n        // Fallback to default types if API fails\n        this.leaveTypes = [{\n          label: 'ลาป่วย',\n          value: 'sick'\n        }, {\n          label: 'ลากิจ',\n          value: 'personal'\n        }, {\n          label: 'ลาพักร้อน',\n          value: 'vacation'\n        }];\n      }\n    },\n    optionDisabled(option) {\n      return option.disabled;\n    },\n    async loadQuotaData() {\n      try {\n        const userId = localStorage.getItem('soc_user_id');\n        const response = await axios.get(`/api/leave/quota/${userId}`);\n        this.quotaData = response.data;\n\n        // Update selected quota if leave type is already selected\n        if (this.formData.leaveType) {\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\n        }\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'ไม่สามารถโหลดข้อมูลโควต้าได้',\n          life: 3000\n        });\n      }\n    },\n    onLeaveTypeChange() {\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\n      } else {\n        this.selectedQuota = null;\n      }\n    },\n    getQuotaClass(remainingDays) {\n      if (remainingDays <= 0) return 'quota-zero';\n      if (remainingDays <= 2) return 'quota-low';\n      return 'quota-normal';\n    },\n    async submitForm() {\n      if (!this.formData.leaveType) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'กรุณาเลือกประเภทการลา',\n          life: 3000\n        });\n        return;\n      }\n\n      // Check quota before submitting\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'โควต้าการลาประเภทนี้หมดแล้ว',\n          life: 3000\n        });\n        return;\n      }\n\n      // Check if requested days exceed remaining quota\n      const requestedDays = this.calculateTotalDays();\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: `จำนวนวันที่ขอลา (${requestedDays} วัน) เกินโควต้าคงเหลือ (${this.selectedQuota.remainingDays} วัน)`,\n          life: 3000\n        });\n        return;\n      }\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'ข้อผิดพลาด',\n            detail: 'วันสิ้นสุดการลาต้องไม่เป็นวันก่อนวันเริ่มลา',\n            life: 3000\n          });\n          return;\n        }\n      }\n      try {\n        // Upload files first if any\n        let uploadedFiles = [];\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\n          const formData = new FormData();\n          this.formData.attachments.forEach(file => {\n            formData.append('files', file);\n          });\n          const uploadResponse = await axios.post('/api/files/upload', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          uploadedFiles = uploadResponse.data.files;\n        }\n\n        // Calculate total days\n        const totalDays = this.calculateTotalDays();\n\n        // Prepare data for API\n        const leaveData = {\n          user_id: localStorage.getItem('soc_user_id'),\n          leave_type: this.formData.leaveType,\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\n          total_days: totalDays,\n          reason: this.formData.reason || 'ไม่ระบุ',\n          has_delegation: this.formData.delegationOption === 'yes',\n          delegate_name: this.formData.delegateName || null,\n          delegate_position: this.formData.delegatePosition || null,\n          delegate_department: this.formData.delegateDepartment || null,\n          delegate_contact: this.formData.delegateContact || null,\n          work_details: this.formData.workDetails || null,\n          attachments: uploadedFiles\n        };\n\n        // Send to backend\n        const response = await axios.post('/api/leave', leaveData, {\n          headers: {}\n        });\n        this.$toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\n          life: 3000\n        });\n        this.$emit('submit-leave', response.data);\n        this.resetForm();\n      } catch (error) {\n        let errorMessage = 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง';\n        if (error.response?.data?.error) {\n          errorMessage = error.response.data.error;\n        } else if (error.message) {\n          errorMessage = error.message;\n        }\n        this.$toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: errorMessage,\n          life: 5000\n        });\n      }\n    },\n    calculateTotalDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n        start.setHours(0, 0, 0, 0);\n        end.setHours(0, 0, 0, 0);\n        let count = 0;\n        const current = new Date(start);\n        while (current <= end) {\n          const day = current.getDay();\n          if (day !== 0 && day !== 6) count++;\n          current.setDate(current.getDate() + 1);\n        }\n        return count;\n      }\n      return 0;\n    },\n    formatDateTime(date) {\n      if (!date) return null;\n      return new Date(date).toISOString();\n    },\n    resetForm() {\n      this.formData = {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      };\n      this.selectedDelegate = null;\n    },\n    handleFileUpload(event) {\n      const files = Array.from(event.target.files);\n      this.formData.attachments = [...this.formData.attachments, ...files];\n    },\n    removeFile(index) {\n      this.formData.attachments.splice(index, 1);\n    },\n    async loadUsers() {\n      try {\n        const response = await axios.get('/api/users');\n        if (response.data && Array.isArray(response.data)) {\n          // กรองผู้ใช้ปัจจุบันออก\n          const currentUserName = this.currentUserName;\n          this.users = response.data.filter(user => {\n            const userName = `${user.firstname} ${user.lastname}`.trim();\n            return userName !== currentUserName;\n          }).map(user => ({\n            ...user,\n            displayName: `${user.firstname} ${user.lastname}`.trim()\n          }));\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n        } else {\n          this.setFallbackUsers();\n        }\n      } catch (error) {\n        this.setFallbackUsers();\n      }\n    },\n    setFallbackUsers() {\n      this.users = [{\n        id: 1,\n        username: 'admin',\n        firstname: 'Admin',\n        lastname: 'User',\n        role: 'admin',\n        displayName: 'Admin User'\n      }, {\n        id: 2,\n        username: 'hr',\n        firstname: 'HR',\n        lastname: 'Manager',\n        role: 'hr',\n        displayName: 'HR Manager'\n      }, {\n        id: 3,\n        username: 'john',\n        firstname: 'John',\n        lastname: 'Doe',\n        role: 'user',\n        displayName: 'John Doe'\n      }];\n      this.filteredUsers = this.users;\n    },\n    searchUsers(event) {\n      const query = event.query.toLowerCase().trim();\n      if (query === '') {\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n      } else {\n        // ค้นหาและจำกัดผลลัพธ์\n        const filtered = this.users.filter(user => user.displayName.toLowerCase().includes(query) || user.username.toLowerCase().includes(query) || user.position && user.position.toLowerCase().includes(query) || user.department && user.department.toLowerCase().includes(query));\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers);\n      }\n    },\n    showAllUsers() {\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n    },\n    onDelegateSelect(event) {\n      const user = event.value;\n      if (user) {\n        this.formData.delegateName = user.displayName;\n        this.formData.delegatePosition = user.position || '';\n        this.formData.delegateDepartment = user.department || '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","AutoComplete","name","components","created","loadLeaveTypes","loadUsers","loadQuotaData","filteredUsers","users","slice","maxDisplayUsers","data","formData","leaveType","startDateTime","endDateTime","reason","delegationOption","delegateName","delegatePosition","delegateDepartment","delegateContact","workDetails","attachments","leaveTypes","delegationOptions","label","value","selectedDelegate","quotaData","selectedQuota","computed","currentUserName","firstName","localStorage","getItem","lastName","trim","currentUserRole","currentUserPosition","calculateDays","start","Date","end","setHours","count","current","day","getDay","setDate","getDate","leaveTypesWithQuota","map","type","quota","disabled","remainingDays","methods","response","get","error","optionDisabled","option","userId","$toast","add","severity","summary","detail","life","onLeaveTypeChange","getQuotaClass","submitForm","requestedDays","calculateTotalDays","uploadedFiles","length","FormData","forEach","file","append","uploadResponse","post","headers","files","totalDays","leaveData","user_id","leave_type","start_datetime","formatDateTime","end_datetime","total_days","has_delegation","delegate_name","delegate_position","delegate_department","delegate_contact","work_details","$emit","resetForm","errorMessage","message","date","toISOString","handleFileUpload","event","Array","from","target","removeFile","index","splice","isArray","filter","user","userName","firstname","lastname","displayName","setFallbackUsers","id","username","role","searchUsers","query","toLowerCase","filtered","includes","position","department","showAllUsers","onDelegateSelect"],"sources":["D:\\frontend_cem\\src\\views\\leave_work\\LeaveForm.vue"],"sourcesContent":["<template>\n  <div>\n    <Toast />\n    <Card class=\"form-card\">\n    <template #content>\n      <form @submit.prevent=\"submitForm\" class=\"leave-form\">\n        <div class=\"form-grid\">\n          <div class=\"input-group\">\n            <label for=\"name\" class=\"input-label\">ชื่อ-นามสกุล</label>\n            <InputText id=\"name\" :value=\"currentUserName\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"position\" class=\"input-label\">ตำแหน่ง</label>\n            <InputText id=\"position\" :value=\"currentUserPosition\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"leaveType\" class=\"input-label\">ประเภทการลา *</label>\n            <Dropdown v-model=\"formData.leaveType\" :options=\"leaveTypesWithQuota\" optionLabel=\"label\" optionValue=\"value\"\n              :optionDisabled=\"optionDisabled\" class=\"corporate-dropdown\" required @change=\"onLeaveTypeChange\">\n              <template #option=\"slotProps\">\n                <div class=\"leave-type-option\" :class=\"{ 'disabled-option': slotProps.option.disabled }\">\n                  <span>{{ slotProps.option.label }}</span>\n                  <span v-if=\"slotProps.option.disabled\" class=\"quota-status\">หมดโควต้า</span>\n                </div>\n              </template>\n            </Dropdown>\n          </div>\n\n          <!-- Quota Display -->\n          <div class=\"quota-display\" :class=\"{ 'quota-placeholder': !selectedQuota }\">\n            <div v-if=\"selectedQuota\" class=\"quota-info\">\n              <span class=\"quota-label\">โควต้าคงเหลือ:</span>\n              <span class=\"quota-value\" :class=\"getQuotaClass(selectedQuota.remainingDays)\">\n                {{ selectedQuota.remainingDays }} วัน ({{ selectedQuota.remainingHours }} ชม.)\n              </span>\n              <span class=\"quota-total\">(จาก {{ selectedQuota.quota }} วัน / {{ selectedQuota.quotaHours }} ชม.)</span>\n            </div>\n            <div v-else class=\"quota-placeholder-text\">\n              เลือกประเภทการลาเพื่อดูโควต้า\n            </div>\n          </div>\n\n          <div class=\"input-group date-range-group\">\n            <div class=\"date-field\">\n              <label for=\"startDateTime\" class=\"input-label\">วันเวลาเริ่มลา *</label>\n              <Calendar v-model=\"formData.startDateTime\" showTime hourFormat=\"24\" dateFormat=\"dd/mm/yy\"\n                class=\"corporate-input\" :manualInput=\"false\" :stepMinute=\"30\" required\n                :minDate=\"new Date()\" @date-select=\"validateTime('start')\" @blur=\"validateTime('start')\" />\n              <small class=\"time-hint\">เวลาทำการ: 09:00-12:00, 13:00-18:00</small>\n            </div>\n            <div class=\"date-field\">\n              <label for=\"endDateTime\" class=\"input-label\">วันเวลาสิ้นสุดการลา *</label>\n              <Calendar v-model=\"formData.endDateTime\" showTime hourFormat=\"24\" dateFormat=\"dd/mm/yy\"\n                :minDate=\"formData.startDateTime\" class=\"corporate-input\" :manualInput=\"false\" :stepMinute=\"30\" required\n                @date-select=\"validateTime('end')\" @blur=\"validateTime('end')\" />\n              <small class=\"time-hint\">เวลาทำการ: 09:00-12:00, 13:00-18:00</small>\n            </div>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"totalDays\" class=\"input-label\">จำนวนวันลา</label>\n            <InputText id=\"totalDays\" :value=\"calculateDays\" readonly class=\"corporate-input readonly-field\" />\n          </div>\n\n          <div class=\"input-group full-width\">\n            <label for=\"reason\" class=\"input-label\">เหตุผลการลา</label>\n            <Textarea id=\"reason\" v-model=\"formData.reason\" rows=\"3\" class=\"corporate-input\" />\n          </div>\n\n          <div class=\"input-group full-width\">\n            <label class=\"input-label\">แนบเอกสารประกอบ (Attachments)</label>\n            <div class=\"file-upload-wrapper\">\n              <input ref=\"fileInput\" @change=\"handleFileUpload\" type=\"file\"\n                accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif\" multiple class=\"file-input\" id=\"attachments\">\n              <Button type=\"button\"\n                :label=\"formData.attachments?.length > 0 ? `เลือกแล้ว ${formData.attachments.length} ไฟล์` : 'เลือกไฟล์'\"\n                icon=\"pi pi-upload\" severity=\"secondary\" outlined @click=\"$refs.fileInput.click()\" />\n            </div>\n            <div v-if=\"formData.attachments?.length > 0\" class=\"file-list\">\n              <div v-for=\"(file, index) in formData.attachments\" :key=\"index\" class=\"file-item\">\n                <i class=\"pi pi-file\"></i>\n                <span class=\"file-name\">{{ file.name }}</span>\n                <Button icon=\"pi pi-times\" severity=\"danger\" text size=\"small\" @click=\"removeFile(index)\" />\n              </div>\n            </div>\n          </div>\n\n          <div class=\"input-group\">\n            <label for=\"delegationOption\" class=\"input-label\">มอบหมายงานระหว่างลา *</label>\n            <Dropdown v-model=\"formData.delegationOption\" :options=\"delegationOptions\" optionLabel=\"label\"\n              optionValue=\"value\" class=\"corporate-dropdown\" required />\n          </div>\n\n          <template v-if=\"formData.delegationOption === 'yes'\">\n            <div class=\"input-group\">\n              <label for=\"delegateUser\" class=\"input-label\">ชื่อผู้รับผิดชอบงานแทน *</label>\n              <AutoComplete \n                v-model=\"selectedDelegate\" \n                :suggestions=\"filteredUsers\" \n                @complete=\"searchUsers\" \n                @item-select=\"onDelegateSelect\"\n                @dropdown-click=\"showAllUsers\"\n                optionLabel=\"displayName\" \n                placeholder=\"ค้นหาหรือเลือกพนักงาน...\" \n                class=\"corporate-input\"\n                :dropdown=\"true\"\n                :forceSelection=\"true\"\n                :scrollHeight=\"200\"\n                required\n              >\n                <template #option=\"slotProps\">\n                  <div class=\"user-option\">\n                    <div class=\"user-name\">{{ slotProps.option.displayName }}</div>\n                    <div class=\"user-role\">{{ slotProps.option.position }} - {{ slotProps.option.department }}</div>\n                  </div>\n                </template>\n              </AutoComplete>\n            </div>\n\n            <div class=\"input-group\">\n              <label for=\"delegatePosition\" class=\"input-label\">ตำแหน่ง</label>\n              <InputText \n                id=\"delegatePosition\" \n                :value=\"formData.delegatePosition\" \n                readonly \n                class=\"corporate-input readonly-field\" \n              />\n            </div>\n\n            <div class=\"input-group\">\n              <label for=\"delegateDepartment\" class=\"input-label\">แผนก</label>\n              <InputText \n                id=\"delegateDepartment\" \n                :value=\"formData.delegateDepartment\" \n                readonly \n                class=\"corporate-input readonly-field\" \n              />\n            </div>\n            <div class=\"input-group full-width\">\n              <label for=\"delegateContact\" class=\"input-label\">ช่องทางติดต่อผู้รับผิดชอบงานเเทน *</label>\n              <InputText id=\"delegateContact\" v-model=\"formData.delegateContact\"\n                placeholder=\"เบอร์โทร, อีเมล, หรือช่องทางอื่นๆ\" required class=\"corporate-input\" />\n            </div>\n\n            <div class=\"input-group full-width\">\n              <label for=\"workDetails\" class=\"input-label\">รายละเอียดงานที่มอบหมาย *</label>\n              <Textarea id=\"workDetails\" v-model=\"formData.workDetails\" rows=\"4\" \n                placeholder=\"ระบุรายละเอียดงานที่ต้องดำเนินการระหว่างลา...\" \n                required class=\"corporate-input\" />\n            </div>\n\n          </template>\n        </div>\n\n        <Divider />\n\n        <div class=\"form-actions\">\n          <Button type=\"button\" label=\"ล้างข้อมูล\" icon=\"pi pi-refresh\" severity=\"secondary\" outlined\n            @click=\"resetForm\" />\n          <Button type=\"submit\" label=\"ส่งคำขอลางาน\" icon=\"pi pi-check\" severity=\"success\" />\n        </div>\n      </form>\n    </template>\n  </Card>\n  </div>\n</template>\n\n<script>\nimport axios from '@/utils/axiosConfig'\nimport AutoComplete from 'primevue/autocomplete'\n\nexport default {\n  name: 'LeaveForm',\n  components: {\n    AutoComplete\n  },\n  async created() {\n    await this.loadLeaveTypes();\n    await this.loadUsers();\n    await this.loadQuotaData();\n    // Initialize with limited users\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n  },\n  data() {\n    return {\n      formData: {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      },\n      leaveTypes: [],\n      delegationOptions: [\n        { label: 'ไม่มีการมอบหมายงาน', value: 'no' },\n        { label: 'มีการมอบหมายงาน', value: 'yes' }\n      ],\n      users: [],\n      filteredUsers: [],\n      selectedDelegate: null,\n      maxDisplayUsers: 50,\n      quotaData: {},\n      selectedQuota: null\n    }\n  },\n  computed: {\n    currentUserName() {\n      const firstName = localStorage.getItem('soc_firstname') || ''\n      const lastName = localStorage.getItem('soc_lastname') || ''\n      return `${firstName} ${lastName}`.trim()\n    },\n    currentUserRole() {\n      return localStorage.getItem('soc_role') || ''\n    },\n    currentUserPosition() {\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง'\n    },\n    calculateDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime)\n        const end = new Date(this.formData.endDateTime)\n        \n        start.setHours(0, 0, 0, 0)\n        end.setHours(0, 0, 0, 0)\n        \n        let count = 0\n        const current = new Date(start)\n        while (current <= end) {\n          const day = current.getDay()\n          if (day !== 0 && day !== 6) count++ // ไม่นับ อาทิตย์(0) และ เสาร์(6)\n          current.setDate(current.getDate() + 1)\n        }\n        return count + ' วัน'\n      }\n      return '0 วัน'\n    },\n    leaveTypesWithQuota() {\n      return this.leaveTypes.map(type => {\n        const quota = this.quotaData[type.value];\n        const disabled = quota && quota.remainingDays <= 0;\n        return {\n          ...type,\n          disabled: disabled\n        };\n      });\n    }\n  },\n  methods: {\n    async loadLeaveTypes() {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        this.leaveTypes = response.data;\n      } catch (error) {\n        \n        // Fallback to default types if API fails\n        this.leaveTypes = [\n          { label: 'ลาป่วย', value: 'sick' },\n          { label: 'ลากิจ', value: 'personal' },\n          { label: 'ลาพักร้อน', value: 'vacation' }\n        ];\n      }\n    },\n    optionDisabled(option) {\n      return option.disabled;\n    },\n\n    async loadQuotaData() {\n      try {\n        const userId = localStorage.getItem('soc_user_id');\n        const response = await axios.get(`/api/leave/quota/${userId}`);\n        this.quotaData = response.data;\n        \n        // Update selected quota if leave type is already selected\n        if (this.formData.leaveType) {\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\n        }\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'ไม่สามารถโหลดข้อมูลโควต้าได้',\n          life: 3000\n        });\n      }\n    },\n\n    onLeaveTypeChange() {\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\n      } else {\n        this.selectedQuota = null;\n      }\n    },\n\n    getQuotaClass(remainingDays) {\n      if (remainingDays <= 0) return 'quota-zero';\n      if (remainingDays <= 2) return 'quota-low';\n      return 'quota-normal';\n    },\n\n    async submitForm() {\n      if (!this.formData.leaveType) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'กรุณาเลือกประเภทการลา',\n          life: 3000\n        })\n        return\n      }\n\n      // Check quota before submitting\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'โควต้าการลาประเภทนี้หมดแล้ว',\n          life: 3000\n        })\n        return\n      }\n\n      // Check if requested days exceed remaining quota\n      const requestedDays = this.calculateTotalDays();\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: `จำนวนวันที่ขอลา (${requestedDays} วัน) เกินโควต้าคงเหลือ (${this.selectedQuota.remainingDays} วัน)`,\n          life: 3000\n        })\n        return\n      }\n\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'ข้อผิดพลาด',\n            detail: 'วันสิ้นสุดการลาต้องไม่เป็นวันก่อนวันเริ่มลา',\n            life: 3000\n          })\n          return\n        }\n      }\n\n      try {\n        // Upload files first if any\n        let uploadedFiles = []\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\n          const formData = new FormData()\n          this.formData.attachments.forEach(file => {\n            formData.append('files', file)\n          })\n          \n          const uploadResponse = await axios.post('/api/files/upload', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          })\n          uploadedFiles = uploadResponse.data.files\n        }\n\n        // Calculate total days\n        const totalDays = this.calculateTotalDays();\n        \n        // Prepare data for API\n        const leaveData = {\n          user_id: localStorage.getItem('soc_user_id'),\n          leave_type: this.formData.leaveType,\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\n          total_days: totalDays,\n          reason: this.formData.reason || 'ไม่ระบุ',\n          has_delegation: this.formData.delegationOption === 'yes',\n          delegate_name: this.formData.delegateName || null,\n          delegate_position: this.formData.delegatePosition || null,\n          delegate_department: this.formData.delegateDepartment || null,\n          delegate_contact: this.formData.delegateContact || null,\n          work_details: this.formData.workDetails || null,\n          attachments: uploadedFiles\n        }\n\n        // Send to backend\n        const response = await axios.post('/api/leave', leaveData, {\n          headers: {\n          }\n        })\n        \n        this.$toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\n          life: 3000\n        })\n\n        this.$emit('submit-leave', response.data)\n        this.resetForm()\n        \n      } catch (error) {\n        \n        let errorMessage = 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง'\n        \n        if (error.response?.data?.error) {\n          errorMessage = error.response.data.error\n        } else if (error.message) {\n          errorMessage = error.message\n        }\n        \n        this.$toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: errorMessage,\n          life: 5000\n        })\n      }\n    },\n    calculateTotalDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime)\n        const end = new Date(this.formData.endDateTime)\n        start.setHours(0, 0, 0, 0)\n        end.setHours(0, 0, 0, 0)\n        \n        let count = 0\n        const current = new Date(start)\n        while (current <= end) {\n          const day = current.getDay()\n          if (day !== 0 && day !== 6) count++\n          current.setDate(current.getDate() + 1)\n        }\n        return count\n      }\n      return 0\n    },\n    formatDateTime(date) {\n      if (!date) return null\n      return new Date(date).toISOString()\n    },\n    resetForm() {\n      this.formData = {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      }\n      this.selectedDelegate = null\n    },\n    handleFileUpload(event) {\n      const files = Array.from(event.target.files)\n      this.formData.attachments = [...this.formData.attachments, ...files]\n    },\n    removeFile(index) {\n      this.formData.attachments.splice(index, 1)\n    },\n    async loadUsers() {\n      try {\n        const response = await axios.get('/api/users')\n        \n        if (response.data && Array.isArray(response.data)) {\n          // กรองผู้ใช้ปัจจุบันออก\n          const currentUserName = this.currentUserName\n          this.users = response.data\n            .filter(user => {\n              const userName = `${user.firstname} ${user.lastname}`.trim()\n              return userName !== currentUserName\n            })\n            .map(user => ({\n              ...user,\n              displayName: `${user.firstname} ${user.lastname}`.trim()\n            }))\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n        } else {\n          this.setFallbackUsers()\n        }\n      } catch (error) {\n        this.setFallbackUsers()\n      }\n    },\n    setFallbackUsers() {\n      this.users = [\n        { id: 1, username: 'admin', firstname: 'Admin', lastname: 'User', role: 'admin', displayName: 'Admin User' },\n        { id: 2, username: 'hr', firstname: 'HR', lastname: 'Manager', role: 'hr', displayName: 'HR Manager' },\n        { id: 3, username: 'john', firstname: 'John', lastname: 'Doe', role: 'user', displayName: 'John Doe' }\n      ]\n      this.filteredUsers = this.users\n    },\n    searchUsers(event) {\n      const query = event.query.toLowerCase().trim()\n      \n      if (query === '') {\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n      } else {\n        // ค้นหาและจำกัดผลลัพธ์\n        const filtered = this.users.filter(user => \n          user.displayName.toLowerCase().includes(query) ||\n          user.username.toLowerCase().includes(query) ||\n          (user.position && user.position.toLowerCase().includes(query)) ||\n          (user.department && user.department.toLowerCase().includes(query))\n        )\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers)\n      }\n    },\n    showAllUsers() {\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\n    },\n    onDelegateSelect(event) {\n      const user = event.value\n      if (user) {\n        this.formData.delegateName = user.displayName\n        this.formData.delegatePosition = user.position || ''\n        this.formData.delegateDepartment = user.department || ''\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.quota-display {\n  margin-top: 0.5rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border-left: 4px solid #007bff;\n}\n\n.quota-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n}\n\n.quota-label {\n  color: #6c757d;\n  font-weight: 500;\n}\n\n.quota-value {\n  font-weight: bold;\n  font-size: 1rem;\n}\n\n.quota-value.quota-normal {\n  color: #28a745;\n}\n\n.quota-value.quota-low {\n  color: #ffc107;\n}\n\n.quota-value.quota-zero {\n  color: #dc3545;\n}\n\n.quota-total {\n  color: #6c757d;\n  font-size: 0.85rem;\n}\n\n.form-card {\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);\n  border: 1px solid #e9ecef;\n}\n\n.leave-form {\n  padding: 1rem;\n}\n\n.form-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.full-width {\n  grid-column: 1 / -1;\n}\n\n.input-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.date-range-group {\n  display: flex;\n  flex-direction: row;\n  gap: 1rem;\n}\n\n.date-field {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n@media (max-width: 768px) {\n  .date-range-group {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n}\n\n.input-label {\n  font-weight: 500;\n  color: #495057;\n  font-size: 0.9rem;\n}\n\n.corporate-input,\n.corporate-dropdown {\n  border: 2px solid #e9ecef;\n  border-radius: 6px;\n  padding: 0.75rem;\n  font-size: 1rem;\n  transition: all 0.3s ease;\n}\n\n.corporate-input:focus,\n.corporate-dropdown:focus {\n  border-color: #28a745;\n  box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);\n}\n\n.readonly-field {\n  background: #f8f9fa;\n  color: #6c757d;\n}\n\n.section-divider {\n  grid-column: 1 / -1;\n  margin: 1rem 0;\n  padding: 1rem 0;\n  border-top: 2px solid #e9ecef;\n}\n\n.section-title {\n  margin: 0;\n  color: #495057;\n  font-size: 1.1rem;\n  font-weight: 600;\n}\n\n.checkbox-group {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 0;\n}\n\n.checkbox-label {\n  font-weight: 600;\n  color: #495057;\n  font-size: 1rem;\n  cursor: pointer;\n}\n\n.file-upload-wrapper {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.file-input {\n  display: none;\n}\n\n.file-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  margin-top: 0.75rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border: 1px solid #e9ecef;\n}\n\n.file-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  background: white;\n  border-radius: 4px;\n  border: 1px solid #e9ecef;\n}\n\n.file-item i {\n  color: #6c757d;\n  font-size: 1rem;\n}\n\n.file-name {\n  flex: 1;\n  font-size: 0.9rem;\n  color: #495057;\n  word-break: break-all;\n}\n\n.form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  margin-top: 1.5rem;\n}\n\n.form-actions .p-button {\n  min-width: 140px;\n  padding: 0.75rem 1.5rem;\n  font-weight: 500;\n}\n\n@media (max-width: 768px) {\n  .form-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .form-actions {\n    flex-direction: column;\n  }\n\n  .leave-form {\n    padding: 0.5rem;\n  }\n\n  .corporate-input,\n  .corporate-dropdown {\n    padding: 0.6rem;\n    font-size: 0.9rem;\n  }\n\n  .input-label {\n    font-size: 0.85rem;\n  }\n\n  .checkbox-label {\n    font-size: 0.9rem;\n  }\n\n  .file-list {\n    padding: 0.5rem;\n  }\n\n  .file-item {\n    padding: 0.4rem;\n  }\n\n  .file-name {\n    font-size: 0.85rem;\n  }\n}\n\n/* DateTime input styling */\n.datetime-inputs {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.date-input {\n  flex: 2;\n}\n\n.time-input {\n  flex: 1;\n}\n\n@media (max-width: 768px) {\n  .datetime-inputs {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .date-input, .time-input {\n    flex: 1;\n  }\n}\n\n@media (max-width: 480px) {\n  .leave-form {\n    padding: 0.25rem;\n  }\n\n  .form-grid {\n    gap: 1rem;\n  }\n\n  .corporate-input,\n  .corporate-dropdown {\n    padding: 0.5rem;\n    font-size: 0.85rem;\n  }\n\n  .input-label {\n    font-size: 0.8rem;\n  }\n\n  .form-actions .p-button {\n    min-width: 100%;\n    padding: 0.6rem 1rem;\n    font-size: 0.9rem;\n  }\n\n  .checkbox-group {\n    padding: 0.75rem 0;\n  }\n\n  .checkbox-label {\n    font-size: 0.85rem;\n  }\n}\n\n.user-option {\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n}\n\n.user-name {\n  font-weight: 500;\n  color: #495057;\n}\n\n.user-role {\n  font-size: 0.875rem;\n  color: #6c757d;\n  margin-top: 0.25rem;\n}\n\n.corporate-input :deep(.p-autocomplete-panel) {\n  max-height: 250px;\n  overflow-y: auto;\n}\n\n.quota-display {\n  margin-top: 0.5rem;\n  padding: 0.75rem;\n  background: #f8f9fa;\n  border-radius: 6px;\n  border-left: 4px solid #007bff;\n  min-height: 3rem;\n  display: flex;\n  align-items: center;\n}\n\n.quota-info {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-size: 0.9rem;\n}\n\n.quota-label {\n  font-weight: 500;\n  color: #495057;\n}\n\n.quota-value {\n  font-weight: bold;\n  padding: 0.25rem 0.5rem;\n  border-radius: 4px;\n}\n\n.quota-normal {\n  background: #d4edda;\n  color: #155724;\n}\n\n.quota-low {\n  background: #fff3cd;\n  color: #856404;\n}\n\n.quota-zero {\n  background: #f8d7da;\n  color: #721c24;\n}\n\n.quota-total {\n  color: #6c757d;\n  font-size: 0.85rem;\n}\n\n.leave-type-option {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem 0;\n  gap: 1rem;\n}\n\n.disabled-option {\n  background-color: #f8f9fa !important;\n  color: #6c757d !important;\n  cursor: not-allowed !important;\n}\n\n.quota-status {\n  font-size: 0.75rem;\n  color: #dc3545;\n  font-weight: 500;\n  background: #f8d7da;\n  padding: 0.2rem 0.4rem;\n  border-radius: 3px;\n}\n\n.quota-placeholder {\n  background: #f8f9fa;\n  border-left: 4px solid #dee2e6;\n}\n\n.quota-placeholder-text {\n  color: #6c757d;\n  font-style: italic;\n  font-size: 0.9rem;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}