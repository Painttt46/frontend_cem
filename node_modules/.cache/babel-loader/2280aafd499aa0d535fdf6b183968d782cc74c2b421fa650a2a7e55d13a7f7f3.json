{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, renderSlot as _renderSlot, mergeProps as _mergeProps } from \"vue\";\nconst _hoisted_1 = {\n  class: \"enhanced-datatable\"\n};\nconst _hoisted_2 = {\n  class: \"table-controls mb-3\"\n};\nconst _hoisted_3 = {\n  class: \"search-box\"\n};\nconst _hoisted_4 = {\n  class: \"control-buttons\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"advanced-search mb-3\"\n};\nconst _hoisted_6 = {\n  class: \"filter-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_InputIcon = _resolveComponent(\"InputIcon\");\n  const _component_InputText = _resolveComponent(\"InputText\");\n  const _component_IconField = _resolveComponent(\"IconField\");\n  const _component_Button = _resolveComponent(\"Button\");\n  const _component_Dropdown = _resolveComponent(\"Dropdown\");\n  const _component_DataTable = _resolveComponent(\"DataTable\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Search and Column Controls \"), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_IconField, {\n    iconPosition: \"left\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_InputIcon, {\n      class: \"pi pi-search\"\n    }), _createVNode(_component_InputText, {\n      modelValue: $setup.localSearch,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.localSearch = $event),\n      placeholder: \"ค้นหาทั่วไป...\",\n      class: \"w-full\"\n    }, null, 8 /* PROPS */, [\"modelValue\"])]),\n    _: 1 /* STABLE */\n  })]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_Button, {\n    icon: $setup.advancedMode ? 'pi pi-times' : 'pi pi-filter',\n    label: $setup.advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง',\n    onClick: _cache[1] || (_cache[1] = $event => $setup.advancedMode = !$setup.advancedMode),\n    text: \"\",\n    severity: $setup.advancedMode ? 'danger' : 'info'\n  }, null, 8 /* PROPS */, [\"icon\", \"label\", \"severity\"])])]), _createCommentVNode(\" Advanced Search Filters \"), $setup.advancedMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.filters, (filter, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"filter-row\"\n    }, [_createVNode(_component_Dropdown, {\n      modelValue: filter.column,\n      \"onUpdate:modelValue\": $event => filter.column = $event,\n      options: $setup.searchableColumns,\n      optionLabel: \"header\",\n      optionValue: \"field\",\n      placeholder: \"เลือก Column\",\n      class: \"filter-column\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\", \"options\"]), _createVNode(_component_Dropdown, {\n      modelValue: filter.operator,\n      \"onUpdate:modelValue\": $event => filter.operator = $event,\n      options: $setup.operators,\n      optionLabel: \"label\",\n      optionValue: \"value\",\n      placeholder: \"เงื่อนไข\",\n      class: \"filter-operator\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), _createVNode(_component_InputText, {\n      modelValue: filter.value,\n      \"onUpdate:modelValue\": $event => filter.value = $event,\n      placeholder: \"ค่าที่ค้นหา\",\n      class: \"filter-value\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"]), _createVNode(_component_Button, {\n      icon: \"pi pi-times\",\n      severity: \"danger\",\n      text: \"\",\n      onClick: $event => $setup.removeFilter(index),\n      disabled: $setup.filters.length === 1\n    }, null, 8 /* PROPS */, [\"onClick\", \"disabled\"])]);\n  }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"div\", _hoisted_6, [_createVNode(_component_Button, {\n    label: \"เพิ่มเงื่อนไข (AND)\",\n    icon: \"pi pi-plus\",\n    onClick: $setup.addFilter,\n    text: \"\",\n    size: \"small\"\n  }), _createVNode(_component_Button, {\n    label: \"ล้าง\",\n    icon: \"pi pi-refresh\",\n    onClick: $setup.resetFilters,\n    text: \"\",\n    size: \"small\",\n    severity: \"secondary\"\n  })])])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" Pass through DataTable with filtered data \"), _createVNode(_component_DataTable, _mergeProps({\n    value: $setup.filteredData\n  }, _ctx.$attrs), {\n    default: _withCtx(() => [_renderSlot(_ctx.$slots, \"default\", {}, undefined, true)]),\n    _: 3 /* FORWARDED */\n  }, 16 /* FULL_PROPS */, [\"value\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_IconField","iconPosition","_component_InputIcon","_component_InputText","$setup","localSearch","$event","placeholder","_hoisted_4","_component_Button","icon","advancedMode","label","onClick","_cache","text","severity","_hoisted_5","_Fragment","_renderList","filters","filter","index","key","_component_Dropdown","column","options","searchableColumns","optionLabel","optionValue","operator","operators","value","removeFilter","disabled","length","_hoisted_6","addFilter","size","resetFilters","_component_DataTable","_mergeProps","filteredData","_ctx","$attrs","_renderSlot","$slots","undefined"],"sources":["D:\\frontend_cem\\src\\components\\EnhancedDataTable.vue"],"sourcesContent":["<template>\r\n  <div class=\"enhanced-datatable\">\r\n    <!-- Search and Column Controls -->\r\n    <div class=\"table-controls mb-3\">\r\n      <div class=\"search-box\">\r\n        <IconField iconPosition=\"left\">\r\n          <InputIcon class=\"pi pi-search\" />\r\n          <InputText v-model=\"localSearch\" placeholder=\"ค้นหาทั่วไป...\" class=\"w-full\" />\r\n        </IconField>\r\n      </div>\r\n      <div class=\"control-buttons\">\r\n        <Button \r\n          :icon=\"advancedMode ? 'pi pi-times' : 'pi pi-filter'\" \r\n          :label=\"advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง'\" \r\n          @click=\"advancedMode = !advancedMode\" \r\n          text \r\n          :severity=\"advancedMode ? 'danger' : 'info'\" \r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Advanced Search Filters -->\r\n    <div v-if=\"advancedMode\" class=\"advanced-search mb-3\">\r\n      <div v-for=\"(filter, index) in filters\" :key=\"index\" class=\"filter-row\">\r\n        <Dropdown \r\n          v-model=\"filter.column\" \r\n          :options=\"searchableColumns\" \r\n          optionLabel=\"header\" \r\n          optionValue=\"field\" \r\n          placeholder=\"เลือก Column\" \r\n          class=\"filter-column\" \r\n        />\r\n        <Dropdown \r\n          v-model=\"filter.operator\" \r\n          :options=\"operators\" \r\n          optionLabel=\"label\" \r\n          optionValue=\"value\" \r\n          placeholder=\"เงื่อนไข\" \r\n          class=\"filter-operator\" \r\n        />\r\n        <InputText \r\n          v-model=\"filter.value\" \r\n          placeholder=\"ค่าที่ค้นหา\" \r\n          class=\"filter-value\" \r\n        />\r\n        <Button \r\n          icon=\"pi pi-times\" \r\n          severity=\"danger\" \r\n          text \r\n          @click=\"removeFilter(index)\" \r\n          :disabled=\"filters.length === 1\" \r\n        />\r\n      </div>\r\n      <div class=\"filter-actions\">\r\n        <Button label=\"เพิ่มเงื่อนไข (AND)\" icon=\"pi pi-plus\" @click=\"addFilter\" text size=\"small\" />\r\n        <Button label=\"ล้าง\" icon=\"pi pi-refresh\" @click=\"resetFilters\" text size=\"small\" severity=\"secondary\" />\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Pass through DataTable with filtered data -->\r\n    <DataTable \r\n      :value=\"filteredData\" \r\n      v-bind=\"$attrs\"\r\n    >\r\n      <slot />\r\n    </DataTable>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n/* eslint-disable no-undef */\r\nimport { ref, computed } from 'vue'\r\n\r\nconst props = defineProps({\r\n  data: {\r\n    type: Array,\r\n    required: true\r\n  },\r\n  columns: {\r\n    type: Array,\r\n    default: () => []\r\n  }\r\n})\r\n\r\nconst localSearch = ref('')\r\nconst advancedMode = ref(false)\r\nconst filters = ref([\r\n  { column: '', operator: 'contains', value: '' }\r\n])\r\n\r\nconst operators = [\r\n  { label: 'มีคำว่า', value: 'contains' },\r\n  { label: 'เท่ากับ', value: 'equals' },\r\n  { label: 'ไม่เท่ากับ', value: 'notEquals' },\r\n  { label: 'เริ่มต้นด้วย', value: 'startsWith' },\r\n  { label: 'ลงท้ายด้วย', value: 'endsWith' },\r\n  { label: 'มากกว่า', value: 'greaterThan' },\r\n  { label: 'น้อยกว่า', value: 'lessThan' }\r\n]\r\n\r\n// Normalize Thai text for search - simpler version\r\nconst normalizeText = (text) => {\r\n  if (!text) return ''\r\n  return String(text).toLowerCase().trim()\r\n}\r\n\r\n// Get searchable columns\r\nconst searchableColumns = computed(() => {\r\n  return props.columns.filter(col => col.field)\r\n})\r\n\r\n// Apply single filter\r\nconst applyFilter = (item, filter) => {\r\n  const fieldValue = normalizeText(item[filter.column])\r\n  const searchValue = normalizeText(filter.value)\r\n\r\n  switch (filter.operator) {\r\n    case 'contains':\r\n      return fieldValue.includes(searchValue)\r\n    case 'equals':\r\n      return fieldValue === searchValue\r\n    case 'notEquals':\r\n      return fieldValue !== searchValue\r\n    case 'startsWith':\r\n      return fieldValue.startsWith(searchValue)\r\n    case 'endsWith':\r\n      return fieldValue.endsWith(searchValue)\r\n    case 'greaterThan':\r\n      return parseFloat(fieldValue) > parseFloat(searchValue)\r\n    case 'lessThan':\r\n      return parseFloat(fieldValue) < parseFloat(searchValue)\r\n    default:\r\n      return true\r\n  }\r\n}\r\n\r\n// Filter data based on search mode\r\nconst filteredData = computed(() => {\r\n  let result = props.data\r\n\r\n  // Advanced mode: column-specific AND filters\r\n  if (advancedMode.value) {\r\n    const validFilters = filters.value.filter(f => f.column && f.value)\r\n    \r\n    if (validFilters.length > 0) {\r\n      result = result.filter(item => {\r\n        return validFilters.every(filter => applyFilter(item, filter))\r\n      })\r\n    }\r\n  } \r\n  // Simple mode: global search - FIXED for Thai and mapped values\r\n  else if (localSearch.value) {\r\n    const query = normalizeText(localSearch.value)\r\n    result = result.filter(record => {\r\n      // Search in all fields\r\n      return Object.values(record).some((value) => {\r\n        if (value === null || value === undefined) return false\r\n        const strValue = normalizeText(value)\r\n        \r\n        // Check if it's an object with label/value\r\n        if (typeof value === 'object' && value.label) {\r\n          return normalizeText(value.label).includes(query)\r\n        }\r\n        \r\n        // Direct match\r\n        if (strValue.includes(query)) return true\r\n        \r\n        // For status/category fields, also check in slot content\r\n        // This allows searching by display label even if stored as code\r\n        return false\r\n      })\r\n    })\r\n  }\r\n\r\n  return result\r\n})\r\n\r\nconst addFilter = () => {\r\n  filters.value.push({ column: '', operator: 'contains', value: '' })\r\n}\r\n\r\nconst removeFilter = (index) => {\r\n  if (filters.value.length > 1) {\r\n    filters.value.splice(index, 1)\r\n  }\r\n}\r\n\r\nconst resetFilters = () => {\r\n  filters.value = [{ column: '', operator: 'contains', value: '' }]\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.table-controls {\r\n  display: flex;\r\n  gap: 1rem;\r\n  margin-bottom: 1rem;\r\n  flex-wrap: wrap;\r\n  align-items: center;\r\n}\r\n\r\n.search-box {\r\n  flex: 1;\r\n  min-width: 250px;\r\n}\r\n\r\n.column-options {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.75rem;\r\n  padding: 0.5rem;\r\n  min-width: 200px;\r\n  max-height: 400px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.column-option {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.column-option label {\r\n  cursor: pointer;\r\n  user-select: none;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.control-buttons {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.advanced-search {\r\n  background: #f8f9fa;\r\n  border: 1px solid #dee2e6;\r\n  border-radius: 8px;\r\n  padding: 1rem;\r\n}\r\n\r\n.filter-row {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1.5fr 2fr auto;\r\n  gap: 0.5rem;\r\n  align-items: center;\r\n  margin-bottom: 0.75rem;\r\n}\r\n\r\n.filter-column,\r\n.filter-operator,\r\n.filter-value {\r\n  width: 100%;\r\n}\r\n\r\n.filter-actions {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n  padding-top: 0.5rem;\r\n  border-top: 1px solid #dee2e6;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .table-controls {\r\n    flex-direction: column;\r\n    align-items: stretch;\r\n  }\r\n\r\n  .search-box {\r\n    width: 100%;\r\n  }\r\n  \r\n  .control-buttons {\r\n    width: 100%;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .filter-row {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .filter-actions {\r\n    flex-direction: column;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}