{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref } from 'vue';\nimport axios from 'axios';\nconst permissions = ref([]);\nconst permissionsLoaded = ref(false);\nexport function usePermissions() {\n  const loadPermissions = async () => {\n    try {\n      const role = localStorage.getItem('soc_role');\n      if (!role) return false;\n      const token = localStorage.getItem('soc_token');\n      if (!token) return false;\n      const response = await axios.get(`http://localhost:3001/api/role-permissions/${role}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      permissions.value = response.data.permissions || [];\n      permissionsLoaded.value = true;\n      return true;\n    } catch (error) {\n      console.error('Error loading permissions:', error);\n\n      // ถ้า token หมดอายุ\n      if (error.response?.status === 401 && error.response?.data?.expired) {\n        localStorage.clear();\n        window.location.href = '/login';\n      }\n      permissions.value = [];\n      permissionsLoaded.value = true;\n      return false;\n    }\n  };\n  const hasAccess = path => {\n    const role = localStorage.getItem('soc_role');\n\n    // Superadmin has access to everything\n    if (role === 'superadmin') return true;\n\n    // Check if permissions are loaded\n    if (!permissionsLoaded.value) return false;\n\n    // Find permission for this path\n    const permission = permissions.value.find(p => p.page_path === path);\n    return permission ? permission.has_access : false;\n  };\n  const canAccessRoute = path => {\n    return hasAccess(path);\n  };\n  const getFirstAccessibleRoute = () => {\n    const accessible = permissions.value.find(p => p.has_access);\n    return accessible ? accessible.page_path : '/profile';\n  };\n  return {\n    permissions,\n    permissionsLoaded,\n    loadPermissions,\n    hasAccess,\n    canAccessRoute,\n    getFirstAccessibleRoute\n  };\n}","map":{"version":3,"names":["ref","axios","permissions","permissionsLoaded","usePermissions","loadPermissions","role","localStorage","getItem","token","response","get","headers","Authorization","value","data","error","console","status","expired","clear","window","location","href","hasAccess","path","permission","find","p","page_path","has_access","canAccessRoute","getFirstAccessibleRoute","accessible"],"sources":["D:/frontend_cem/src/composables/usePermissions.js"],"sourcesContent":["import { ref } from 'vue'\nimport axios from 'axios'\n\nconst permissions = ref([])\nconst permissionsLoaded = ref(false)\n\nexport function usePermissions() {\n  const loadPermissions = async () => {\n    try {\n      const role = localStorage.getItem('soc_role')\n      if (!role) return false\n\n      const token = localStorage.getItem('soc_token')\n      if (!token) return false\n\n      const response = await axios.get(`http://localhost:3001/api/role-permissions/${role}`, {\n        headers: { Authorization: `Bearer ${token}` }\n      })\n\n      permissions.value = response.data.permissions || []\n      permissionsLoaded.value = true\n      return true\n    } catch (error) {\n      console.error('Error loading permissions:', error)\n      \n      // ถ้า token หมดอายุ\n      if (error.response?.status === 401 && error.response?.data?.expired) {\n        localStorage.clear()\n        window.location.href = '/login'\n      }\n      \n      permissions.value = []\n      permissionsLoaded.value = true\n      return false\n    }\n  }\n\n  const hasAccess = (path) => {\n    const role = localStorage.getItem('soc_role')\n    \n    // Superadmin has access to everything\n    if (role === 'superadmin') return true\n\n    // Check if permissions are loaded\n    if (!permissionsLoaded.value) return false\n\n    // Find permission for this path\n    const permission = permissions.value.find(p => p.page_path === path)\n    return permission ? permission.has_access : false\n  }\n\n  const canAccessRoute = (path) => {\n    return hasAccess(path)\n  }\n\n  const getFirstAccessibleRoute = () => {\n    const accessible = permissions.value.find(p => p.has_access)\n    return accessible ? accessible.page_path : '/profile'\n  }\n\n  return {\n    permissions,\n    permissionsLoaded,\n    loadPermissions,\n    hasAccess,\n    canAccessRoute,\n    getFirstAccessibleRoute\n  }\n}\n"],"mappings":";;AAAA,SAASA,GAAG,QAAQ,KAAK;AACzB,OAAOC,KAAK,MAAM,OAAO;AAEzB,MAAMC,WAAW,GAAGF,GAAG,CAAC,EAAE,CAAC;AAC3B,MAAMG,iBAAiB,GAAGH,GAAG,CAAC,KAAK,CAAC;AAEpC,OAAO,SAASI,cAAcA,CAAA,EAAG;EAC/B,MAAMC,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAI;MACF,MAAMC,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MAC7C,IAAI,CAACF,IAAI,EAAE,OAAO,KAAK;MAEvB,MAAMG,KAAK,GAAGF,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;MAC/C,IAAI,CAACC,KAAK,EAAE,OAAO,KAAK;MAExB,MAAMC,QAAQ,GAAG,MAAMT,KAAK,CAACU,GAAG,CAAC,8CAA8CL,IAAI,EAAE,EAAE;QACrFM,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUJ,KAAK;QAAG;MAC9C,CAAC,CAAC;MAEFP,WAAW,CAACY,KAAK,GAAGJ,QAAQ,CAACK,IAAI,CAACb,WAAW,IAAI,EAAE;MACnDC,iBAAiB,CAACW,KAAK,GAAG,IAAI;MAC9B,OAAO,IAAI;IACb,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;;MAElD;MACA,IAAIA,KAAK,CAACN,QAAQ,EAAEQ,MAAM,KAAK,GAAG,IAAIF,KAAK,CAACN,QAAQ,EAAEK,IAAI,EAAEI,OAAO,EAAE;QACnEZ,YAAY,CAACa,KAAK,CAAC,CAAC;QACpBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;MACjC;MAEArB,WAAW,CAACY,KAAK,GAAG,EAAE;MACtBX,iBAAiB,CAACW,KAAK,GAAG,IAAI;MAC9B,OAAO,KAAK;IACd;EACF,CAAC;EAED,MAAMU,SAAS,GAAIC,IAAI,IAAK;IAC1B,MAAMnB,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;;IAE7C;IACA,IAAIF,IAAI,KAAK,YAAY,EAAE,OAAO,IAAI;;IAEtC;IACA,IAAI,CAACH,iBAAiB,CAACW,KAAK,EAAE,OAAO,KAAK;;IAE1C;IACA,MAAMY,UAAU,GAAGxB,WAAW,CAACY,KAAK,CAACa,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,SAAS,KAAKJ,IAAI,CAAC;IACpE,OAAOC,UAAU,GAAGA,UAAU,CAACI,UAAU,GAAG,KAAK;EACnD,CAAC;EAED,MAAMC,cAAc,GAAIN,IAAI,IAAK;IAC/B,OAAOD,SAAS,CAACC,IAAI,CAAC;EACxB,CAAC;EAED,MAAMO,uBAAuB,GAAGA,CAAA,KAAM;IACpC,MAAMC,UAAU,GAAG/B,WAAW,CAACY,KAAK,CAACa,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACE,UAAU,CAAC;IAC5D,OAAOG,UAAU,GAAGA,UAAU,CAACJ,SAAS,GAAG,UAAU;EACvD,CAAC;EAED,OAAO;IACL3B,WAAW;IACXC,iBAAiB;IACjBE,eAAe;IACfmB,SAAS;IACTO,cAAc;IACdC;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}