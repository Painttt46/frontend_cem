{"ast":null,"code":"import axios from '@/utils/axiosConfig';\nimport AutoComplete from 'primevue/autocomplete';\nexport default {\n  name: 'LeaveForm',\n  components: {\n    AutoComplete\n  },\n  async created() {\n    await this.loadLeaveTypes();\n    await this.loadUsers();\n    await this.loadQuotaData();\n    // Initialize with limited users\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n  },\n  data() {\n    return {\n      formData: {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      },\n      leaveTypes: [],\n      delegationOptions: [{\n        label: 'ไม่มีการมอบหมายงาน',\n        value: 'no'\n      }, {\n        label: 'มีการมอบหมายงาน',\n        value: 'yes'\n      }],\n      users: [],\n      filteredUsers: [],\n      selectedDelegate: null,\n      maxDisplayUsers: 50,\n      quotaData: {},\n      selectedQuota: null\n    };\n  },\n  computed: {\n    currentUserName() {\n      const firstName = localStorage.getItem('soc_firstname') || '';\n      const lastName = localStorage.getItem('soc_lastname') || '';\n      return `${firstName} ${lastName}`.trim();\n    },\n    currentUserRole() {\n      return localStorage.getItem('soc_role') || '';\n    },\n    currentUserPosition() {\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง';\n    },\n    calculateDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n\n        // Set time to start of day for accurate day calculation\n        start.setHours(0, 0, 0, 0);\n        end.setHours(0, 0, 0, 0);\n        const diffTime = end - start;\n        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;\n        return diffDays + ' วัน';\n      }\n      return '0 วัน';\n    },\n    leaveTypesWithQuota() {\n      return this.leaveTypes.map(type => {\n        const quota = this.quotaData[type.value];\n        const disabled = quota && quota.remainingDays <= 0;\n        return {\n          ...type,\n          disabled: disabled\n        };\n      });\n    }\n  },\n  methods: {\n    async loadLeaveTypes() {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        this.leaveTypes = response.data;\n      } catch (error) {\n        console.error('Error loading leave types:', error);\n        // Fallback to default types if API fails\n        this.leaveTypes = [{\n          label: 'ลาป่วย',\n          value: 'sick'\n        }, {\n          label: 'ลากิจ',\n          value: 'personal'\n        }, {\n          label: 'ลาพักร้อน',\n          value: 'vacation'\n        }];\n      }\n    },\n    optionDisabled(option) {\n      return option.disabled;\n    },\n    async loadQuotaData() {\n      try {\n        const userId = localStorage.getItem('soc_user_id');\n        const response = await axios.get(`/api/leave/quota/${userId}`);\n        this.quotaData = response.data;\n\n        // Update selected quota if leave type is already selected\n        if (this.formData.leaveType) {\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\n        }\n      } catch (error) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'ไม่สามารถโหลดข้อมูลโควต้าได้',\n          life: 3000\n        });\n      }\n    },\n    onLeaveTypeChange() {\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\n      } else {\n        this.selectedQuota = null;\n      }\n    },\n    getQuotaClass(remainingDays) {\n      if (remainingDays <= 0) return 'quota-zero';\n      if (remainingDays <= 2) return 'quota-low';\n      return 'quota-normal';\n    },\n    async submitForm() {\n      if (!this.formData.leaveType) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'กรุณาเลือกประเภทการลา',\n          life: 3000\n        });\n        return;\n      }\n\n      // Check quota before submitting\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'โควต้าการลาประเภทนี้หมดแล้ว',\n          life: 3000\n        });\n        return;\n      }\n\n      // Check if requested days exceed remaining quota\n      const requestedDays = this.calculateTotalDays();\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\n        this.$toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: `จำนวนวันที่ขอลา (${requestedDays} วัน) เกินโควต้าคงเหลือ (${this.selectedQuota.remainingDays} วัน)`,\n          life: 3000\n        });\n        return;\n      }\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\n          this.$toast.add({\n            severity: 'error',\n            summary: 'ข้อผิดพลาด',\n            detail: 'วันสิ้นสุดการลาต้องไม่เป็นวันก่อนวันเริ่มลา',\n            life: 3000\n          });\n          return;\n        }\n      }\n      try {\n        // Upload files first if any\n        let uploadedFiles = [];\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\n          const formData = new FormData();\n          this.formData.attachments.forEach(file => {\n            formData.append('files', file);\n          });\n          const uploadResponse = await axios.post('/api/files/upload', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          uploadedFiles = uploadResponse.data.files;\n        }\n\n        // Calculate total days\n        const totalDays = this.calculateTotalDays();\n\n        // Prepare data for API\n        const leaveData = {\n          user_id: localStorage.getItem('soc_user_id'),\n          leave_type: this.formData.leaveType,\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\n          total_days: totalDays,\n          reason: this.formData.reason || 'ไม่ระบุ',\n          has_delegation: this.formData.delegationOption === 'yes',\n          delegate_name: this.formData.delegateName || null,\n          delegate_position: this.formData.delegatePosition || null,\n          delegate_department: this.formData.delegateDepartment || null,\n          delegate_contact: this.formData.delegateContact || null,\n          work_details: this.formData.workDetails || null,\n          attachments: uploadedFiles\n        };\n\n        // Send to backend\n        const response = await axios.post('/api/leave', leaveData, {\n          headers: {}\n        });\n        this.$toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\n          life: 3000\n        });\n        this.$emit('submit-leave', response.data);\n        this.resetForm();\n      } catch (error) {\n        let errorMessage = 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง';\n        if (error.response?.data?.error) {\n          errorMessage = error.response.data.error;\n        } else if (error.message) {\n          errorMessage = error.message;\n        }\n        this.$toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: errorMessage,\n          life: 5000\n        });\n      }\n    },\n    calculateTotalDays() {\n      if (this.formData.startDateTime && this.formData.endDateTime) {\n        const start = new Date(this.formData.startDateTime);\n        const end = new Date(this.formData.endDateTime);\n        start.setHours(0, 0, 0, 0);\n        end.setHours(0, 0, 0, 0);\n        const diffTime = end - start;\n        return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;\n      }\n      return 0;\n    },\n    formatDateTime(date) {\n      if (!date) return null;\n      return new Date(date).toISOString();\n    },\n    resetForm() {\n      this.formData = {\n        leaveType: '',\n        startDateTime: null,\n        endDateTime: null,\n        reason: '',\n        delegationOption: 'no',\n        delegateName: '',\n        delegatePosition: '',\n        delegateDepartment: '',\n        delegateContact: '',\n        workDetails: '',\n        attachments: []\n      };\n      this.selectedDelegate = null;\n    },\n    handleFileUpload(event) {\n      const files = Array.from(event.target.files);\n      this.formData.attachments = [...this.formData.attachments, ...files];\n    },\n    removeFile(index) {\n      this.formData.attachments.splice(index, 1);\n    },\n    async loadUsers() {\n      try {\n        const response = await axios.get('/api/users');\n        if (response.data && Array.isArray(response.data)) {\n          // กรองผู้ใช้ปัจจุบันออก\n          const currentUserName = this.currentUserName;\n          this.users = response.data.filter(user => {\n            const userName = `${user.firstname} ${user.lastname}`.trim();\n            return userName !== currentUserName;\n          }).map(user => ({\n            ...user,\n            displayName: `${user.firstname} ${user.lastname}`.trim()\n          }));\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n        } else {\n          this.setFallbackUsers();\n        }\n      } catch (error) {\n        this.setFallbackUsers();\n      }\n    },\n    setFallbackUsers() {\n      this.users = [{\n        id: 1,\n        username: 'admin',\n        firstname: 'Admin',\n        lastname: 'User',\n        role: 'admin',\n        displayName: 'Admin User'\n      }, {\n        id: 2,\n        username: 'hr',\n        firstname: 'HR',\n        lastname: 'Manager',\n        role: 'hr',\n        displayName: 'HR Manager'\n      }, {\n        id: 3,\n        username: 'john',\n        firstname: 'John',\n        lastname: 'Doe',\n        role: 'user',\n        displayName: 'John Doe'\n      }];\n      this.filteredUsers = this.users;\n    },\n    searchUsers(event) {\n      const query = event.query.toLowerCase().trim();\n      if (query === '') {\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n      } else {\n        // ค้นหาและจำกัดผลลัพธ์\n        const filtered = this.users.filter(user => user.displayName.toLowerCase().includes(query) || user.username.toLowerCase().includes(query) || user.position && user.position.toLowerCase().includes(query) || user.department && user.department.toLowerCase().includes(query));\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers);\n      }\n    },\n    showAllUsers() {\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\n    },\n    onDelegateSelect(event) {\n      const user = event.value;\n      if (user) {\n        this.formData.delegateName = user.displayName;\n        this.formData.delegatePosition = user.position || '';\n        this.formData.delegateDepartment = user.department || '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","AutoComplete","name","components","created","loadLeaveTypes","loadUsers","loadQuotaData","filteredUsers","users","slice","maxDisplayUsers","data","formData","leaveType","startDateTime","endDateTime","reason","delegationOption","delegateName","delegatePosition","delegateDepartment","delegateContact","workDetails","attachments","leaveTypes","delegationOptions","label","value","selectedDelegate","quotaData","selectedQuota","computed","currentUserName","firstName","localStorage","getItem","lastName","trim","currentUserRole","currentUserPosition","calculateDays","start","Date","end","setHours","diffTime","diffDays","Math","floor","leaveTypesWithQuota","map","type","quota","disabled","remainingDays","methods","response","get","error","console","optionDisabled","option","userId","$toast","add","severity","summary","detail","life","onLeaveTypeChange","getQuotaClass","submitForm","requestedDays","calculateTotalDays","uploadedFiles","length","FormData","forEach","file","append","uploadResponse","post","headers","files","totalDays","leaveData","user_id","leave_type","start_datetime","formatDateTime","end_datetime","total_days","has_delegation","delegate_name","delegate_position","delegate_department","delegate_contact","work_details","$emit","resetForm","errorMessage","message","date","toISOString","handleFileUpload","event","Array","from","target","removeFile","index","splice","isArray","filter","user","userName","firstname","lastname","displayName","setFallbackUsers","id","username","role","searchUsers","query","toLowerCase","filtered","includes","position","department","showAllUsers","onDelegateSelect"],"sources":["D:\\frontend_cem\\src\\views\\leave_work\\LeaveForm.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <Toast />\r\n    <Card class=\"form-card\">\r\n    <template #content>\r\n      <form @submit.prevent=\"submitForm\" class=\"leave-form\">\r\n        <div class=\"form-grid\">\r\n          <div class=\"input-group\">\r\n            <label for=\"name\" class=\"input-label\">ชื่อ-นามสกุล</label>\r\n            <InputText id=\"name\" :value=\"currentUserName\" readonly class=\"corporate-input readonly-field\" />\r\n          </div>\r\n\r\n          <div class=\"input-group\">\r\n            <label for=\"position\" class=\"input-label\">ตำแหน่ง</label>\r\n            <InputText id=\"position\" :value=\"currentUserPosition\" readonly class=\"corporate-input readonly-field\" />\r\n          </div>\r\n\r\n          <div class=\"input-group\">\r\n            <label for=\"leaveType\" class=\"input-label\">ประเภทการลา *</label>\r\n            <Dropdown v-model=\"formData.leaveType\" :options=\"leaveTypesWithQuota\" optionLabel=\"label\" optionValue=\"value\"\r\n              :optionDisabled=\"optionDisabled\" class=\"corporate-dropdown\" required @change=\"onLeaveTypeChange\">\r\n              <template #option=\"slotProps\">\r\n                <div class=\"leave-type-option\" :class=\"{ 'disabled-option': slotProps.option.disabled }\">\r\n                  <span>{{ slotProps.option.label }}</span>\r\n                  <span v-if=\"slotProps.option.disabled\" class=\"quota-status\">หมดโควต้า</span>\r\n                </div>\r\n              </template>\r\n            </Dropdown>\r\n          </div>\r\n\r\n          <!-- Quota Display -->\r\n          <div class=\"quota-display\" :class=\"{ 'quota-placeholder': !selectedQuota }\">\r\n            <div v-if=\"selectedQuota\" class=\"quota-info\">\r\n              <span class=\"quota-label\">โควต้าคงเหลือ:</span>\r\n              <span class=\"quota-value\" :class=\"getQuotaClass(selectedQuota.remainingDays)\">\r\n                {{ selectedQuota.remainingDays }} วัน\r\n              </span>\r\n              <span class=\"quota-total\">(จาก {{ selectedQuota.quota }} วัน)</span>\r\n            </div>\r\n            <div v-else class=\"quota-placeholder-text\">\r\n              เลือกประเภทการลาเพื่อดูโควต้า\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"input-group date-range-group\">\r\n            <div class=\"date-field\">\r\n              <label for=\"startDateTime\" class=\"input-label\">วันเวลาเริ่มลา *</label>\r\n              <Calendar v-model=\"formData.startDateTime\" showTime hourFormat=\"24\" dateFormat=\"dd/mm/yy\"\r\n                class=\"corporate-input\" :manualInput=\"true\" :stepHour=\"1\" :stepMinute=\"1\" required />\r\n            </div>\r\n            <div class=\"date-field\">\r\n              <label for=\"endDateTime\" class=\"input-label\">วันเวลาสิ้นสุดการลา *</label>\r\n              <Calendar v-model=\"formData.endDateTime\" showTime hourFormat=\"24\" dateFormat=\"dd/mm/yy\"\r\n                :minDate=\"formData.startDateTime\" class=\"corporate-input\" :manualInput=\"true\" :stepHour=\"1\" :stepMinute=\"1\" required />\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"input-group\">\r\n            <label for=\"totalDays\" class=\"input-label\">จำนวนวันลา</label>\r\n            <InputText id=\"totalDays\" :value=\"calculateDays\" readonly class=\"corporate-input readonly-field\" />\r\n          </div>\r\n\r\n          <div class=\"input-group full-width\">\r\n            <label for=\"reason\" class=\"input-label\">เหตุผลการลา</label>\r\n            <Textarea id=\"reason\" v-model=\"formData.reason\" rows=\"3\" class=\"corporate-input\" />\r\n          </div>\r\n\r\n          <div class=\"input-group full-width\">\r\n            <label class=\"input-label\">แนบเอกสารประกอบ (Attachments)</label>\r\n            <div class=\"file-upload-wrapper\">\r\n              <input ref=\"fileInput\" @change=\"handleFileUpload\" type=\"file\"\r\n                accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif\" multiple class=\"file-input\" id=\"attachments\">\r\n              <Button type=\"button\"\r\n                :label=\"formData.attachments?.length > 0 ? `เลือกแล้ว ${formData.attachments.length} ไฟล์` : 'เลือกไฟล์'\"\r\n                icon=\"pi pi-upload\" severity=\"secondary\" outlined @click=\"$refs.fileInput.click()\" />\r\n            </div>\r\n            <div v-if=\"formData.attachments?.length > 0\" class=\"file-list\">\r\n              <div v-for=\"(file, index) in formData.attachments\" :key=\"index\" class=\"file-item\">\r\n                <i class=\"pi pi-file\"></i>\r\n                <span class=\"file-name\">{{ file.name }}</span>\r\n                <Button icon=\"pi pi-times\" severity=\"danger\" text size=\"small\" @click=\"removeFile(index)\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"input-group\">\r\n            <label for=\"delegationOption\" class=\"input-label\">มอบหมายงานระหว่างลา *</label>\r\n            <Dropdown v-model=\"formData.delegationOption\" :options=\"delegationOptions\" optionLabel=\"label\"\r\n              optionValue=\"value\" class=\"corporate-dropdown\" required />\r\n          </div>\r\n\r\n          <template v-if=\"formData.delegationOption === 'yes'\">\r\n            <div class=\"input-group\">\r\n              <label for=\"delegateUser\" class=\"input-label\">ชื่อผู้รับผิดชอบงานแทน *</label>\r\n              <AutoComplete \r\n                v-model=\"selectedDelegate\" \r\n                :suggestions=\"filteredUsers\" \r\n                @complete=\"searchUsers\" \r\n                @item-select=\"onDelegateSelect\"\r\n                @dropdown-click=\"showAllUsers\"\r\n                optionLabel=\"displayName\" \r\n                placeholder=\"ค้นหาหรือเลือกพนักงาน...\" \r\n                class=\"corporate-input\"\r\n                :dropdown=\"true\"\r\n                :forceSelection=\"true\"\r\n                :scrollHeight=\"200\"\r\n                required\r\n              >\r\n                <template #option=\"slotProps\">\r\n                  <div class=\"user-option\">\r\n                    <div class=\"user-name\">{{ slotProps.option.displayName }}</div>\r\n                    <div class=\"user-role\">{{ slotProps.option.position }} - {{ slotProps.option.department }}</div>\r\n                  </div>\r\n                </template>\r\n              </AutoComplete>\r\n            </div>\r\n\r\n            <div class=\"input-group\">\r\n              <label for=\"delegatePosition\" class=\"input-label\">ตำแหน่ง</label>\r\n              <InputText \r\n                id=\"delegatePosition\" \r\n                :value=\"formData.delegatePosition\" \r\n                readonly \r\n                class=\"corporate-input readonly-field\" \r\n              />\r\n            </div>\r\n\r\n            <div class=\"input-group\">\r\n              <label for=\"delegateDepartment\" class=\"input-label\">แผนก</label>\r\n              <InputText \r\n                id=\"delegateDepartment\" \r\n                :value=\"formData.delegateDepartment\" \r\n                readonly \r\n                class=\"corporate-input readonly-field\" \r\n              />\r\n            </div>\r\n            <div class=\"input-group full-width\">\r\n              <label for=\"delegateContact\" class=\"input-label\">ช่องทางติดต่อ *</label>\r\n              <InputText id=\"delegateContact\" v-model=\"formData.delegateContact\"\r\n                placeholder=\"เบอร์โทร, อีเมล, หรือช่องทางอื่นๆ\" required class=\"corporate-input\" />\r\n            </div>\r\n\r\n            <div class=\"input-group full-width\">\r\n              <label for=\"workDetails\" class=\"input-label\">รายละเอียดงานที่มอบหมาย *</label>\r\n              <Textarea id=\"workDetails\" v-model=\"formData.workDetails\" rows=\"4\" \r\n                placeholder=\"ระบุรายละเอียดงานที่ต้องดำเนินการระหว่างลา...\" \r\n                required class=\"corporate-input\" />\r\n            </div>\r\n\r\n          </template>\r\n        </div>\r\n\r\n        <Divider />\r\n\r\n        <div class=\"form-actions\">\r\n          <Button type=\"button\" label=\"ล้างข้อมูล\" icon=\"pi pi-refresh\" severity=\"secondary\" outlined\r\n            @click=\"resetForm\" />\r\n          <Button type=\"submit\" label=\"ส่งคำขอลางาน\" icon=\"pi pi-check\" severity=\"success\" />\r\n        </div>\r\n      </form>\r\n    </template>\r\n  </Card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from '@/utils/axiosConfig'\r\nimport AutoComplete from 'primevue/autocomplete'\r\n\r\nexport default {\r\n  name: 'LeaveForm',\r\n  components: {\r\n    AutoComplete\r\n  },\r\n  async created() {\r\n    await this.loadLeaveTypes();\r\n    await this.loadUsers();\r\n    await this.loadQuotaData();\r\n    // Initialize with limited users\r\n    this.filteredUsers = this.users.slice(0, this.maxDisplayUsers);\r\n  },\r\n  data() {\r\n    return {\r\n      formData: {\r\n        leaveType: '',\r\n        startDateTime: null,\r\n        endDateTime: null,\r\n        reason: '',\r\n        delegationOption: 'no',\r\n        delegateName: '',\r\n        delegatePosition: '',\r\n        delegateDepartment: '',\r\n        delegateContact: '',\r\n        workDetails: '',\r\n        attachments: []\r\n      },\r\n      leaveTypes: [],\r\n      delegationOptions: [\r\n        { label: 'ไม่มีการมอบหมายงาน', value: 'no' },\r\n        { label: 'มีการมอบหมายงาน', value: 'yes' }\r\n      ],\r\n      users: [],\r\n      filteredUsers: [],\r\n      selectedDelegate: null,\r\n      maxDisplayUsers: 50,\r\n      quotaData: {},\r\n      selectedQuota: null\r\n    }\r\n  },\r\n  computed: {\r\n    currentUserName() {\r\n      const firstName = localStorage.getItem('soc_firstname') || ''\r\n      const lastName = localStorage.getItem('soc_lastname') || ''\r\n      return `${firstName} ${lastName}`.trim()\r\n    },\r\n    currentUserRole() {\r\n      return localStorage.getItem('soc_role') || ''\r\n    },\r\n    currentUserPosition() {\r\n      return localStorage.getItem('soc_position') || 'ไม่ระบุตำแหน่ง'\r\n    },\r\n    calculateDays() {\r\n      if (this.formData.startDateTime && this.formData.endDateTime) {\r\n        const start = new Date(this.formData.startDateTime)\r\n        const end = new Date(this.formData.endDateTime)\r\n        \r\n        // Set time to start of day for accurate day calculation\r\n        start.setHours(0, 0, 0, 0)\r\n        end.setHours(0, 0, 0, 0)\r\n        \r\n        const diffTime = end - start\r\n        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1\r\n        return diffDays + ' วัน'\r\n      }\r\n      return '0 วัน'\r\n    },\r\n    leaveTypesWithQuota() {\r\n      return this.leaveTypes.map(type => {\r\n        const quota = this.quotaData[type.value];\r\n        const disabled = quota && quota.remainingDays <= 0;\r\n        return {\r\n          ...type,\r\n          disabled: disabled\r\n        };\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    async loadLeaveTypes() {\r\n      try {\r\n        const response = await axios.get('/api/leave/leave-types');\r\n        this.leaveTypes = response.data;\r\n      } catch (error) {\r\n        console.error('Error loading leave types:', error);\r\n        // Fallback to default types if API fails\r\n        this.leaveTypes = [\r\n          { label: 'ลาป่วย', value: 'sick' },\r\n          { label: 'ลากิจ', value: 'personal' },\r\n          { label: 'ลาพักร้อน', value: 'vacation' }\r\n        ];\r\n      }\r\n    },\r\n    optionDisabled(option) {\r\n      return option.disabled;\r\n    },\r\n\r\n    async loadQuotaData() {\r\n      try {\r\n        const userId = localStorage.getItem('soc_user_id');\r\n        const response = await axios.get(`/api/leave/quota/${userId}`);\r\n        this.quotaData = response.data;\r\n        \r\n        // Update selected quota if leave type is already selected\r\n        if (this.formData.leaveType) {\r\n          this.selectedQuota = this.quotaData[this.formData.leaveType];\r\n        }\r\n      } catch (error) {\r\n        this.$toast.add({\r\n          severity: 'error',\r\n          summary: 'ข้อผิดพลาด',\r\n          detail: 'ไม่สามารถโหลดข้อมูลโควต้าได้',\r\n          life: 3000\r\n        });\r\n      }\r\n    },\r\n\r\n    onLeaveTypeChange() {\r\n      if (this.formData.leaveType && this.quotaData[this.formData.leaveType]) {\r\n        this.selectedQuota = this.quotaData[this.formData.leaveType];\r\n      } else {\r\n        this.selectedQuota = null;\r\n      }\r\n    },\r\n\r\n    getQuotaClass(remainingDays) {\r\n      if (remainingDays <= 0) return 'quota-zero';\r\n      if (remainingDays <= 2) return 'quota-low';\r\n      return 'quota-normal';\r\n    },\r\n\r\n    async submitForm() {\r\n      if (!this.formData.leaveType) {\r\n        this.$toast.add({\r\n          severity: 'error',\r\n          summary: 'ข้อผิดพลาด',\r\n          detail: 'กรุณาเลือกประเภทการลา',\r\n          life: 3000\r\n        })\r\n        return\r\n      }\r\n\r\n      // Check quota before submitting\r\n      if (this.selectedQuota && this.selectedQuota.remainingDays <= 0) {\r\n        this.$toast.add({\r\n          severity: 'error',\r\n          summary: 'ข้อผิดพลาด',\r\n          detail: 'โควต้าการลาประเภทนี้หมดแล้ว',\r\n          life: 3000\r\n        })\r\n        return\r\n      }\r\n\r\n      // Check if requested days exceed remaining quota\r\n      const requestedDays = this.calculateTotalDays();\r\n      if (this.selectedQuota && requestedDays > this.selectedQuota.remainingDays) {\r\n        this.$toast.add({\r\n          severity: 'error',\r\n          summary: 'ข้อผิดพลาด',\r\n          detail: `จำนวนวันที่ขอลา (${requestedDays} วัน) เกินโควต้าคงเหลือ (${this.selectedQuota.remainingDays} วัน)`,\r\n          life: 3000\r\n        })\r\n        return\r\n      }\r\n\r\n      if (this.formData.startDateTime && this.formData.endDateTime) {\r\n        if (new Date(this.formData.endDateTime) < new Date(this.formData.startDateTime)) {\r\n          this.$toast.add({\r\n            severity: 'error',\r\n            summary: 'ข้อผิดพลาด',\r\n            detail: 'วันสิ้นสุดการลาต้องไม่เป็นวันก่อนวันเริ่มลา',\r\n            life: 3000\r\n          })\r\n          return\r\n        }\r\n      }\r\n\r\n      try {\r\n        // Upload files first if any\r\n        let uploadedFiles = []\r\n        if (this.formData.attachments && this.formData.attachments.length > 0) {\r\n          const formData = new FormData()\r\n          this.formData.attachments.forEach(file => {\r\n            formData.append('files', file)\r\n          })\r\n          \r\n          const uploadResponse = await axios.post('/api/files/upload', formData, {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          })\r\n          uploadedFiles = uploadResponse.data.files\r\n        }\r\n\r\n        // Calculate total days\r\n        const totalDays = this.calculateTotalDays();\r\n        \r\n        // Prepare data for API\r\n        const leaveData = {\r\n          user_id: localStorage.getItem('soc_user_id'),\r\n          leave_type: this.formData.leaveType,\r\n          start_datetime: this.formatDateTime(this.formData.startDateTime),\r\n          end_datetime: this.formatDateTime(this.formData.endDateTime),\r\n          total_days: totalDays,\r\n          reason: this.formData.reason || 'ไม่ระบุ',\r\n          has_delegation: this.formData.delegationOption === 'yes',\r\n          delegate_name: this.formData.delegateName || null,\r\n          delegate_position: this.formData.delegatePosition || null,\r\n          delegate_department: this.formData.delegateDepartment || null,\r\n          delegate_contact: this.formData.delegateContact || null,\r\n          work_details: this.formData.workDetails || null,\r\n          attachments: uploadedFiles\r\n        }\r\n\r\n        // Send to backend\r\n        const response = await axios.post('/api/leave', leaveData, {\r\n          headers: {\r\n          }\r\n        })\r\n        \r\n        this.$toast.add({\r\n          severity: 'success',\r\n          summary: 'สำเร็จ',\r\n          detail: 'บันทึกคำขอลางานเรียบร้อยแล้ว',\r\n          life: 3000\r\n        })\r\n\r\n        this.$emit('submit-leave', response.data)\r\n        this.resetForm()\r\n        \r\n      } catch (error) {\r\n        \r\n        let errorMessage = 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง'\r\n        \r\n        if (error.response?.data?.error) {\r\n          errorMessage = error.response.data.error\r\n        } else if (error.message) {\r\n          errorMessage = error.message\r\n        }\r\n        \r\n        this.$toast.add({\r\n          severity: 'error',\r\n          summary: 'เกิดข้อผิดพลาด',\r\n          detail: errorMessage,\r\n          life: 5000\r\n        })\r\n      }\r\n    },\r\n    calculateTotalDays() {\r\n      if (this.formData.startDateTime && this.formData.endDateTime) {\r\n        const start = new Date(this.formData.startDateTime)\r\n        const end = new Date(this.formData.endDateTime)\r\n        start.setHours(0, 0, 0, 0)\r\n        end.setHours(0, 0, 0, 0)\r\n        const diffTime = end - start\r\n        return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1\r\n      }\r\n      return 0\r\n    },\r\n    formatDateTime(date) {\r\n      if (!date) return null\r\n      return new Date(date).toISOString()\r\n    },\r\n    resetForm() {\r\n      this.formData = {\r\n        leaveType: '',\r\n        startDateTime: null,\r\n        endDateTime: null,\r\n        reason: '',\r\n        delegationOption: 'no',\r\n        delegateName: '',\r\n        delegatePosition: '',\r\n        delegateDepartment: '',\r\n        delegateContact: '',\r\n        workDetails: '',\r\n        attachments: []\r\n      }\r\n      this.selectedDelegate = null\r\n    },\r\n    handleFileUpload(event) {\r\n      const files = Array.from(event.target.files)\r\n      this.formData.attachments = [...this.formData.attachments, ...files]\r\n    },\r\n    removeFile(index) {\r\n      this.formData.attachments.splice(index, 1)\r\n    },\r\n    async loadUsers() {\r\n      try {\r\n        const response = await axios.get('/api/users')\r\n        \r\n        if (response.data && Array.isArray(response.data)) {\r\n          // กรองผู้ใช้ปัจจุบันออก\r\n          const currentUserName = this.currentUserName\r\n          this.users = response.data\r\n            .filter(user => {\r\n              const userName = `${user.firstname} ${user.lastname}`.trim()\r\n              return userName !== currentUserName\r\n            })\r\n            .map(user => ({\r\n              ...user,\r\n              displayName: `${user.firstname} ${user.lastname}`.trim()\r\n            }))\r\n          this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\r\n        } else {\r\n          this.setFallbackUsers()\r\n        }\r\n      } catch (error) {\r\n        this.setFallbackUsers()\r\n      }\r\n    },\r\n    setFallbackUsers() {\r\n      this.users = [\r\n        { id: 1, username: 'admin', firstname: 'Admin', lastname: 'User', role: 'admin', displayName: 'Admin User' },\r\n        { id: 2, username: 'hr', firstname: 'HR', lastname: 'Manager', role: 'hr', displayName: 'HR Manager' },\r\n        { id: 3, username: 'john', firstname: 'John', lastname: 'Doe', role: 'user', displayName: 'John Doe' }\r\n      ]\r\n      this.filteredUsers = this.users\r\n    },\r\n    searchUsers(event) {\r\n      const query = event.query.toLowerCase().trim()\r\n      \r\n      if (query === '') {\r\n        // แสดงแค่ 50 คนแรกเมื่อไม่มีการค้นหา\r\n        this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\r\n      } else {\r\n        // ค้นหาและจำกัดผลลัพธ์\r\n        const filtered = this.users.filter(user => \r\n          user.displayName.toLowerCase().includes(query) ||\r\n          user.username.toLowerCase().includes(query) ||\r\n          (user.position && user.position.toLowerCase().includes(query)) ||\r\n          (user.department && user.department.toLowerCase().includes(query))\r\n        )\r\n        this.filteredUsers = filtered.slice(0, this.maxDisplayUsers)\r\n      }\r\n    },\r\n    showAllUsers() {\r\n      // แสดงแค่ 50 คนแรกเมื่อคลิก dropdown\r\n      this.filteredUsers = this.users.slice(0, this.maxDisplayUsers)\r\n    },\r\n    onDelegateSelect(event) {\r\n      const user = event.value\r\n      if (user) {\r\n        this.formData.delegateName = user.displayName\r\n        this.formData.delegatePosition = user.position || ''\r\n        this.formData.delegateDepartment = user.department || ''\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.quota-display {\r\n  margin-top: 0.5rem;\r\n  padding: 0.75rem;\r\n  background: #f8f9fa;\r\n  border-radius: 6px;\r\n  border-left: 4px solid #007bff;\r\n}\r\n\r\n.quota-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.quota-label {\r\n  color: #6c757d;\r\n  font-weight: 500;\r\n}\r\n\r\n.quota-value {\r\n  font-weight: bold;\r\n  font-size: 1rem;\r\n}\r\n\r\n.quota-value.quota-normal {\r\n  color: #28a745;\r\n}\r\n\r\n.quota-value.quota-low {\r\n  color: #ffc107;\r\n}\r\n\r\n.quota-value.quota-zero {\r\n  color: #dc3545;\r\n}\r\n\r\n.quota-total {\r\n  color: #6c757d;\r\n  font-size: 0.85rem;\r\n}\r\n\r\n.form-card {\r\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);\r\n  border: 1px solid #e9ecef;\r\n}\r\n\r\n.leave-form {\r\n  padding: 1rem;\r\n}\r\n\r\n.form-grid {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 1.5rem;\r\n  margin-bottom: 1.5rem;\r\n}\r\n\r\n.full-width {\r\n  grid-column: 1 / -1;\r\n}\r\n\r\n.input-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.date-range-group {\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 1rem;\r\n}\r\n\r\n.date-field {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .date-range-group {\r\n    flex-direction: column;\r\n    gap: 0.5rem;\r\n  }\r\n}\r\n\r\n.input-label {\r\n  font-weight: 500;\r\n  color: #495057;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.corporate-input,\r\n.corporate-dropdown {\r\n  border: 2px solid #e9ecef;\r\n  border-radius: 6px;\r\n  padding: 0.75rem;\r\n  font-size: 1rem;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.corporate-input:focus,\r\n.corporate-dropdown:focus {\r\n  border-color: #28a745;\r\n  box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);\r\n}\r\n\r\n.readonly-field {\r\n  background: #f8f9fa;\r\n  color: #6c757d;\r\n}\r\n\r\n.section-divider {\r\n  grid-column: 1 / -1;\r\n  margin: 1rem 0;\r\n  padding: 1rem 0;\r\n  border-top: 2px solid #e9ecef;\r\n}\r\n\r\n.section-title {\r\n  margin: 0;\r\n  color: #495057;\r\n  font-size: 1.1rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.checkbox-group {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  padding: 1rem 0;\r\n}\r\n\r\n.checkbox-label {\r\n  font-weight: 600;\r\n  color: #495057;\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n}\r\n\r\n.file-upload-wrapper {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.file-input {\r\n  display: none;\r\n}\r\n\r\n.file-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 0.5rem;\r\n  margin-top: 0.75rem;\r\n  padding: 0.75rem;\r\n  background: #f8f9fa;\r\n  border-radius: 6px;\r\n  border: 1px solid #e9ecef;\r\n}\r\n\r\n.file-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n  padding: 0.5rem;\r\n  background: white;\r\n  border-radius: 4px;\r\n  border: 1px solid #e9ecef;\r\n}\r\n\r\n.file-item i {\r\n  color: #6c757d;\r\n  font-size: 1rem;\r\n}\r\n\r\n.file-name {\r\n  flex: 1;\r\n  font-size: 0.9rem;\r\n  color: #495057;\r\n  word-break: break-all;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 1rem;\r\n  margin-top: 1.5rem;\r\n}\r\n\r\n.form-actions .p-button {\r\n  min-width: 140px;\r\n  padding: 0.75rem 1.5rem;\r\n  font-weight: 500;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .form-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n\r\n  .form-actions {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .leave-form {\r\n    padding: 0.5rem;\r\n  }\r\n\r\n  .corporate-input,\r\n  .corporate-dropdown {\r\n    padding: 0.6rem;\r\n    font-size: 0.9rem;\r\n  }\r\n\r\n  .input-label {\r\n    font-size: 0.85rem;\r\n  }\r\n\r\n  .checkbox-label {\r\n    font-size: 0.9rem;\r\n  }\r\n\r\n  .file-list {\r\n    padding: 0.5rem;\r\n  }\r\n\r\n  .file-item {\r\n    padding: 0.4rem;\r\n  }\r\n\r\n  .file-name {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n/* DateTime input styling */\r\n.datetime-inputs {\r\n  display: flex;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.date-input {\r\n  flex: 2;\r\n}\r\n\r\n.time-input {\r\n  flex: 1;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .datetime-inputs {\r\n    flex-direction: column;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .date-input, .time-input {\r\n    flex: 1;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .leave-form {\r\n    padding: 0.25rem;\r\n  }\r\n\r\n  .form-grid {\r\n    gap: 1rem;\r\n  }\r\n\r\n  .corporate-input,\r\n  .corporate-dropdown {\r\n    padding: 0.5rem;\r\n    font-size: 0.85rem;\r\n  }\r\n\r\n  .input-label {\r\n    font-size: 0.8rem;\r\n  }\r\n\r\n  .form-actions .p-button {\r\n    min-width: 100%;\r\n    padding: 0.6rem 1rem;\r\n    font-size: 0.9rem;\r\n  }\r\n\r\n  .checkbox-group {\r\n    padding: 0.75rem 0;\r\n  }\r\n\r\n  .checkbox-label {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n.user-option {\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 0.5rem 0;\r\n}\r\n\r\n.user-name {\r\n  font-weight: 500;\r\n  color: #495057;\r\n}\r\n\r\n.user-role {\r\n  font-size: 0.875rem;\r\n  color: #6c757d;\r\n  margin-top: 0.25rem;\r\n}\r\n\r\n.corporate-input :deep(.p-autocomplete-panel) {\r\n  max-height: 250px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.quota-display {\r\n  margin-top: 0.5rem;\r\n  padding: 0.75rem;\r\n  background: #f8f9fa;\r\n  border-radius: 6px;\r\n  border-left: 4px solid #007bff;\r\n  min-height: 3rem;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.quota-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.quota-label {\r\n  font-weight: 500;\r\n  color: #495057;\r\n}\r\n\r\n.quota-value {\r\n  font-weight: bold;\r\n  padding: 0.25rem 0.5rem;\r\n  border-radius: 4px;\r\n}\r\n\r\n.quota-normal {\r\n  background: #d4edda;\r\n  color: #155724;\r\n}\r\n\r\n.quota-low {\r\n  background: #fff3cd;\r\n  color: #856404;\r\n}\r\n\r\n.quota-zero {\r\n  background: #f8d7da;\r\n  color: #721c24;\r\n}\r\n\r\n.quota-total {\r\n  color: #6c757d;\r\n  font-size: 0.85rem;\r\n}\r\n\r\n.leave-type-option {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 0.5rem 0;\r\n  gap: 1rem;\r\n}\r\n\r\n.disabled-option {\r\n  background-color: #f8f9fa !important;\r\n  color: #6c757d !important;\r\n  cursor: not-allowed !important;\r\n}\r\n\r\n.quota-status {\r\n  font-size: 0.75rem;\r\n  color: #dc3545;\r\n  font-weight: 500;\r\n  background: #f8d7da;\r\n  padding: 0.2rem 0.4rem;\r\n  border-radius: 3px;\r\n}\r\n\r\n.quota-placeholder {\r\n  background: #f8f9fa;\r\n  border-left: 4px solid #dee2e6;\r\n}\r\n\r\n.quota-placeholder-text {\r\n  color: #6c757d;\r\n  font-style: italic;\r\n  font-size: 0.9rem;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}