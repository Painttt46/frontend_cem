{"ast":null,"code":"import { ref, computed, useSlots } from 'vue';\nexport default {\n  __name: 'EnhancedDataTable',\n  props: {\n    data: {\n      type: Array,\n      required: true\n    },\n    columns: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    /* eslint-disable no-undef */\n    const props = __props;\n    const slots = useSlots();\n    const localSearch = ref('');\n    const advancedMode = ref(false);\n    const filters = ref([{\n      column: '',\n      operator: 'contains',\n      value: ''\n    }]);\n    const operators = [{\n      label: 'มีคำว่า',\n      value: 'contains'\n    }, {\n      label: 'เท่ากับ',\n      value: 'equals'\n    }, {\n      label: 'ไม่เท่ากับ',\n      value: 'notEquals'\n    }, {\n      label: 'เริ่มต้นด้วย',\n      value: 'startsWith'\n    }, {\n      label: 'ลงท้ายด้วย',\n      value: 'endsWith'\n    }, {\n      label: 'มากกว่า',\n      value: 'greaterThan'\n    }, {\n      label: 'น้อยกว่า',\n      value: 'lessThan'\n    }];\n\n    // Normalize Thai text for search - simpler version\n    const normalizeText = text => {\n      if (!text) return '';\n      return String(text).toLowerCase().trim();\n    };\n\n    // Get searchable columns from props or slots\n    const searchableColumns = computed(() => {\n      if (props.columns && props.columns.length > 0) {\n        return props.columns.filter(col => col.field);\n      }\n\n      // Extract from slot children\n      const defaultSlot = slots.default?.();\n      if (defaultSlot) {\n        return defaultSlot.filter(vnode => vnode.props?.field).map(vnode => ({\n          field: vnode.props.field,\n          header: vnode.props.header || vnode.props.field\n        }));\n      }\n      return [];\n    });\n\n    // Apply single filter\n    const applyFilter = (item, filter) => {\n      const fieldValue = normalizeText(item[filter.column]);\n      const searchValue = normalizeText(filter.value);\n      switch (filter.operator) {\n        case 'contains':\n          return fieldValue.includes(searchValue);\n        case 'equals':\n          return fieldValue === searchValue;\n        case 'notEquals':\n          return fieldValue !== searchValue;\n        case 'startsWith':\n          return fieldValue.startsWith(searchValue);\n        case 'endsWith':\n          return fieldValue.endsWith(searchValue);\n        case 'greaterThan':\n          return parseFloat(fieldValue) > parseFloat(searchValue);\n        case 'lessThan':\n          return parseFloat(fieldValue) < parseFloat(searchValue);\n        default:\n          return true;\n      }\n    };\n\n    // Filter data based on search mode\n    const filteredData = computed(() => {\n      let result = props.data;\n\n      // Advanced mode: column-specific AND filters\n      if (advancedMode.value) {\n        const validFilters = filters.value.filter(f => f.column && f.value);\n        if (validFilters.length > 0) {\n          result = result.filter(item => {\n            return validFilters.every(filter => applyFilter(item, filter));\n          });\n        }\n      }\n      // Simple mode: global search - FIXED for Thai and mapped values\n      else if (localSearch.value) {\n        const query = normalizeText(localSearch.value);\n        result = result.filter(record => {\n          // Search in all fields\n          return Object.values(record).some(value => {\n            if (value === null || value === undefined) return false;\n            const strValue = normalizeText(value);\n\n            // Check if it's an object with label/value\n            if (typeof value === 'object' && value.label) {\n              return normalizeText(value.label).includes(query);\n            }\n\n            // Direct match\n            if (strValue.includes(query)) return true;\n\n            // For status/category fields, also check in slot content\n            // This allows searching by display label even if stored as code\n            return false;\n          });\n        });\n      }\n      return result;\n    });\n    const addFilter = () => {\n      filters.value.push({\n        column: '',\n        operator: 'contains',\n        value: ''\n      });\n    };\n    const removeFilter = index => {\n      if (filters.value.length > 1) {\n        filters.value.splice(index, 1);\n      }\n    };\n    const resetFilters = () => {\n      filters.value = [{\n        column: '',\n        operator: 'contains',\n        value: ''\n      }];\n    };\n    const __returned__ = {\n      props,\n      slots,\n      localSearch,\n      advancedMode,\n      filters,\n      operators,\n      normalizeText,\n      searchableColumns,\n      applyFilter,\n      filteredData,\n      addFilter,\n      removeFilter,\n      resetFilters,\n      ref,\n      computed,\n      useSlots\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","useSlots","props","__props","slots","localSearch","advancedMode","filters","column","operator","value","operators","label","normalizeText","text","String","toLowerCase","trim","searchableColumns","columns","length","filter","col","field","defaultSlot","default","vnode","map","header","applyFilter","item","fieldValue","searchValue","includes","startsWith","endsWith","parseFloat","filteredData","result","data","validFilters","f","every","query","record","Object","values","some","undefined","strValue","addFilter","push","removeFilter","index","splice","resetFilters"],"sources":["D:/frontend_cem/src/components/EnhancedDataTable.vue"],"sourcesContent":["<template>\n  <div class=\"enhanced-datatable\">\n    <!-- Search and Column Controls -->\n    <div class=\"table-controls mb-3\">\n      <div class=\"search-box\">\n        <IconField iconPosition=\"left\">\n          <InputIcon class=\"pi pi-search\" />\n          <InputText v-model=\"localSearch\" placeholder=\"ค้นหาทั่วไป...\" class=\"w-full\" />\n        </IconField>\n      </div>\n      <div class=\"control-buttons\">\n        <Button \n          :icon=\"advancedMode ? 'pi pi-times' : 'pi pi-filter'\" \n          :label=\"advancedMode ? 'ปิด' : 'ค้นหาขั้นสูง'\" \n          @click=\"advancedMode = !advancedMode\" \n          text \n          :severity=\"advancedMode ? 'danger' : 'info'\" \n        />\n      </div>\n    </div>\n\n    <!-- Advanced Search Filters -->\n    <div v-if=\"advancedMode\" class=\"advanced-search mb-3\">\n      <div v-for=\"(filter, index) in filters\" :key=\"index\" class=\"filter-row\">\n        <Dropdown \n          v-model=\"filter.column\" \n          :options=\"searchableColumns\" \n          optionLabel=\"header\" \n          optionValue=\"field\" \n          placeholder=\"เลือก Column\" \n          class=\"filter-column\" \n        />\n        <Dropdown \n          v-model=\"filter.operator\" \n          :options=\"operators\" \n          optionLabel=\"label\" \n          optionValue=\"value\" \n          placeholder=\"เงื่อนไข\" \n          class=\"filter-operator\" \n        />\n        <InputText \n          v-model=\"filter.value\" \n          placeholder=\"ค่าที่ค้นหา\" \n          class=\"filter-value\" \n        />\n        <Button \n          icon=\"pi pi-times\" \n          severity=\"danger\" \n          text \n          @click=\"removeFilter(index)\" \n          :disabled=\"filters.length === 1\" \n        />\n      </div>\n      <div class=\"filter-actions\">\n        <Button label=\"เพิ่มเงื่อนไข (AND)\" icon=\"pi pi-plus\" @click=\"addFilter\" text size=\"small\" />\n        <Button label=\"ล้าง\" icon=\"pi pi-refresh\" @click=\"resetFilters\" text size=\"small\" severity=\"secondary\" />\n      </div>\n    </div>\n\n    <!-- Pass through DataTable with filtered data -->\n    <DataTable \n      :value=\"filteredData\" \n      v-bind=\"$attrs\"\n    >\n      <slot />\n    </DataTable>\n  </div>\n</template>\n\n<script setup>\n/* eslint-disable no-undef */\nimport { ref, computed, useSlots } from 'vue'\n\nconst props = defineProps({\n  data: {\n    type: Array,\n    required: true\n  },\n  columns: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst slots = useSlots()\n\nconst localSearch = ref('')\nconst advancedMode = ref(false)\nconst filters = ref([\n  { column: '', operator: 'contains', value: '' }\n])\n\nconst operators = [\n  { label: 'มีคำว่า', value: 'contains' },\n  { label: 'เท่ากับ', value: 'equals' },\n  { label: 'ไม่เท่ากับ', value: 'notEquals' },\n  { label: 'เริ่มต้นด้วย', value: 'startsWith' },\n  { label: 'ลงท้ายด้วย', value: 'endsWith' },\n  { label: 'มากกว่า', value: 'greaterThan' },\n  { label: 'น้อยกว่า', value: 'lessThan' }\n]\n\n// Normalize Thai text for search - simpler version\nconst normalizeText = (text) => {\n  if (!text) return ''\n  return String(text).toLowerCase().trim()\n}\n\n// Get searchable columns from props or slots\nconst searchableColumns = computed(() => {\n  if (props.columns && props.columns.length > 0) {\n    return props.columns.filter(col => col.field)\n  }\n  \n  // Extract from slot children\n  const defaultSlot = slots.default?.()\n  if (defaultSlot) {\n    return defaultSlot\n      .filter(vnode => vnode.props?.field)\n      .map(vnode => ({\n        field: vnode.props.field,\n        header: vnode.props.header || vnode.props.field\n      }))\n  }\n  return []\n})\n\n// Apply single filter\nconst applyFilter = (item, filter) => {\n  const fieldValue = normalizeText(item[filter.column])\n  const searchValue = normalizeText(filter.value)\n\n  switch (filter.operator) {\n    case 'contains':\n      return fieldValue.includes(searchValue)\n    case 'equals':\n      return fieldValue === searchValue\n    case 'notEquals':\n      return fieldValue !== searchValue\n    case 'startsWith':\n      return fieldValue.startsWith(searchValue)\n    case 'endsWith':\n      return fieldValue.endsWith(searchValue)\n    case 'greaterThan':\n      return parseFloat(fieldValue) > parseFloat(searchValue)\n    case 'lessThan':\n      return parseFloat(fieldValue) < parseFloat(searchValue)\n    default:\n      return true\n  }\n}\n\n// Filter data based on search mode\nconst filteredData = computed(() => {\n  let result = props.data\n\n  // Advanced mode: column-specific AND filters\n  if (advancedMode.value) {\n    const validFilters = filters.value.filter(f => f.column && f.value)\n    \n    if (validFilters.length > 0) {\n      result = result.filter(item => {\n        return validFilters.every(filter => applyFilter(item, filter))\n      })\n    }\n  } \n  // Simple mode: global search - FIXED for Thai and mapped values\n  else if (localSearch.value) {\n    const query = normalizeText(localSearch.value)\n    result = result.filter(record => {\n      // Search in all fields\n      return Object.values(record).some((value) => {\n        if (value === null || value === undefined) return false\n        const strValue = normalizeText(value)\n        \n        // Check if it's an object with label/value\n        if (typeof value === 'object' && value.label) {\n          return normalizeText(value.label).includes(query)\n        }\n        \n        // Direct match\n        if (strValue.includes(query)) return true\n        \n        // For status/category fields, also check in slot content\n        // This allows searching by display label even if stored as code\n        return false\n      })\n    })\n  }\n\n  return result\n})\n\nconst addFilter = () => {\n  filters.value.push({ column: '', operator: 'contains', value: '' })\n}\n\nconst removeFilter = (index) => {\n  if (filters.value.length > 1) {\n    filters.value.splice(index, 1)\n  }\n}\n\nconst resetFilters = () => {\n  filters.value = [{ column: '', operator: 'contains', value: '' }]\n}\n</script>\n\n<style scoped>\n.table-controls {\n  display: flex;\n  gap: 1rem;\n  margin-bottom: 1rem;\n  flex-wrap: wrap;\n  align-items: center;\n}\n\n.search-box {\n  flex: 1;\n  min-width: 250px;\n}\n\n.column-options {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 0.5rem;\n  min-width: 200px;\n  max-height: 400px;\n  overflow-y: auto;\n}\n\n.column-option {\n  display: flex;\n  align-items: center;\n}\n\n.column-option label {\n  cursor: pointer;\n  user-select: none;\n  font-size: 0.9rem;\n}\n\n.control-buttons {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.advanced-search {\n  background: #f8f9fa;\n  border: 1px solid #dee2e6;\n  border-radius: 8px;\n  padding: 1rem;\n}\n\n.filter-row {\n  display: grid;\n  grid-template-columns: 2fr 1.5fr 2fr auto;\n  gap: 0.5rem;\n  align-items: center;\n  margin-bottom: 0.75rem;\n}\n\n.filter-column,\n.filter-operator,\n.filter-value {\n  width: 100%;\n}\n\n.filter-actions {\n  display: flex;\n  gap: 0.5rem;\n  padding-top: 0.5rem;\n  border-top: 1px solid #dee2e6;\n}\n\n@media (max-width: 768px) {\n  .table-controls {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .search-box {\n    width: 100%;\n  }\n  \n  .control-buttons {\n    width: 100%;\n    justify-content: space-between;\n  }\n\n  .filter-row {\n    grid-template-columns: 1fr;\n  }\n\n  .filter-actions {\n    flex-direction: column;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}