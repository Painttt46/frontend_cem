{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, normalizeStyle as _normalizeStyle, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"dashboard-container\"\n};\nconst _hoisted_2 = {\n  class: \"header-content\"\n};\nconst _hoisted_3 = {\n  class: \"header-left\"\n};\nconst _hoisted_4 = {\n  class: \"summary-grid mb-4\"\n};\nconst _hoisted_5 = {\n  class: \"summary-content\"\n};\nconst _hoisted_6 = {\n  class: \"summary-info\"\n};\nconst _hoisted_7 = {\n  class: \"summary-content\"\n};\nconst _hoisted_8 = {\n  class: \"summary-info\"\n};\nconst _hoisted_9 = {\n  class: \"summary-content\"\n};\nconst _hoisted_10 = {\n  class: \"summary-info\"\n};\nconst _hoisted_11 = {\n  class: \"summary-content\"\n};\nconst _hoisted_12 = {\n  class: \"summary-info\"\n};\nconst _hoisted_13 = {\n  class: \"summary-content\"\n};\nconst _hoisted_14 = {\n  class: \"summary-info\"\n};\nconst _hoisted_15 = {\n  class: \"summary-content\"\n};\nconst _hoisted_16 = {\n  class: \"summary-info\"\n};\nconst _hoisted_17 = {\n  class: \"summary-content\"\n};\nconst _hoisted_18 = {\n  class: \"summary-info\"\n};\nconst _hoisted_19 = {\n  class: \"summary-content\"\n};\nconst _hoisted_20 = {\n  class: \"summary-info\"\n};\nconst _hoisted_21 = {\n  class: \"charts-container mb-4\"\n};\nconst _hoisted_22 = {\n  class: \"chart-dots\"\n};\nconst _hoisted_23 = [\"onClick\"];\nconst _hoisted_24 = [\"onClick\"];\nconst _hoisted_25 = {\n  style: {\n    \"font-weight\": \"600\",\n    \"color\": \"#4A90E2\"\n  }\n};\nconst _hoisted_26 = {\n  class: \"task-breakdown\"\n};\nconst _hoisted_27 = {\n  style: {\n    \"font-weight\": \"600\",\n    \"color\": \"#10b981\"\n  }\n};\nconst _hoisted_28 = {\n  style: {\n    \"display\": \"flex\",\n    \"align-items\": \"center\",\n    \"gap\": \"0.5rem\"\n  }\n};\nconst _hoisted_29 = {\n  style: {\n    \"flex\": \"1\",\n    \"background\": \"#e9ecef\",\n    \"border-radius\": \"4px\",\n    \"height\": \"20px\",\n    \"overflow\": \"hidden\"\n  }\n};\nconst _hoisted_30 = {\n  style: {\n    \"min-width\": \"50px\",\n    \"text-align\": \"right\"\n  }\n};\nimport { ref, onMounted, nextTick, watch } from 'vue';\nimport { useErrorHandler } from '@/composables/useErrorHandler';\nimport { Chart } from 'chart.js/auto';\nimport axios from 'axios';\nimport userService from '@/services/userService';\nimport dailyWorkService from '@/services/dailyWorkService';\nimport UserInfoDialog from '@/components/UserInfoDialog.vue';\nimport { isCompleted, isActive } from '@/utils/statusHelper';\nexport default {\n  __name: 'Dashboard',\n  setup(__props) {\n    const {\n      handleError\n    } = useErrorHandler();\n    const loading = ref(false);\n    const leaveTypeColors = ref({});\n    const showUserDialog = ref(false);\n    const selectedUserId = ref(null);\n\n    // Swipe functionality\n    const currentChart = ref(0);\n    const chartsWrapper = ref(null);\n    let touchStartX = 0;\n    let touchEndX = 0;\n    const stats = ref({\n      totalUsers: 0,\n      workingToday: 0,\n      todayLeaves: 0,\n      activeCars: 0,\n      activeTasks: 0,\n      completedTasks: 0,\n      dueSoon: 0,\n      overdue: 0\n    });\n    const workStatistics = ref([]);\n    const expandedRows = ref([]);\n    const leaveChart = ref(null);\n    const taskChart = ref(null);\n    let leaveChartInstance = null;\n    let taskChartInstance = null;\n    onMounted(() => {\n      loadLeaveTypeColors();\n      loadData();\n    });\n\n    // Swipe handlers\n    const handleTouchStart = e => {\n      touchStartX = e.touches[0].clientX;\n    };\n    const handleTouchMove = e => {\n      touchEndX = e.touches[0].clientX;\n    };\n    const handleTouchEnd = () => {\n      const diff = touchStartX - touchEndX;\n      const threshold = 50;\n      if (Math.abs(diff) > threshold) {\n        if (diff > 0 && currentChart.value < 1) {\n          currentChart.value++;\n        } else if (diff < 0 && currentChart.value > 0) {\n          currentChart.value--;\n        }\n      }\n    };\n\n    // Watch chart changes for smooth transition\n    watch(currentChart, newVal => {\n      if (chartsWrapper.value) {\n        chartsWrapper.value.style.transform = `translateX(-${newVal * 100}%)`;\n      }\n    });\n    const loadLeaveTypeColors = async () => {\n      try {\n        const response = await axios.get('/api/leave/leave-types');\n        const colorMap = {};\n        response.data.forEach(type => {\n          colorMap[type.value] = type.color;\n        });\n        leaveTypeColors.value = colorMap;\n      } catch (error) {\n        handleError(error, {\n          customMessage: 'ไม่สามารถโหลดสีประเภทการลาได้',\n          showToast: false // ไม่แสดง toast เพราะไม่สำคัญมาก\n        });\n      }\n    };\n    const loadData = async () => {\n      loading.value = true;\n      try {\n        // ใช้ service layer พร้อม cache\n        const [activeUsers, leaves, cars, tasks, dailyWork] = await Promise.all([userService.getActiveUsers(),\n        // มี cache 5 นาที + filter is_active\n        axios.get('/api/leave').then(r => r.data), axios.get('/api/car-booking').then(r => r.data), axios.get('/api/tasks').then(r => r.data), dailyWorkService.getDailyWork() // มี cache 2 นาที\n        ]);\n\n        // Calculate stats\n        stats.value.totalUsers = activeUsers.length;\n        const today = new Date().toISOString().split('T')[0];\n        const todayDate = new Date(today + 'T00:00:00'); // Local midnight\n        const weekFromNow = new Date(todayDate);\n        weekFromNow.setDate(weekFromNow.getDate() + 7);\n\n        // Helper function to parse date as local\n        const parseLocalDate = dateStr => {\n          if (!dateStr) return null;\n          const datePart = dateStr.split('T')[0];\n          return new Date(datePart + 'T00:00:00');\n        };\n\n        // Get unique user IDs who have approved leave today\n        const todayLeavesUsers = leaves.filter(l => {\n          if (l.status !== 'approved') return false;\n          if (!l.start_datetime || !l.end_datetime) return false;\n\n          // แปลง UTC เป็น local date\n          const startDate = new Date(l.start_datetime);\n          const endDate = new Date(l.end_datetime);\n\n          // เปรียบเทียบแบบ local date (ไม่สนเวลา)\n          const startLocalDate = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());\n          const endLocalDate = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());\n          return startLocalDate <= todayDate && endLocalDate >= todayDate;\n        });\n\n        // Count unique users (DISTINCT user_id)\n        const uniqueUserIds = [...new Set(todayLeavesUsers.map(l => l.user_id))];\n        stats.value.todayLeaves = uniqueUserIds.length;\n\n        // พนักงานที่ทำงานวันนี้ = คนที่ลงงานรายวันวันนี้\n        const todayWorkUsers = dailyWork.filter(w => {\n          const workDate = w.work_date?.split('T')[0];\n          return workDate === today;\n        });\n        const uniqueWorkUserIds = [...new Set(todayWorkUsers.map(w => w.user_id))];\n        stats.value.workingToday = uniqueWorkUserIds.length;\n        stats.value.activeCars = cars.filter(c => c.status === 'active').length;\n        stats.value.activeTasks = tasks.filter(t => isActive(t.status)).length;\n        stats.value.completedTasks = tasks.filter(t => isCompleted(t.status)).length;\n\n        // งานที่ครบกำหนดสัปดาห์นี้\n        stats.value.dueSoon = tasks.filter(t => {\n          if (!t.project_end_date) return false;\n          const endDate = parseLocalDate(t.project_end_date);\n          return endDate >= todayDate && endDate <= weekFromNow && isActive(t.status);\n        }).length;\n\n        // งานที่เลยกำหนด\n        stats.value.overdue = tasks.filter(t => {\n          if (!t.project_end_date) return false;\n          const endDate = parseLocalDate(t.project_end_date);\n          return endDate < todayDate && isActive(t.status);\n        }).length;\n\n        // Work Statistics - คำนวณเวลาทำงานของแต่ละคน (รายปี)\n        const currentYear = new Date().getFullYear();\n        const userWorkData = {};\n        dailyWork.forEach(w => {\n          const workYear = new Date(w.work_date).getFullYear();\n          if (workYear !== currentYear) return;\n          const userId = w.user_id;\n          if (!userId) return; // ข้ามถ้าไม่มี userId\n\n          if (!userWorkData[userId]) {\n            const user = activeUsers.find(u => u.id === userId);\n            if (!user) return; // ข้ามถ้าไม่เจอ user ใน activeUsers\n\n            userWorkData[userId] = {\n              userId: userId,\n              userName: `${user.firstname} ${user.lastname}`,\n              department: user.department || 'N/A',\n              totalHours: 0,\n              taskCount: 0,\n              taskHours: {} // เก็บชั่วโมงของแต่ละงาน\n            };\n          }\n\n          // คำนวณชั่วโมงจาก start_time และ end_time\n          if (w.start_time && w.end_time) {\n            const [startH, startM] = w.start_time.split(':').map(Number);\n            const [endH, endM] = w.end_time.split(':').map(Number);\n            const hours = endH + endM / 60 - (startH + startM / 60);\n            if (hours > 0) {\n              userWorkData[userId].totalHours += hours;\n\n              // เก็บชั่วโมงของแต่ละงาน\n              const taskName = w.task_name || w.project_name || 'ไม่ระบุ';\n              if (!userWorkData[userId].taskHours[taskName]) {\n                userWorkData[userId].taskHours[taskName] = 0;\n              }\n              userWorkData[userId].taskHours[taskName] += hours;\n            }\n          }\n          userWorkData[userId].taskCount += 1;\n        });\n        workStatistics.value = Object.values(userWorkData).map(data => {\n          // สร้างรายละเอียดงานทั้งหมด\n          const taskDetails = Object.entries(data.taskHours).map(([taskName, hours]) => ({\n            taskName: taskName,\n            hours: hours,\n            percentage: hours / data.totalHours * 100\n          })).sort((a, b) => b.hours - a.hours);\n          return {\n            userId: data.userId,\n            userName: data.userName,\n            department: data.department,\n            totalHours: data.totalHours,\n            taskCount: data.taskCount,\n            avgHoursPerTask: data.taskCount > 0 ? data.totalHours / data.taskCount : 0,\n            taskDetails: taskDetails\n          };\n        }).sort((a, b) => b.totalHours - a.totalHours);\n        await nextTick();\n        renderCharts(leaves, tasks);\n      } catch (error) {\n        handleError(error, {\n          customMessage: 'ไม่สามารถโหลดข้อมูล Dashboard ได้ กรุณาลองใหม่อีกครั้ง'\n        });\n      } finally {\n        loading.value = false;\n      }\n    };\n    const renderCharts = (leaves, tasks) => {\n      // Leave Chart - แสดงจำนวนวันลาของแต่ละคนแยกตามประเภท (รายปี)\n      if (leaveChartInstance) leaveChartInstance.destroy();\n      const currentYear = new Date().getFullYear();\n      const users = {};\n      const leaveTypes = new Set();\n\n      // รวบรวมข้อมูล\n      leaves.forEach(l => {\n        if (l.status !== 'approved') return;\n        const leaveYear = new Date(l.start_datetime).getFullYear();\n        if (leaveYear !== currentYear) return;\n        const userName = l.user_name || 'ไม่ระบุ';\n        const leaveType = l.leave_type || 'อื่นๆ';\n        const days = parseFloat(l.total_days) || 0;\n        if (!users[userName]) {\n          users[userName] = {};\n        }\n        if (!users[userName][leaveType]) {\n          users[userName][leaveType] = 0;\n        }\n        users[userName][leaveType] += days;\n        leaveTypes.add(leaveType);\n      });\n\n      // สร้าง datasets สำหรับแต่ละประเภทการลา\n      const datasets = Array.from(leaveTypes).map(type => ({\n        label: type,\n        data: Object.keys(users).map(userName => users[userName][type] || 0),\n        backgroundColor: leaveTypeColors.value[type] || '#' + Math.floor(Math.random() * 16777215).toString(16)\n      }));\n      leaveChartInstance = new Chart(leaveChart.value, {\n        type: 'bar',\n        data: {\n          labels: Object.keys(users),\n          datasets: datasets\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            x: {\n              stacked: false\n            },\n            y: {\n              beginAtZero: true,\n              title: {\n                display: true,\n                text: 'จำนวนวัน'\n              }\n            }\n          },\n          plugins: {\n            legend: {\n              display: true,\n              position: 'top'\n            }\n          }\n        }\n      });\n\n      // Task Chart\n      if (taskChartInstance) taskChartInstance.destroy();\n      const taskStatus = {};\n      tasks.forEach(t => {\n        taskStatus[t.status || 'pending'] = (taskStatus[t.status || 'pending'] || 0) + 1;\n      });\n      taskChartInstance = new Chart(taskChart.value, {\n        type: 'doughnut',\n        data: {\n          labels: Object.keys(taskStatus),\n          datasets: [{\n            data: Object.values(taskStatus),\n            backgroundColor: ['#f59e0b', '#4A90E2', '#10b981', '#ef4444']\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false\n        }\n      });\n    };\n    return (_ctx, _cache) => {\n      const _component_Toast = _resolveComponent(\"Toast\");\n      const _component_Button = _resolveComponent(\"Button\");\n      const _component_Card = _resolveComponent(\"Card\");\n      const _component_Column = _resolveComponent(\"Column\");\n      const _component_DataTable = _resolveComponent(\"DataTable\");\n      return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_Toast), _createVNode(_component_Card, {\n        class: \"header-card mb-4\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_Button, {\n          icon: \"pi pi-arrow-left\",\n          onClick: _cache[0] || (_cache[0] = $event => _ctx.$router.go(-1)),\n          text: \"\",\n          class: \"back-btn\"\n        }), _cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n          class: \"header-title\"\n        }, [_createElementVNode(\"i\", {\n          class: \"pi pi-chart-bar header-icon\"\n        }), _createElementVNode(\"h1\", null, \"Dashboard\")], -1))])])]),\n        _: 1\n      }), _createElementVNode(\"div\", _hoisted_4, [loading.value ? (_openBlock(), _createElementBlock(_Fragment, {\n        key: 0\n      }, _renderList(8, i => {\n        return _createVNode(_component_Card, {\n          key: i,\n          class: \"summary-card\"\n        }, {\n          content: _withCtx(() => [...(_cache[3] || (_cache[3] = [_createElementVNode(\"div\", {\n            class: \"summary-content\"\n          }, [_createElementVNode(\"div\", {\n            class: \"skeleton skeleton-icon\"\n          }), _createElementVNode(\"div\", {\n            class: \"summary-info\"\n          }, [_createElementVNode(\"div\", {\n            class: \"skeleton skeleton-text\",\n            style: {\n              \"width\": \"60px\",\n              \"height\": \"32px\"\n            }\n          }), _createElementVNode(\"div\", {\n            class: \"skeleton skeleton-text\",\n            style: {\n              \"width\": \"120px\",\n              \"height\": \"16px\",\n              \"margin-top\": \"8px\"\n            }\n          })])], -1)]))]),\n          _: 1\n        });\n      }), 64)) : (_openBlock(), _createElementBlock(_Fragment, {\n        key: 1\n      }, [_createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_5, [_cache[5] || (_cache[5] = _createElementVNode(\"i\", {\n          class: \"pi pi-users summary-icon\",\n          style: {\n            \"color\": \"#4A90E2\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.totalUsers), 1), _cache[4] || (_cache[4] = _createElementVNode(\"p\", null, \"ผู้ใช้งานทั้งหมด\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_7, [_cache[7] || (_cache[7] = _createElementVNode(\"i\", {\n          class: \"pi pi-user-plus summary-icon\",\n          style: {\n            \"color\": \"#10b981\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.workingToday), 1), _cache[6] || (_cache[6] = _createElementVNode(\"p\", null, \"พนักงานทำงานวันนี้\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_9, [_cache[9] || (_cache[9] = _createElementVNode(\"i\", {\n          class: \"pi pi-calendar-times summary-icon\",\n          style: {\n            \"color\": \"#f59e0b\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.todayLeaves), 1), _cache[8] || (_cache[8] = _createElementVNode(\"p\", null, \"ลางานวันนี้\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_11, [_cache[11] || (_cache[11] = _createElementVNode(\"i\", {\n          class: \"pi pi-car summary-icon\",\n          style: {\n            \"color\": \"#06b6d4\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.activeCars), 1), _cache[10] || (_cache[10] = _createElementVNode(\"p\", null, \"รถกำลังใช้งาน\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_13, [_cache[13] || (_cache[13] = _createElementVNode(\"i\", {\n          class: \"pi pi-clock summary-icon\",\n          style: {\n            \"color\": \"#3b82f6\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.dueSoon), 1), _cache[12] || (_cache[12] = _createElementVNode(\"p\", null, \"งานครบกำหนดสัปดาห์นี้\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_15, [_cache[15] || (_cache[15] = _createElementVNode(\"i\", {\n          class: \"pi pi-exclamation-triangle summary-icon\",\n          style: {\n            \"color\": \"#ef4444\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_16, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.overdue), 1), _cache[14] || (_cache[14] = _createElementVNode(\"p\", null, \"งานเลยกำหนด\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_17, [_cache[17] || (_cache[17] = _createElementVNode(\"i\", {\n          class: \"pi pi-briefcase summary-icon\",\n          style: {\n            \"color\": \"#8b5cf6\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_18, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.activeTasks), 1), _cache[16] || (_cache[16] = _createElementVNode(\"p\", null, \"งานกำลังดำเนินการ\", -1))])])]),\n        _: 1\n      }), _createVNode(_component_Card, {\n        class: \"summary-card\"\n      }, {\n        content: _withCtx(() => [_createElementVNode(\"div\", _hoisted_19, [_cache[19] || (_cache[19] = _createElementVNode(\"i\", {\n          class: \"pi pi-check-circle summary-icon\",\n          style: {\n            \"color\": \"#22c55e\"\n          }\n        }, null, -1)), _createElementVNode(\"div\", _hoisted_20, [_createElementVNode(\"h3\", null, _toDisplayString(stats.value.completedTasks), 1), _cache[18] || (_cache[18] = _createElementVNode(\"p\", null, \"งานเสร็จสิ้น\", -1))])])]),\n        _: 1\n      })], 64))]), _createElementVNode(\"div\", _hoisted_21, [_createElementVNode(\"div\", {\n        class: \"charts-wrapper\",\n        ref_key: \"chartsWrapper\",\n        ref: chartsWrapper,\n        onTouchstart: handleTouchStart,\n        onTouchmove: handleTouchMove,\n        onTouchend: handleTouchEnd\n      }, [_createVNode(_component_Card, {\n        class: _normalizeClass([\"chart-card\", {\n          active: currentChart.value === 0\n        }])\n      }, {\n        content: _withCtx(() => [_cache[20] || (_cache[20] = _createElementVNode(\"h3\", null, \"จำนวนวันลาของพนักงาน (รายปี)\", -1)), _createElementVNode(\"canvas\", {\n          ref_key: \"leaveChart\",\n          ref: leaveChart\n        }, null, 512)]),\n        _: 1\n      }, 8, [\"class\"]), _createVNode(_component_Card, {\n        class: _normalizeClass([\"chart-card\", {\n          active: currentChart.value === 1\n        }])\n      }, {\n        content: _withCtx(() => [_cache[21] || (_cache[21] = _createElementVNode(\"h3\", null, \"สถานะงาน\", -1)), _createElementVNode(\"canvas\", {\n          ref_key: \"taskChart\",\n          ref: taskChart\n        }, null, 512)]),\n        _: 1\n      }, 8, [\"class\"])], 544), _createElementVNode(\"div\", _hoisted_22, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList(2, i => {\n        return _createElementVNode(\"span\", {\n          key: i,\n          class: _normalizeClass({\n            active: currentChart.value === i - 1\n          }),\n          onClick: $event => currentChart.value = i - 1\n        }, null, 10, _hoisted_23);\n      }), 64))])]), _createVNode(_component_Card, null, {\n        content: _withCtx(() => [_cache[23] || (_cache[23] = _createElementVNode(\"h3\", {\n          class: \"mb-3\"\n        }, \"สถิติเวลาทำงานของพนักงาน (รายปี)\", -1)), _createVNode(_component_DataTable, {\n          value: workStatistics.value,\n          loading: loading.value,\n          paginator: \"\",\n          rows: 10,\n          sortField: \"totalHours\",\n          sortOrder: -1,\n          expandedRows: expandedRows.value\n        }, {\n          expansion: _withCtx(({\n            data\n          }) => [_createElementVNode(\"div\", _hoisted_26, [_cache[22] || (_cache[22] = _createElementVNode(\"h4\", null, \"รายละเอียดงานทั้งหมด\", -1)), _createVNode(_component_DataTable, {\n            value: data.taskDetails,\n            class: \"p-datatable-sm\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_Column, {\n              field: \"taskName\",\n              header: \"ชื่องาน\",\n              style: {\n                \"min-width\": \"200px\"\n              }\n            }), _createVNode(_component_Column, {\n              field: \"hours\",\n              header: \"ชั่วโมง\",\n              sortable: \"\"\n            }, {\n              body: _withCtx(({\n                data: task\n              }) => [_createElementVNode(\"span\", _hoisted_27, _toDisplayString(task.hours.toFixed(1)) + \" ชม.\", 1)]),\n              _: 1\n            }), _createVNode(_component_Column, {\n              field: \"percentage\",\n              header: \"สัดส่วน\",\n              sortable: \"\"\n            }, {\n              body: _withCtx(({\n                data: task\n              }) => [_createElementVNode(\"div\", _hoisted_28, [_createElementVNode(\"div\", _hoisted_29, [_createElementVNode(\"div\", {\n                style: _normalizeStyle({\n                  width: task.percentage + '%',\n                  background: '#4A90E2',\n                  height: '100%'\n                })\n              }, null, 4)]), _createElementVNode(\"span\", _hoisted_30, _toDisplayString(task.percentage.toFixed(1)) + \"%\", 1)])]),\n              _: 1\n            })]),\n            _: 1\n          }, 8, [\"value\"])])]),\n          default: _withCtx(() => [_createVNode(_component_Column, {\n            expander: true,\n            style: {\n              \"width\": \"3rem\"\n            }\n          }), _createVNode(_component_Column, {\n            field: \"userName\",\n            header: \"ชื่อพนักงาน\",\n            sortable: \"\",\n            style: {\n              \"min-width\": \"150px\"\n            }\n          }, {\n            body: _withCtx(({\n              data\n            }) => [_createElementVNode(\"span\", {\n              class: \"clickable-name\",\n              onClick: $event => {\n                selectedUserId.value = data.userId;\n                showUserDialog.value = true;\n              }\n            }, _toDisplayString(data.userName), 9, _hoisted_24)]),\n            _: 1\n          }), _createVNode(_component_Column, {\n            field: \"department\",\n            header: \"แผนก\",\n            sortable: \"\",\n            style: {\n              \"min-width\": \"120px\"\n            }\n          }), _createVNode(_component_Column, {\n            field: \"totalHours\",\n            header: \"รวมชั่วโมง\",\n            sortable: \"\",\n            style: {\n              \"min-width\": \"120px\"\n            }\n          }, {\n            body: _withCtx(({\n              data\n            }) => [_createElementVNode(\"span\", _hoisted_25, _toDisplayString(data.totalHours.toFixed(1)) + \" ชม.\", 1)]),\n            _: 1\n          }), _createVNode(_component_Column, {\n            field: \"taskCount\",\n            header: \"จำนวนงาน\",\n            sortable: \"\",\n            style: {\n              \"min-width\": \"100px\"\n            }\n          }), _createVNode(_component_Column, {\n            field: \"avgHoursPerTask\",\n            header: \"เฉลี่ย/งาน\",\n            sortable: \"\",\n            style: {\n              \"min-width\": \"100px\"\n            }\n          }, {\n            body: _withCtx(({\n              data\n            }) => [_createTextVNode(_toDisplayString(data.avgHoursPerTask.toFixed(1)) + \" ชม. \", 1)]),\n            _: 1\n          })]),\n          _: 1\n        }, 8, [\"value\", \"loading\", \"expandedRows\"])]),\n        _: 1\n      })]), showUserDialog.value ? (_openBlock(), _createBlock(UserInfoDialog, {\n        key: 0,\n        visible: true,\n        \"onUpdate:visible\": _cache[1] || (_cache[1] = $event => showUserDialog.value = false),\n        userId: selectedUserId.value\n      }, null, 8, [\"userId\"])) : _createCommentVNode(\"\", true)], 64);\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","nextTick","watch","useErrorHandler","Chart","axios","userService","dailyWorkService","UserInfoDialog","isCompleted","isActive","handleError","loading","leaveTypeColors","showUserDialog","selectedUserId","currentChart","chartsWrapper","touchStartX","touchEndX","stats","totalUsers","workingToday","todayLeaves","activeCars","activeTasks","completedTasks","dueSoon","overdue","workStatistics","expandedRows","leaveChart","taskChart","leaveChartInstance","taskChartInstance","loadLeaveTypeColors","loadData","handleTouchStart","e","touches","clientX","handleTouchMove","handleTouchEnd","diff","threshold","Math","abs","value","newVal","style","transform","response","get","colorMap","data","forEach","type","color","error","customMessage","showToast","activeUsers","leaves","cars","tasks","dailyWork","Promise","all","getActiveUsers","then","r","getDailyWork","length","today","Date","toISOString","split","todayDate","weekFromNow","setDate","getDate","parseLocalDate","dateStr","datePart","todayLeavesUsers","filter","l","status","start_datetime","end_datetime","startDate","endDate","startLocalDate","getFullYear","getMonth","endLocalDate","uniqueUserIds","Set","map","user_id","todayWorkUsers","w","workDate","work_date","uniqueWorkUserIds","c","t","project_end_date","currentYear","userWorkData","workYear","userId","user","find","u","id","userName","firstname","lastname","department","totalHours","taskCount","taskHours","start_time","end_time","startH","startM","Number","endH","endM","hours","taskName","task_name","project_name","Object","values","taskDetails","entries","percentage","sort","a","b","avgHoursPerTask","renderCharts","destroy","users","leaveTypes","leaveYear","user_name","leaveType","leave_type","days","parseFloat","total_days","add","datasets","Array","from","label","keys","backgroundColor","floor","random","toString","labels","options","responsive","maintainAspectRatio","scales","x","stacked","y","beginAtZero","title","display","text","plugins","legend","position","taskStatus","_createElementVNode","_hoisted_1","_createVNode","_component_Toast","_component_Card","class","content","_withCtx","_hoisted_2","_hoisted_3","_component_Button","icon","onClick","_cache","$event","_ctx","$router","go","_hoisted_4","_createElementBlock","_Fragment","key","_renderList","i","_hoisted_5","_hoisted_6","_toDisplayString","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","onTouchstart","onTouchmove","onTouchend","_normalizeClass","active","_hoisted_22","_component_DataTable","paginator","rows","sortField","sortOrder","expansion","_hoisted_26","_component_Column","field","header","sortable","body","task","_hoisted_27","toFixed","_hoisted_28","_hoisted_29","_normalizeStyle","width","background","height","_hoisted_30","expander","_hoisted_24","_hoisted_25","_createBlock","visible"],"sources":["D:/frontend_cem/src/views/management/Dashboard.vue","D:\\frontend_cem\\src\\views\\management\\Dashboard.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div class=\"dashboard-container\">\r\n    <Toast />\r\n    \r\n    <!-- Header -->\r\n    <Card class=\"header-card mb-4\">\r\n      <template #content>\r\n        <div class=\"header-content\">\r\n          <div class=\"header-left\">\r\n            <Button icon=\"pi pi-arrow-left\" @click=\"$router.go(-1)\" text class=\"back-btn\" />\r\n            <div class=\"header-title\">\r\n              <i class=\"pi pi-chart-bar header-icon\"></i>\r\n              <h1>Dashboard</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </Card>\r\n\r\n    <!-- Summary Cards -->\r\n    <div class=\"summary-grid mb-4\">\r\n      <!-- Loading Skeleton -->\r\n      <template v-if=\"loading\">\r\n        <Card v-for=\"i in 8\" :key=\"i\" class=\"summary-card\">\r\n          <template #content>\r\n            <div class=\"summary-content\">\r\n              <div class=\"skeleton skeleton-icon\"></div>\r\n              <div class=\"summary-info\">\r\n                <div class=\"skeleton skeleton-text\" style=\"width: 60px; height: 32px;\"></div>\r\n                <div class=\"skeleton skeleton-text\" style=\"width: 120px; height: 16px; margin-top: 8px;\"></div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </Card>\r\n      </template>\r\n      \r\n      <!-- Actual Data -->\r\n      <template v-else>\r\n        <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-users summary-icon\" style=\"color: #4A90E2\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.totalUsers }}</h3>\r\n              <p>ผู้ใช้งานทั้งหมด</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-user-plus summary-icon\" style=\"color: #10b981\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.workingToday }}</h3>\r\n              <p>พนักงานทำงานวันนี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-calendar-times summary-icon\" style=\"color: #f59e0b\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.todayLeaves }}</h3>\r\n              <p>ลางานวันนี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-car summary-icon\" style=\"color: #06b6d4\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.activeCars }}</h3>\r\n              <p>รถกำลังใช้งาน</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-clock summary-icon\" style=\"color: #3b82f6\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.dueSoon }}</h3>\r\n              <p>งานครบกำหนดสัปดาห์นี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-exclamation-triangle summary-icon\" style=\"color: #ef4444\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.overdue }}</h3>\r\n              <p>งานเลยกำหนด</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-briefcase summary-icon\" style=\"color: #8b5cf6\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.activeTasks }}</h3>\r\n              <p>งานกำลังดำเนินการ</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-check-circle summary-icon\" style=\"color: #22c55e\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.completedTasks }}</h3>\r\n              <p>งานเสร็จสิ้น</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n      </template>\r\n    </div>\r\n\r\n    <!-- Charts with Swipe Support -->\r\n    <div class=\"charts-container mb-4\">\r\n      <div class=\"charts-wrapper\" \r\n           ref=\"chartsWrapper\"\r\n           @touchstart=\"handleTouchStart\"\r\n           @touchmove=\"handleTouchMove\"\r\n           @touchend=\"handleTouchEnd\">\r\n        <Card class=\"chart-card\" :class=\"{ active: currentChart === 0 }\">\r\n          <template #content>\r\n            <h3>จำนวนวันลาของพนักงาน (รายปี)</h3>\r\n            <canvas ref=\"leaveChart\"></canvas>\r\n          </template>\r\n        </Card>\r\n\r\n        <Card class=\"chart-card\" :class=\"{ active: currentChart === 1 }\">\r\n          <template #content>\r\n            <h3>สถานะงาน</h3>\r\n            <canvas ref=\"taskChart\"></canvas>\r\n          </template>\r\n        </Card>\r\n      </div>\r\n      \r\n      <!-- Chart Navigation Dots (Mobile) -->\r\n      <div class=\"chart-dots\">\r\n        <span v-for=\"i in 2\" :key=\"i\" \r\n              :class=\"{ active: currentChart === i - 1 }\"\r\n              @click=\"currentChart = i - 1\"></span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Work Statistics -->\r\n    <Card>\r\n      <template #content>\r\n        <h3 class=\"mb-3\">สถิติเวลาทำงานของพนักงาน (รายปี)</h3>\r\n        <DataTable :value=\"workStatistics\" :loading=\"loading\" paginator :rows=\"10\" sortField=\"totalHours\" :sortOrder=\"-1\"\r\n                   :expandedRows=\"expandedRows\">\r\n          <Column :expander=\"true\" style=\"width: 3rem\" />\r\n          <Column field=\"userName\" header=\"ชื่อพนักงาน\" sortable style=\"min-width: 150px\">\r\n            <template #body=\"{ data }\">\r\n              <span class=\"clickable-name\" @click=\"selectedUserId = data.userId; showUserDialog = true\">\r\n                {{ data.userName }}\r\n              </span>\r\n            </template>\r\n          </Column>\r\n          <Column field=\"department\" header=\"แผนก\" sortable style=\"min-width: 120px\" />\r\n          <Column field=\"totalHours\" header=\"รวมชั่วโมง\" sortable style=\"min-width: 120px\">\r\n            <template #body=\"{ data }\">\r\n              <span style=\"font-weight: 600; color: #4A90E2\">{{ data.totalHours.toFixed(1) }} ชม.</span>\r\n            </template>\r\n          </Column>\r\n          <Column field=\"taskCount\" header=\"จำนวนงาน\" sortable style=\"min-width: 100px\" />\r\n          <Column field=\"avgHoursPerTask\" header=\"เฉลี่ย/งาน\" sortable style=\"min-width: 100px\">\r\n            <template #body=\"{ data }\">\r\n              {{ data.avgHoursPerTask.toFixed(1) }} ชม.\r\n            </template>\r\n          </Column>\r\n          \r\n          <template #expansion=\"{ data }\">\r\n            <div class=\"task-breakdown\">\r\n              <h4>รายละเอียดงานทั้งหมด</h4>\r\n              <DataTable :value=\"data.taskDetails\" class=\"p-datatable-sm\">\r\n                <Column field=\"taskName\" header=\"ชื่องาน\" style=\"min-width: 200px\" />\r\n                <Column field=\"hours\" header=\"ชั่วโมง\" sortable>\r\n                  <template #body=\"{ data: task }\">\r\n                    <span style=\"font-weight: 600; color: #10b981\">{{ task.hours.toFixed(1) }} ชม.</span>\r\n                  </template>\r\n                </Column>\r\n                <Column field=\"percentage\" header=\"สัดส่วน\" sortable>\r\n                  <template #body=\"{ data: task }\">\r\n                    <div style=\"display: flex; align-items: center; gap: 0.5rem\">\r\n                      <div style=\"flex: 1; background: #e9ecef; border-radius: 4px; height: 20px; overflow: hidden\">\r\n                        <div :style=\"{ width: task.percentage + '%', background: '#4A90E2', height: '100%' }\"></div>\r\n                      </div>\r\n                      <span style=\"min-width: 50px; text-align: right\">{{ task.percentage.toFixed(1) }}%</span>\r\n                    </div>\r\n                  </template>\r\n                </Column>\r\n              </DataTable>\r\n            </div>\r\n          </template>\r\n        </DataTable>\r\n      </template>\r\n    </Card>\r\n  </div>\r\n\r\n  <UserInfoDialog v-if=\"showUserDialog\" :visible=\"true\" @update:visible=\"showUserDialog = false\" :userId=\"selectedUserId\" />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, nextTick, watch } from 'vue'\r\nimport { useErrorHandler } from '@/composables/useErrorHandler'\r\nimport { Chart } from 'chart.js/auto'\r\nimport axios from 'axios'\r\nimport userService from '@/services/userService'\r\nimport dailyWorkService from '@/services/dailyWorkService'\r\nimport UserInfoDialog from '@/components/UserInfoDialog.vue'\r\nimport { isCompleted, isActive } from '@/utils/statusHelper'\r\n\r\nconst { handleError } = useErrorHandler()\r\nconst loading = ref(false)\r\nconst leaveTypeColors = ref({})\r\nconst showUserDialog = ref(false)\r\nconst selectedUserId = ref(null)\r\n\r\n// Swipe functionality\r\nconst currentChart = ref(0)\r\nconst chartsWrapper = ref(null)\r\nlet touchStartX = 0\r\nlet touchEndX = 0\r\n\r\n\r\nconst stats = ref({\r\n  totalUsers: 0,\r\n  workingToday: 0,\r\n  todayLeaves: 0,\r\n  activeCars: 0,\r\n  activeTasks: 0,\r\n  completedTasks: 0,\r\n  dueSoon: 0,\r\n  overdue: 0\r\n})\r\n\r\nconst workStatistics = ref([])\r\nconst expandedRows = ref([])\r\nconst leaveChart = ref(null)\r\nconst taskChart = ref(null)\r\nlet leaveChartInstance = null\r\nlet taskChartInstance = null\r\n\r\nonMounted(() => {\r\n  loadLeaveTypeColors()\r\n  loadData()\r\n})\r\n\r\n// Swipe handlers\r\nconst handleTouchStart = (e) => {\r\n  touchStartX = e.touches[0].clientX\r\n}\r\n\r\nconst handleTouchMove = (e) => {\r\n  touchEndX = e.touches[0].clientX\r\n}\r\n\r\nconst handleTouchEnd = () => {\r\n  const diff = touchStartX - touchEndX\r\n  const threshold = 50\r\n  \r\n  if (Math.abs(diff) > threshold) {\r\n    if (diff > 0 && currentChart.value < 1) {\r\n      currentChart.value++\r\n    } else if (diff < 0 && currentChart.value > 0) {\r\n      currentChart.value--\r\n    }\r\n  }\r\n}\r\n\r\n// Watch chart changes for smooth transition\r\nwatch(currentChart, (newVal) => {\r\n  if (chartsWrapper.value) {\r\n    chartsWrapper.value.style.transform = `translateX(-${newVal * 100}%)`\r\n  }\r\n})\r\n\r\nconst loadLeaveTypeColors = async () => {\r\n  try {\r\n    const response = await axios.get('/api/leave/leave-types')\r\n    const colorMap = {}\r\n    response.data.forEach(type => {\r\n      colorMap[type.value] = type.color\r\n    })\r\n    leaveTypeColors.value = colorMap\r\n  } catch (error) {\r\n    handleError(error, {\r\n      customMessage: 'ไม่สามารถโหลดสีประเภทการลาได้',\r\n      showToast: false // ไม่แสดง toast เพราะไม่สำคัญมาก\r\n    })\r\n  }\r\n}\r\n\r\nconst loadData = async () => {\r\n  loading.value = true\r\n  \r\n  try {\r\n    // ใช้ service layer พร้อม cache\r\n    const [activeUsers, leaves, cars, tasks, dailyWork] = await Promise.all([\r\n      userService.getActiveUsers(),  // มี cache 5 นาที + filter is_active\r\n      axios.get('/api/leave').then(r => r.data),\r\n      axios.get('/api/car-booking').then(r => r.data),\r\n      axios.get('/api/tasks').then(r => r.data),\r\n      dailyWorkService.getDailyWork()  // มี cache 2 นาที\r\n    ])\r\n\r\n    // Calculate stats\r\n    stats.value.totalUsers = activeUsers.length\r\n    \r\n    const today = new Date().toISOString().split('T')[0]\r\n    const todayDate = new Date(today + 'T00:00:00') // Local midnight\r\n    const weekFromNow = new Date(todayDate)\r\n    weekFromNow.setDate(weekFromNow.getDate() + 7)\r\n    \r\n    // Helper function to parse date as local\r\n    const parseLocalDate = (dateStr) => {\r\n      if (!dateStr) return null\r\n      const datePart = dateStr.split('T')[0]\r\n      return new Date(datePart + 'T00:00:00')\r\n    }\r\n    \r\n    // Get unique user IDs who have approved leave today\r\n    const todayLeavesUsers = leaves.filter(l => {\r\n      if (l.status !== 'approved') return false\r\n      if (!l.start_datetime || !l.end_datetime) return false\r\n      \r\n      // แปลง UTC เป็น local date\r\n      const startDate = new Date(l.start_datetime)\r\n      const endDate = new Date(l.end_datetime)\r\n      \r\n      // เปรียบเทียบแบบ local date (ไม่สนเวลา)\r\n      const startLocalDate = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate())\r\n      const endLocalDate = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate())\r\n      \r\n      return startLocalDate <= todayDate && endLocalDate >= todayDate\r\n    })\r\n    \r\n    // Count unique users (DISTINCT user_id)\r\n    const uniqueUserIds = [...new Set(todayLeavesUsers.map(l => l.user_id))]\r\n    stats.value.todayLeaves = uniqueUserIds.length\r\n    \r\n    // พนักงานที่ทำงานวันนี้ = คนที่ลงงานรายวันวันนี้\r\n    const todayWorkUsers = dailyWork.filter(w => {\r\n      const workDate = w.work_date?.split('T')[0]\r\n      return workDate === today\r\n    })\r\n    const uniqueWorkUserIds = [...new Set(todayWorkUsers.map(w => w.user_id))]\r\n    stats.value.workingToday = uniqueWorkUserIds.length\r\n    \r\n    stats.value.activeCars = cars.filter(c => c.status === 'active').length\r\n    stats.value.activeTasks = tasks.filter(t => isActive(t.status)).length\r\n    stats.value.completedTasks = tasks.filter(t => isCompleted(t.status)).length\r\n    \r\n    // งานที่ครบกำหนดสัปดาห์นี้\r\n    stats.value.dueSoon = tasks.filter(t => {\r\n      if (!t.project_end_date) return false\r\n      const endDate = parseLocalDate(t.project_end_date)\r\n      return endDate >= todayDate && endDate <= weekFromNow && isActive(t.status)\r\n    }).length\r\n    \r\n    // งานที่เลยกำหนด\r\n    stats.value.overdue = tasks.filter(t => {\r\n      if (!t.project_end_date) return false\r\n      const endDate = parseLocalDate(t.project_end_date)\r\n      return endDate < todayDate && isActive(t.status)\r\n    }).length\r\n\r\n    // Work Statistics - คำนวณเวลาทำงานของแต่ละคน (รายปี)\r\n    const currentYear = new Date().getFullYear()\r\n    const userWorkData = {}\r\n    \r\n    dailyWork.forEach(w => {\r\n      const workYear = new Date(w.work_date).getFullYear()\r\n      if (workYear !== currentYear) return\r\n      \r\n      const userId = w.user_id\r\n      if (!userId) return // ข้ามถ้าไม่มี userId\r\n      \r\n      if (!userWorkData[userId]) {\r\n        const user = activeUsers.find(u => u.id === userId)\r\n        if (!user) return // ข้ามถ้าไม่เจอ user ใน activeUsers\r\n        \r\n        userWorkData[userId] = {\r\n          userId: userId,\r\n          userName: `${user.firstname} ${user.lastname}`,\r\n          department: user.department || 'N/A',\r\n          totalHours: 0,\r\n          taskCount: 0,\r\n          taskHours: {} // เก็บชั่วโมงของแต่ละงาน\r\n        }\r\n      }\r\n      \r\n      // คำนวณชั่วโมงจาก start_time และ end_time\r\n      if (w.start_time && w.end_time) {\r\n        const [startH, startM] = w.start_time.split(':').map(Number)\r\n        const [endH, endM] = w.end_time.split(':').map(Number)\r\n        const hours = (endH + endM/60) - (startH + startM/60)\r\n        \r\n        if (hours > 0) {\r\n          userWorkData[userId].totalHours += hours\r\n          \r\n          // เก็บชั่วโมงของแต่ละงาน\r\n          const taskName = w.task_name || w.project_name || 'ไม่ระบุ'\r\n          if (!userWorkData[userId].taskHours[taskName]) {\r\n            userWorkData[userId].taskHours[taskName] = 0\r\n          }\r\n          userWorkData[userId].taskHours[taskName] += hours\r\n        }\r\n      }\r\n      \r\n      userWorkData[userId].taskCount += 1\r\n    })\r\n    \r\n    workStatistics.value = Object.values(userWorkData).map(data => {\r\n      // สร้างรายละเอียดงานทั้งหมด\r\n      const taskDetails = Object.entries(data.taskHours)\r\n        .map(([taskName, hours]) => ({\r\n          taskName: taskName,\r\n          hours: hours,\r\n          percentage: (hours / data.totalHours) * 100\r\n        }))\r\n        .sort((a, b) => b.hours - a.hours)\r\n      \r\n      return {\r\n        userId: data.userId,\r\n        userName: data.userName,\r\n        department: data.department,\r\n        totalHours: data.totalHours,\r\n        taskCount: data.taskCount,\r\n        avgHoursPerTask: data.taskCount > 0 ? data.totalHours / data.taskCount : 0,\r\n        taskDetails: taskDetails\r\n      }\r\n    }).sort((a, b) => b.totalHours - a.totalHours)\r\n\r\n    await nextTick()\r\n    renderCharts(leaves, tasks)\r\n  } catch (error) {\r\n    handleError(error, {\r\n      customMessage: 'ไม่สามารถโหลดข้อมูล Dashboard ได้ กรุณาลองใหม่อีกครั้ง'\r\n    })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst renderCharts = (leaves, tasks) => {\r\n  // Leave Chart - แสดงจำนวนวันลาของแต่ละคนแยกตามประเภท (รายปี)\r\n  if (leaveChartInstance) leaveChartInstance.destroy()\r\n  \r\n  const currentYear = new Date().getFullYear()\r\n  const users = {}\r\n  const leaveTypes = new Set()\r\n  \r\n  // รวบรวมข้อมูล\r\n  leaves.forEach(l => {\r\n    if (l.status !== 'approved') return\r\n    const leaveYear = new Date(l.start_datetime).getFullYear()\r\n    if (leaveYear !== currentYear) return\r\n    \r\n    const userName = l.user_name || 'ไม่ระบุ'\r\n    const leaveType = l.leave_type || 'อื่นๆ'\r\n    const days = parseFloat(l.total_days) || 0\r\n    \r\n    if (!users[userName]) {\r\n      users[userName] = {}\r\n    }\r\n    if (!users[userName][leaveType]) {\r\n      users[userName][leaveType] = 0\r\n    }\r\n    users[userName][leaveType] += days\r\n    leaveTypes.add(leaveType)\r\n  })\r\n\r\n  // สร้าง datasets สำหรับแต่ละประเภทการลา\r\n  const datasets = Array.from(leaveTypes).map(type => ({\r\n    label: type,\r\n    data: Object.keys(users).map(userName => users[userName][type] || 0),\r\n    backgroundColor: leaveTypeColors.value[type] || '#' + Math.floor(Math.random()*16777215).toString(16)\r\n  }))\r\n\r\n  leaveChartInstance = new Chart(leaveChart.value, {\r\n    type: 'bar',\r\n    data: {\r\n      labels: Object.keys(users),\r\n      datasets: datasets\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      scales: {\r\n        x: {\r\n          stacked: false\r\n        },\r\n        y: {\r\n          beginAtZero: true,\r\n          title: {\r\n            display: true,\r\n            text: 'จำนวนวัน'\r\n          }\r\n        }\r\n      },\r\n      plugins: {\r\n        legend: {\r\n          display: true,\r\n          position: 'top'\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  // Task Chart\r\n  if (taskChartInstance) taskChartInstance.destroy()\r\n  \r\n  const taskStatus = {}\r\n  tasks.forEach(t => {\r\n    taskStatus[t.status || 'pending'] = (taskStatus[t.status || 'pending'] || 0) + 1\r\n  })\r\n\r\n  taskChartInstance = new Chart(taskChart.value, {\r\n    type: 'doughnut',\r\n    data: {\r\n      labels: Object.keys(taskStatus),\r\n      datasets: [{\r\n        data: Object.values(taskStatus),\r\n        backgroundColor: ['#f59e0b', '#4A90E2', '#10b981', '#ef4444']\r\n      }]\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.clickable-name {\r\n  cursor: pointer;\r\n  color: #667eea;\r\n  font-weight: 600;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.clickable-name:hover {\r\n  color: #764ba2;\r\n  text-decoration: underline;\r\n}\r\n\r\n.dashboard-container {\r\n  padding: 1rem;\r\n  max-width: 1400px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.header-card {\r\n  background: linear-gradient(135deg, #4A90E2, #D73527);\r\n  color: white;\r\n  border: none;\r\n}\r\n\r\n.header-content {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 1rem;\r\n}\r\n\r\n.header-left {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.header-title {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n}\r\n\r\n.header-icon {\r\n  font-size: 1.5rem;\r\n}\r\n\r\n.header-title h1 {\r\n  margin: 0;\r\n  font-size: 1.5rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.back-btn {\r\n  color: white !important;\r\n  background: rgba(255, 255, 255, 0.2) !important;\r\n  border: 1px solid rgba(255, 255, 255, 0.3) !important;\r\n  border-radius: 8px !important;\r\n  padding: 0.5rem !important;\r\n}\r\n\r\n.back-btn:hover {\r\n  background: rgba(255, 255, 255, 0.3) !important;\r\n}\r\n\r\n.summary-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n  gap: 1rem;\r\n}\r\n\r\n/* Charts Container with Swipe */\r\n.charts-container {\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.charts-wrapper {\r\n  display: flex;\r\n  transition: transform 0.3s ease-out;\r\n  touch-action: pan-y;\r\n}\r\n\r\n.chart-card {\r\n  flex: 0 0 100%;\r\n  min-width: 100%;\r\n  border: 1px solid #e9ecef;\r\n  min-height: 350px;\r\n  opacity: 0.5;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.chart-card.active {\r\n  opacity: 1;\r\n}\r\n\r\n.chart-card h3 {\r\n  margin: 0 0 1rem 0;\r\n  font-size: 1.1rem;\r\n  color: #2c3e50;\r\n}\r\n\r\ncanvas {\r\n  max-height: 300px;\r\n}\r\n\r\n.chart-dots {\r\n  display: none;\r\n  justify-content: center;\r\n  gap: 0.5rem;\r\n  margin-top: 1rem;\r\n}\r\n\r\n.chart-dots span {\r\n  width: 8px;\r\n  height: 8px;\r\n  border-radius: 50%;\r\n  background: #d1d5db;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.chart-dots span.active {\r\n  background: #4A90E2;\r\n  width: 24px;\r\n  border-radius: 4px;\r\n}\r\n\r\n/* Desktop: Show grid */\r\n@media (min-width: 769px) {\r\n  .charts-wrapper {\r\n    display: grid;\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 1rem;\r\n  }\r\n  \r\n  .chart-card {\r\n    flex: none;\r\n    min-width: auto;\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Mobile: Show swipe */\r\n@media (max-width: 768px) {\r\n  .dashboard-container {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-card {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-content {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 1.8rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  .chart-dots {\r\n    display: flex;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  /* Hide table columns on mobile */\r\n  :deep(.p-datatable-wrapper) {\r\n    overflow-x: auto;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .summary-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .header-content {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .back-btn {\r\n    padding: 0.4rem !important;\r\n  }\r\n}\r\n\r\n.task-breakdown {\r\n  padding: 1rem;\r\n  background: #f8f9fa;\r\n  border-radius: 8px;\r\n}\r\n\r\n.task-breakdown h4 {\r\n  margin: 0 0 1rem 0;\r\n  color: #2c3e50;\r\n  font-size: 1rem;\r\n}\r\n\r\n.skeleton {\r\n  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\r\n  background-size: 200% 100%;\r\n  animation: loading 1.5s infinite;\r\n  border-radius: 4px;\r\n}\r\n\r\n.skeleton-icon {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n}\r\n\r\n.skeleton-text {\r\n  border-radius: 4px;\r\n}\r\n\r\n@keyframes loading {\r\n  0% {\r\n    background-position: 200% 0;\r\n  }\r\n  100% {\r\n    background-position: -200% 0;\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .dashboard-container {\r\n    padding: 0.75rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 0.75rem;\r\n  }\r\n  \r\n  .summary-card:hover {\r\n    transform: none;\r\n  }\r\n  \r\n  .summary-content {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 2rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.8rem;\r\n  }\r\n  \r\n  .chart-dots {\r\n    display: flex;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.25rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.25rem;\r\n  }\r\n  \r\n  :deep(.p-datatable-wrapper) {\r\n    overflow-x: auto;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.9rem;\r\n  }\r\n  \r\n  :deep(.p-datatable .p-column-title) {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .dashboard-container {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: 1fr;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-content {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .header-left {\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-title {\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.1rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.1rem;\r\n  }\r\n  \r\n  .back-btn {\r\n    padding: 0.4rem !important;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 1.8rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.3rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  .chart-card {\r\n    min-height: 300px;\r\n  }\r\n  \r\n  canvas {\r\n    max-height: 250px;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.8rem;\r\n  }\r\n  \r\n  :deep(.p-datatable .p-column-title) {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  :deep(.p-paginator) {\r\n    font-size: 0.8rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 360px) {\r\n  .summary-info h3 {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.7rem;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1rem;\r\n  }\r\n}\r\n</style>\r\n","<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div class=\"dashboard-container\">\r\n    <Toast />\r\n    \r\n    <!-- Header -->\r\n    <Card class=\"header-card mb-4\">\r\n      <template #content>\r\n        <div class=\"header-content\">\r\n          <div class=\"header-left\">\r\n            <Button icon=\"pi pi-arrow-left\" @click=\"$router.go(-1)\" text class=\"back-btn\" />\r\n            <div class=\"header-title\">\r\n              <i class=\"pi pi-chart-bar header-icon\"></i>\r\n              <h1>Dashboard</h1>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </Card>\r\n\r\n    <!-- Summary Cards -->\r\n    <div class=\"summary-grid mb-4\">\r\n      <!-- Loading Skeleton -->\r\n      <template v-if=\"loading\">\r\n        <Card v-for=\"i in 8\" :key=\"i\" class=\"summary-card\">\r\n          <template #content>\r\n            <div class=\"summary-content\">\r\n              <div class=\"skeleton skeleton-icon\"></div>\r\n              <div class=\"summary-info\">\r\n                <div class=\"skeleton skeleton-text\" style=\"width: 60px; height: 32px;\"></div>\r\n                <div class=\"skeleton skeleton-text\" style=\"width: 120px; height: 16px; margin-top: 8px;\"></div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </Card>\r\n      </template>\r\n      \r\n      <!-- Actual Data -->\r\n      <template v-else>\r\n        <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-users summary-icon\" style=\"color: #4A90E2\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.totalUsers }}</h3>\r\n              <p>ผู้ใช้งานทั้งหมด</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-user-plus summary-icon\" style=\"color: #10b981\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.workingToday }}</h3>\r\n              <p>พนักงานทำงานวันนี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-calendar-times summary-icon\" style=\"color: #f59e0b\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.todayLeaves }}</h3>\r\n              <p>ลางานวันนี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-car summary-icon\" style=\"color: #06b6d4\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.activeCars }}</h3>\r\n              <p>รถกำลังใช้งาน</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-clock summary-icon\" style=\"color: #3b82f6\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.dueSoon }}</h3>\r\n              <p>งานครบกำหนดสัปดาห์นี้</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-exclamation-triangle summary-icon\" style=\"color: #ef4444\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.overdue }}</h3>\r\n              <p>งานเลยกำหนด</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-briefcase summary-icon\" style=\"color: #8b5cf6\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.activeTasks }}</h3>\r\n              <p>งานกำลังดำเนินการ</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n\r\n      <Card class=\"summary-card\">\r\n        <template #content>\r\n          <div class=\"summary-content\">\r\n            <i class=\"pi pi-check-circle summary-icon\" style=\"color: #22c55e\"></i>\r\n            <div class=\"summary-info\">\r\n              <h3>{{ stats.completedTasks }}</h3>\r\n              <p>งานเสร็จสิ้น</p>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </Card>\r\n      </template>\r\n    </div>\r\n\r\n    <!-- Charts with Swipe Support -->\r\n    <div class=\"charts-container mb-4\">\r\n      <div class=\"charts-wrapper\" \r\n           ref=\"chartsWrapper\"\r\n           @touchstart=\"handleTouchStart\"\r\n           @touchmove=\"handleTouchMove\"\r\n           @touchend=\"handleTouchEnd\">\r\n        <Card class=\"chart-card\" :class=\"{ active: currentChart === 0 }\">\r\n          <template #content>\r\n            <h3>จำนวนวันลาของพนักงาน (รายปี)</h3>\r\n            <canvas ref=\"leaveChart\"></canvas>\r\n          </template>\r\n        </Card>\r\n\r\n        <Card class=\"chart-card\" :class=\"{ active: currentChart === 1 }\">\r\n          <template #content>\r\n            <h3>สถานะงาน</h3>\r\n            <canvas ref=\"taskChart\"></canvas>\r\n          </template>\r\n        </Card>\r\n      </div>\r\n      \r\n      <!-- Chart Navigation Dots (Mobile) -->\r\n      <div class=\"chart-dots\">\r\n        <span v-for=\"i in 2\" :key=\"i\" \r\n              :class=\"{ active: currentChart === i - 1 }\"\r\n              @click=\"currentChart = i - 1\"></span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Work Statistics -->\r\n    <Card>\r\n      <template #content>\r\n        <h3 class=\"mb-3\">สถิติเวลาทำงานของพนักงาน (รายปี)</h3>\r\n        <DataTable :value=\"workStatistics\" :loading=\"loading\" paginator :rows=\"10\" sortField=\"totalHours\" :sortOrder=\"-1\"\r\n                   :expandedRows=\"expandedRows\">\r\n          <Column :expander=\"true\" style=\"width: 3rem\" />\r\n          <Column field=\"userName\" header=\"ชื่อพนักงาน\" sortable style=\"min-width: 150px\">\r\n            <template #body=\"{ data }\">\r\n              <span class=\"clickable-name\" @click=\"selectedUserId = data.userId; showUserDialog = true\">\r\n                {{ data.userName }}\r\n              </span>\r\n            </template>\r\n          </Column>\r\n          <Column field=\"department\" header=\"แผนก\" sortable style=\"min-width: 120px\" />\r\n          <Column field=\"totalHours\" header=\"รวมชั่วโมง\" sortable style=\"min-width: 120px\">\r\n            <template #body=\"{ data }\">\r\n              <span style=\"font-weight: 600; color: #4A90E2\">{{ data.totalHours.toFixed(1) }} ชม.</span>\r\n            </template>\r\n          </Column>\r\n          <Column field=\"taskCount\" header=\"จำนวนงาน\" sortable style=\"min-width: 100px\" />\r\n          <Column field=\"avgHoursPerTask\" header=\"เฉลี่ย/งาน\" sortable style=\"min-width: 100px\">\r\n            <template #body=\"{ data }\">\r\n              {{ data.avgHoursPerTask.toFixed(1) }} ชม.\r\n            </template>\r\n          </Column>\r\n          \r\n          <template #expansion=\"{ data }\">\r\n            <div class=\"task-breakdown\">\r\n              <h4>รายละเอียดงานทั้งหมด</h4>\r\n              <DataTable :value=\"data.taskDetails\" class=\"p-datatable-sm\">\r\n                <Column field=\"taskName\" header=\"ชื่องาน\" style=\"min-width: 200px\" />\r\n                <Column field=\"hours\" header=\"ชั่วโมง\" sortable>\r\n                  <template #body=\"{ data: task }\">\r\n                    <span style=\"font-weight: 600; color: #10b981\">{{ task.hours.toFixed(1) }} ชม.</span>\r\n                  </template>\r\n                </Column>\r\n                <Column field=\"percentage\" header=\"สัดส่วน\" sortable>\r\n                  <template #body=\"{ data: task }\">\r\n                    <div style=\"display: flex; align-items: center; gap: 0.5rem\">\r\n                      <div style=\"flex: 1; background: #e9ecef; border-radius: 4px; height: 20px; overflow: hidden\">\r\n                        <div :style=\"{ width: task.percentage + '%', background: '#4A90E2', height: '100%' }\"></div>\r\n                      </div>\r\n                      <span style=\"min-width: 50px; text-align: right\">{{ task.percentage.toFixed(1) }}%</span>\r\n                    </div>\r\n                  </template>\r\n                </Column>\r\n              </DataTable>\r\n            </div>\r\n          </template>\r\n        </DataTable>\r\n      </template>\r\n    </Card>\r\n  </div>\r\n\r\n  <UserInfoDialog v-if=\"showUserDialog\" :visible=\"true\" @update:visible=\"showUserDialog = false\" :userId=\"selectedUserId\" />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, nextTick, watch } from 'vue'\r\nimport { useErrorHandler } from '@/composables/useErrorHandler'\r\nimport { Chart } from 'chart.js/auto'\r\nimport axios from 'axios'\r\nimport userService from '@/services/userService'\r\nimport dailyWorkService from '@/services/dailyWorkService'\r\nimport UserInfoDialog from '@/components/UserInfoDialog.vue'\r\nimport { isCompleted, isActive } from '@/utils/statusHelper'\r\n\r\nconst { handleError } = useErrorHandler()\r\nconst loading = ref(false)\r\nconst leaveTypeColors = ref({})\r\nconst showUserDialog = ref(false)\r\nconst selectedUserId = ref(null)\r\n\r\n// Swipe functionality\r\nconst currentChart = ref(0)\r\nconst chartsWrapper = ref(null)\r\nlet touchStartX = 0\r\nlet touchEndX = 0\r\n\r\n\r\nconst stats = ref({\r\n  totalUsers: 0,\r\n  workingToday: 0,\r\n  todayLeaves: 0,\r\n  activeCars: 0,\r\n  activeTasks: 0,\r\n  completedTasks: 0,\r\n  dueSoon: 0,\r\n  overdue: 0\r\n})\r\n\r\nconst workStatistics = ref([])\r\nconst expandedRows = ref([])\r\nconst leaveChart = ref(null)\r\nconst taskChart = ref(null)\r\nlet leaveChartInstance = null\r\nlet taskChartInstance = null\r\n\r\nonMounted(() => {\r\n  loadLeaveTypeColors()\r\n  loadData()\r\n})\r\n\r\n// Swipe handlers\r\nconst handleTouchStart = (e) => {\r\n  touchStartX = e.touches[0].clientX\r\n}\r\n\r\nconst handleTouchMove = (e) => {\r\n  touchEndX = e.touches[0].clientX\r\n}\r\n\r\nconst handleTouchEnd = () => {\r\n  const diff = touchStartX - touchEndX\r\n  const threshold = 50\r\n  \r\n  if (Math.abs(diff) > threshold) {\r\n    if (diff > 0 && currentChart.value < 1) {\r\n      currentChart.value++\r\n    } else if (diff < 0 && currentChart.value > 0) {\r\n      currentChart.value--\r\n    }\r\n  }\r\n}\r\n\r\n// Watch chart changes for smooth transition\r\nwatch(currentChart, (newVal) => {\r\n  if (chartsWrapper.value) {\r\n    chartsWrapper.value.style.transform = `translateX(-${newVal * 100}%)`\r\n  }\r\n})\r\n\r\nconst loadLeaveTypeColors = async () => {\r\n  try {\r\n    const response = await axios.get('/api/leave/leave-types')\r\n    const colorMap = {}\r\n    response.data.forEach(type => {\r\n      colorMap[type.value] = type.color\r\n    })\r\n    leaveTypeColors.value = colorMap\r\n  } catch (error) {\r\n    handleError(error, {\r\n      customMessage: 'ไม่สามารถโหลดสีประเภทการลาได้',\r\n      showToast: false // ไม่แสดง toast เพราะไม่สำคัญมาก\r\n    })\r\n  }\r\n}\r\n\r\nconst loadData = async () => {\r\n  loading.value = true\r\n  \r\n  try {\r\n    // ใช้ service layer พร้อม cache\r\n    const [activeUsers, leaves, cars, tasks, dailyWork] = await Promise.all([\r\n      userService.getActiveUsers(),  // มี cache 5 นาที + filter is_active\r\n      axios.get('/api/leave').then(r => r.data),\r\n      axios.get('/api/car-booking').then(r => r.data),\r\n      axios.get('/api/tasks').then(r => r.data),\r\n      dailyWorkService.getDailyWork()  // มี cache 2 นาที\r\n    ])\r\n\r\n    // Calculate stats\r\n    stats.value.totalUsers = activeUsers.length\r\n    \r\n    const today = new Date().toISOString().split('T')[0]\r\n    const todayDate = new Date(today + 'T00:00:00') // Local midnight\r\n    const weekFromNow = new Date(todayDate)\r\n    weekFromNow.setDate(weekFromNow.getDate() + 7)\r\n    \r\n    // Helper function to parse date as local\r\n    const parseLocalDate = (dateStr) => {\r\n      if (!dateStr) return null\r\n      const datePart = dateStr.split('T')[0]\r\n      return new Date(datePart + 'T00:00:00')\r\n    }\r\n    \r\n    // Get unique user IDs who have approved leave today\r\n    const todayLeavesUsers = leaves.filter(l => {\r\n      if (l.status !== 'approved') return false\r\n      if (!l.start_datetime || !l.end_datetime) return false\r\n      \r\n      // แปลง UTC เป็น local date\r\n      const startDate = new Date(l.start_datetime)\r\n      const endDate = new Date(l.end_datetime)\r\n      \r\n      // เปรียบเทียบแบบ local date (ไม่สนเวลา)\r\n      const startLocalDate = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate())\r\n      const endLocalDate = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate())\r\n      \r\n      return startLocalDate <= todayDate && endLocalDate >= todayDate\r\n    })\r\n    \r\n    // Count unique users (DISTINCT user_id)\r\n    const uniqueUserIds = [...new Set(todayLeavesUsers.map(l => l.user_id))]\r\n    stats.value.todayLeaves = uniqueUserIds.length\r\n    \r\n    // พนักงานที่ทำงานวันนี้ = คนที่ลงงานรายวันวันนี้\r\n    const todayWorkUsers = dailyWork.filter(w => {\r\n      const workDate = w.work_date?.split('T')[0]\r\n      return workDate === today\r\n    })\r\n    const uniqueWorkUserIds = [...new Set(todayWorkUsers.map(w => w.user_id))]\r\n    stats.value.workingToday = uniqueWorkUserIds.length\r\n    \r\n    stats.value.activeCars = cars.filter(c => c.status === 'active').length\r\n    stats.value.activeTasks = tasks.filter(t => isActive(t.status)).length\r\n    stats.value.completedTasks = tasks.filter(t => isCompleted(t.status)).length\r\n    \r\n    // งานที่ครบกำหนดสัปดาห์นี้\r\n    stats.value.dueSoon = tasks.filter(t => {\r\n      if (!t.project_end_date) return false\r\n      const endDate = parseLocalDate(t.project_end_date)\r\n      return endDate >= todayDate && endDate <= weekFromNow && isActive(t.status)\r\n    }).length\r\n    \r\n    // งานที่เลยกำหนด\r\n    stats.value.overdue = tasks.filter(t => {\r\n      if (!t.project_end_date) return false\r\n      const endDate = parseLocalDate(t.project_end_date)\r\n      return endDate < todayDate && isActive(t.status)\r\n    }).length\r\n\r\n    // Work Statistics - คำนวณเวลาทำงานของแต่ละคน (รายปี)\r\n    const currentYear = new Date().getFullYear()\r\n    const userWorkData = {}\r\n    \r\n    dailyWork.forEach(w => {\r\n      const workYear = new Date(w.work_date).getFullYear()\r\n      if (workYear !== currentYear) return\r\n      \r\n      const userId = w.user_id\r\n      if (!userId) return // ข้ามถ้าไม่มี userId\r\n      \r\n      if (!userWorkData[userId]) {\r\n        const user = activeUsers.find(u => u.id === userId)\r\n        if (!user) return // ข้ามถ้าไม่เจอ user ใน activeUsers\r\n        \r\n        userWorkData[userId] = {\r\n          userId: userId,\r\n          userName: `${user.firstname} ${user.lastname}`,\r\n          department: user.department || 'N/A',\r\n          totalHours: 0,\r\n          taskCount: 0,\r\n          taskHours: {} // เก็บชั่วโมงของแต่ละงาน\r\n        }\r\n      }\r\n      \r\n      // คำนวณชั่วโมงจาก start_time และ end_time\r\n      if (w.start_time && w.end_time) {\r\n        const [startH, startM] = w.start_time.split(':').map(Number)\r\n        const [endH, endM] = w.end_time.split(':').map(Number)\r\n        const hours = (endH + endM/60) - (startH + startM/60)\r\n        \r\n        if (hours > 0) {\r\n          userWorkData[userId].totalHours += hours\r\n          \r\n          // เก็บชั่วโมงของแต่ละงาน\r\n          const taskName = w.task_name || w.project_name || 'ไม่ระบุ'\r\n          if (!userWorkData[userId].taskHours[taskName]) {\r\n            userWorkData[userId].taskHours[taskName] = 0\r\n          }\r\n          userWorkData[userId].taskHours[taskName] += hours\r\n        }\r\n      }\r\n      \r\n      userWorkData[userId].taskCount += 1\r\n    })\r\n    \r\n    workStatistics.value = Object.values(userWorkData).map(data => {\r\n      // สร้างรายละเอียดงานทั้งหมด\r\n      const taskDetails = Object.entries(data.taskHours)\r\n        .map(([taskName, hours]) => ({\r\n          taskName: taskName,\r\n          hours: hours,\r\n          percentage: (hours / data.totalHours) * 100\r\n        }))\r\n        .sort((a, b) => b.hours - a.hours)\r\n      \r\n      return {\r\n        userId: data.userId,\r\n        userName: data.userName,\r\n        department: data.department,\r\n        totalHours: data.totalHours,\r\n        taskCount: data.taskCount,\r\n        avgHoursPerTask: data.taskCount > 0 ? data.totalHours / data.taskCount : 0,\r\n        taskDetails: taskDetails\r\n      }\r\n    }).sort((a, b) => b.totalHours - a.totalHours)\r\n\r\n    await nextTick()\r\n    renderCharts(leaves, tasks)\r\n  } catch (error) {\r\n    handleError(error, {\r\n      customMessage: 'ไม่สามารถโหลดข้อมูล Dashboard ได้ กรุณาลองใหม่อีกครั้ง'\r\n    })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst renderCharts = (leaves, tasks) => {\r\n  // Leave Chart - แสดงจำนวนวันลาของแต่ละคนแยกตามประเภท (รายปี)\r\n  if (leaveChartInstance) leaveChartInstance.destroy()\r\n  \r\n  const currentYear = new Date().getFullYear()\r\n  const users = {}\r\n  const leaveTypes = new Set()\r\n  \r\n  // รวบรวมข้อมูล\r\n  leaves.forEach(l => {\r\n    if (l.status !== 'approved') return\r\n    const leaveYear = new Date(l.start_datetime).getFullYear()\r\n    if (leaveYear !== currentYear) return\r\n    \r\n    const userName = l.user_name || 'ไม่ระบุ'\r\n    const leaveType = l.leave_type || 'อื่นๆ'\r\n    const days = parseFloat(l.total_days) || 0\r\n    \r\n    if (!users[userName]) {\r\n      users[userName] = {}\r\n    }\r\n    if (!users[userName][leaveType]) {\r\n      users[userName][leaveType] = 0\r\n    }\r\n    users[userName][leaveType] += days\r\n    leaveTypes.add(leaveType)\r\n  })\r\n\r\n  // สร้าง datasets สำหรับแต่ละประเภทการลา\r\n  const datasets = Array.from(leaveTypes).map(type => ({\r\n    label: type,\r\n    data: Object.keys(users).map(userName => users[userName][type] || 0),\r\n    backgroundColor: leaveTypeColors.value[type] || '#' + Math.floor(Math.random()*16777215).toString(16)\r\n  }))\r\n\r\n  leaveChartInstance = new Chart(leaveChart.value, {\r\n    type: 'bar',\r\n    data: {\r\n      labels: Object.keys(users),\r\n      datasets: datasets\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      scales: {\r\n        x: {\r\n          stacked: false\r\n        },\r\n        y: {\r\n          beginAtZero: true,\r\n          title: {\r\n            display: true,\r\n            text: 'จำนวนวัน'\r\n          }\r\n        }\r\n      },\r\n      plugins: {\r\n        legend: {\r\n          display: true,\r\n          position: 'top'\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  // Task Chart\r\n  if (taskChartInstance) taskChartInstance.destroy()\r\n  \r\n  const taskStatus = {}\r\n  tasks.forEach(t => {\r\n    taskStatus[t.status || 'pending'] = (taskStatus[t.status || 'pending'] || 0) + 1\r\n  })\r\n\r\n  taskChartInstance = new Chart(taskChart.value, {\r\n    type: 'doughnut',\r\n    data: {\r\n      labels: Object.keys(taskStatus),\r\n      datasets: [{\r\n        data: Object.values(taskStatus),\r\n        backgroundColor: ['#f59e0b', '#4A90E2', '#10b981', '#ef4444']\r\n      }]\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.clickable-name {\r\n  cursor: pointer;\r\n  color: #667eea;\r\n  font-weight: 600;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.clickable-name:hover {\r\n  color: #764ba2;\r\n  text-decoration: underline;\r\n}\r\n\r\n.dashboard-container {\r\n  padding: 1rem;\r\n  max-width: 1400px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.header-card {\r\n  background: linear-gradient(135deg, #4A90E2, #D73527);\r\n  color: white;\r\n  border: none;\r\n}\r\n\r\n.header-content {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 1rem;\r\n}\r\n\r\n.header-left {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 1rem;\r\n}\r\n\r\n.header-title {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 0.75rem;\r\n}\r\n\r\n.header-icon {\r\n  font-size: 1.5rem;\r\n}\r\n\r\n.header-title h1 {\r\n  margin: 0;\r\n  font-size: 1.5rem;\r\n  font-weight: 600;\r\n}\r\n\r\n.back-btn {\r\n  color: white !important;\r\n  background: rgba(255, 255, 255, 0.2) !important;\r\n  border: 1px solid rgba(255, 255, 255, 0.3) !important;\r\n  border-radius: 8px !important;\r\n  padding: 0.5rem !important;\r\n}\r\n\r\n.back-btn:hover {\r\n  background: rgba(255, 255, 255, 0.3) !important;\r\n}\r\n\r\n.summary-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\r\n  gap: 1rem;\r\n}\r\n\r\n/* Charts Container with Swipe */\r\n.charts-container {\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.charts-wrapper {\r\n  display: flex;\r\n  transition: transform 0.3s ease-out;\r\n  touch-action: pan-y;\r\n}\r\n\r\n.chart-card {\r\n  flex: 0 0 100%;\r\n  min-width: 100%;\r\n  border: 1px solid #e9ecef;\r\n  min-height: 350px;\r\n  opacity: 0.5;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.chart-card.active {\r\n  opacity: 1;\r\n}\r\n\r\n.chart-card h3 {\r\n  margin: 0 0 1rem 0;\r\n  font-size: 1.1rem;\r\n  color: #2c3e50;\r\n}\r\n\r\ncanvas {\r\n  max-height: 300px;\r\n}\r\n\r\n.chart-dots {\r\n  display: none;\r\n  justify-content: center;\r\n  gap: 0.5rem;\r\n  margin-top: 1rem;\r\n}\r\n\r\n.chart-dots span {\r\n  width: 8px;\r\n  height: 8px;\r\n  border-radius: 50%;\r\n  background: #d1d5db;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.chart-dots span.active {\r\n  background: #4A90E2;\r\n  width: 24px;\r\n  border-radius: 4px;\r\n}\r\n\r\n/* Desktop: Show grid */\r\n@media (min-width: 769px) {\r\n  .charts-wrapper {\r\n    display: grid;\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 1rem;\r\n  }\r\n  \r\n  .chart-card {\r\n    flex: none;\r\n    min-width: auto;\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* Mobile: Show swipe */\r\n@media (max-width: 768px) {\r\n  .dashboard-container {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-card {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-content {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 1.8rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  .chart-dots {\r\n    display: flex;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  /* Hide table columns on mobile */\r\n  :deep(.p-datatable-wrapper) {\r\n    overflow-x: auto;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .summary-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .header-content {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .back-btn {\r\n    padding: 0.4rem !important;\r\n  }\r\n}\r\n\r\n.task-breakdown {\r\n  padding: 1rem;\r\n  background: #f8f9fa;\r\n  border-radius: 8px;\r\n}\r\n\r\n.task-breakdown h4 {\r\n  margin: 0 0 1rem 0;\r\n  color: #2c3e50;\r\n  font-size: 1rem;\r\n}\r\n\r\n.skeleton {\r\n  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\r\n  background-size: 200% 100%;\r\n  animation: loading 1.5s infinite;\r\n  border-radius: 4px;\r\n}\r\n\r\n.skeleton-icon {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n}\r\n\r\n.skeleton-text {\r\n  border-radius: 4px;\r\n}\r\n\r\n@keyframes loading {\r\n  0% {\r\n    background-position: 200% 0;\r\n  }\r\n  100% {\r\n    background-position: -200% 0;\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .dashboard-container {\r\n    padding: 0.75rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n    gap: 0.75rem;\r\n  }\r\n  \r\n  .summary-card:hover {\r\n    transform: none;\r\n  }\r\n  \r\n  .summary-content {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 2rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.8rem;\r\n  }\r\n  \r\n  .chart-dots {\r\n    display: flex;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.25rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.25rem;\r\n  }\r\n  \r\n  :deep(.p-datatable-wrapper) {\r\n    overflow-x: auto;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.9rem;\r\n  }\r\n  \r\n  :deep(.p-datatable .p-column-title) {\r\n    font-size: 0.85rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .dashboard-container {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .summary-grid {\r\n    grid-template-columns: 1fr;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-content {\r\n    padding: 0.5rem;\r\n  }\r\n  \r\n  .header-left {\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-title {\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1.1rem;\r\n  }\r\n  \r\n  .header-icon {\r\n    font-size: 1.1rem;\r\n  }\r\n  \r\n  .back-btn {\r\n    padding: 0.4rem !important;\r\n  }\r\n  \r\n  .summary-icon {\r\n    font-size: 1.8rem;\r\n  }\r\n  \r\n  .summary-info h3 {\r\n    font-size: 1.3rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  .chart-card {\r\n    min-height: 300px;\r\n  }\r\n  \r\n  canvas {\r\n    max-height: 250px;\r\n  }\r\n  \r\n  :deep(.p-datatable) {\r\n    font-size: 0.8rem;\r\n  }\r\n  \r\n  :deep(.p-datatable .p-column-title) {\r\n    font-size: 0.75rem;\r\n  }\r\n  \r\n  :deep(.p-paginator) {\r\n    font-size: 0.8rem;\r\n  }\r\n}\r\n\r\n@media (max-width: 360px) {\r\n  .summary-info h3 {\r\n    font-size: 1.2rem;\r\n  }\r\n  \r\n  .summary-info p {\r\n    font-size: 0.7rem;\r\n  }\r\n  \r\n  .header-title h1 {\r\n    font-size: 1rem;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}