{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, onMounted } from 'vue';\nimport { useToast } from 'primevue/usetoast';\nimport axios from 'axios';\nexport default {\n  __name: 'LeaveManagement',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const toast = useToast();\n    const users = ref([]);\n    const showAddLeaveTypeDialog = ref(false);\n    const adding = ref(false);\n    const newLeaveType = ref({\n      label: '',\n      value: '',\n      quota: 0\n    });\n    onMounted(() => {\n      loadUsers();\n    });\n    const loadUsers = async () => {\n      try {\n        const token = localStorage.getItem('soc_token');\n        const usersRes = await axios.get('/api/users', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        users.value = await Promise.all(usersRes.data.map(async user => {\n          try {\n            const quotaRes = await axios.get(`/api/leave/quota/${user.id}`);\n            const quotaData = quotaRes.data;\n            return {\n              ...user,\n              sick_quota: quotaData.sick?.quota || 0,\n              sick_used: quotaData.sick?.usedDays || 0,\n              sick_remaining: quotaData.sick?.remainingDays || 0,\n              personal_quota: quotaData.personal?.quota || 0,\n              personal_used: quotaData.personal?.usedDays || 0,\n              personal_remaining: quotaData.personal?.remainingDays || 0,\n              vacation_quota: quotaData.vacation?.quota || 0,\n              vacation_used: quotaData.vacation?.usedDays || 0,\n              vacation_remaining: quotaData.vacation?.remainingDays || 0\n            };\n          } catch (error) {\n            console.error(`Error loading quota for user ${user.id}:`, error);\n            return {\n              ...user,\n              sick_quota: 0,\n              sick_used: 0,\n              sick_remaining: 0,\n              personal_quota: 0,\n              personal_used: 0,\n              personal_remaining: 0,\n              vacation_quota: 0,\n              vacation_used: 0,\n              vacation_remaining: 0\n            };\n          }\n        }));\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: 'ไม่สามารถโหลดข้อมูลได้',\n          life: 3000\n        });\n      }\n    };\n    const closeAddDialog = () => {\n      showAddLeaveTypeDialog.value = false;\n      newLeaveType.value = {\n        label: '',\n        value: '',\n        quota: 0\n      };\n    };\n    const addLeaveType = async () => {\n      if (!newLeaveType.value.label || !newLeaveType.value.value || newLeaveType.value.quota < 0) {\n        toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'กรุณากรอกข้อมูลให้ครบถ้วน',\n          life: 3000\n        });\n        return;\n      }\n\n      // Validate value format (lowercase letters and underscore only)\n      if (!/^[a-z_]+$/.test(newLeaveType.value.value)) {\n        toast.add({\n          severity: 'error',\n          summary: 'ข้อผิดพลาด',\n          detail: 'รหัสประเภทต้องเป็นตัวอักษรภาษาอังกฤษพิมพ์เล็กและขีดล่าง (_) เท่านั้น',\n          life: 3000\n        });\n        return;\n      }\n      adding.value = true;\n      try {\n        await axios.post('/api/leave/leave-types', {\n          label: newLeaveType.value.label,\n          value: newLeaveType.value.value,\n          default_quota: newLeaveType.value.quota\n        });\n        toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'เพิ่มประเภทการลาใหม่เรียบร้อยแล้ว',\n          life: 3000\n        });\n        closeAddDialog();\n        loadUsers();\n      } catch (error) {\n        console.error('Add leave type error:', error);\n        toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: error.response?.data?.error || 'ไม่สามารถเพิ่มประเภทการลาได้',\n          life: 3000\n        });\n      } finally {\n        adding.value = false;\n      }\n    };\n    const __returned__ = {\n      toast,\n      users,\n      showAddLeaveTypeDialog,\n      adding,\n      newLeaveType,\n      loadUsers,\n      closeAddDialog,\n      addLeaveType,\n      ref,\n      onMounted,\n      get useToast() {\n        return useToast;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useToast","axios","toast","users","showAddLeaveTypeDialog","adding","newLeaveType","label","value","quota","loadUsers","token","localStorage","getItem","usersRes","get","headers","Authorization","Promise","all","data","map","user","quotaRes","id","quotaData","sick_quota","sick","sick_used","usedDays","sick_remaining","remainingDays","personal_quota","personal","personal_used","personal_remaining","vacation_quota","vacation","vacation_used","vacation_remaining","error","console","add","severity","summary","detail","life","closeAddDialog","addLeaveType","test","post","default_quota","response"],"sources":["D:/FULLACC/frontend_cem-main/src/views/management/LeaveManagement.vue"],"sourcesContent":["<template>\n  <div class=\"leave-management-container\">\n    <Toast />\n    \n    <!-- Header -->\n    <Card class=\"header-card mb-4\">\n      <template #content>\n        <div class=\"header-content\">\n          <Button icon=\"pi pi-arrow-left\" text rounded @click=\"$router.push('/management')\" class=\"back-btn\" />\n          <div class=\"header-title\">\n            <i class=\"pi pi-calendar-times\"></i>\n            <h1>จัดการการลางาน</h1>\n          </div>\n        </div>\n      </template>\n    </Card>\n\n    <!-- User Leave Quota Table -->\n    <Card>\n      <template #content>\n        <div class=\"table-header\">\n          <h3>โควต้าการลาของพนักงาน</h3>\n          <Button label=\"เพิ่มประเภทการลา\" icon=\"pi pi-plus\" @click=\"showAddLeaveTypeDialog = true\" />\n        </div>\n        <DataTable :value=\"users\" :paginator=\"true\" :rows=\"10\" stripedRows class=\"p-datatable-sm\">\n          <Column field=\"firstname\" header=\"ชื่อ\" :sortable=\"true\">\n            <template #body=\"{ data }\">\n              {{ data.firstname }} {{ data.lastname }}\n            </template>\n          </Column>\n          <Column field=\"department\" header=\"แผนก\" :sortable=\"true\" />\n          <Column field=\"position\" header=\"ตำแหน่ง\" :sortable=\"true\" />\n          <Column header=\"ลาป่วย\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>โควต้า: {{ data.sick_quota || 0 }} วัน</small>\n                <small>คงเหลือ: {{ data.sick_remaining || 0 }} วัน</small>\n              </div>\n            </template>\n          </Column>\n          <Column header=\"ลากิจ\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>โควต้า: {{ data.personal_quota || 0 }} วัน</small>\n                <small>คงเหลือ: {{ data.personal_remaining || 0 }} วัน</small>\n              </div>\n            </template>\n          </Column>\n          <Column header=\"ลาพักร้อน\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>โควต้า: {{ data.vacation_quota || 0 }} วัน</small>\n                <small>คงเหลือ: {{ data.vacation_remaining || 0 }} วัน</small>\n              </div>\n            </template>\n          </Column>\n        </DataTable>\n      </template>\n    </Card>\n\n    <!-- Add Leave Type Dialog -->\n    <Dialog v-model:visible=\"showAddLeaveTypeDialog\" header=\"เพิ่มประเภทการลาใหม่\" :modal=\"true\" :draggable=\"false\" style=\"width: 500px\">\n      <div class=\"leave-type-form\">\n        <div class=\"field\">\n          <label>ชื่อประเภทการลา (ภาษาไทย) *</label>\n          <InputText v-model=\"newLeaveType.label\" placeholder=\"เช่น ลาบวช\" class=\"w-full\" />\n        </div>\n        <div class=\"field\">\n          <label>รหัสประเภท (ภาษาอังกฤษ) *</label>\n          <InputText v-model=\"newLeaveType.value\" placeholder=\"เช่น ordination\" class=\"w-full\" />\n          <small>ใช้ตัวอักษรภาษาอังกฤษพิมพ์เล็กและขีดล่าง (_) เท่านั้น</small>\n        </div>\n        <div class=\"field\">\n          <label>โควต้าเริ่มต้น (วัน/ปี) *</label>\n          <InputNumber v-model=\"newLeaveType.quota\" :min=\"0\" :max=\"365\" showButtons class=\"w-full\" />\n        </div>\n      </div>\n      <template #footer>\n        <Button label=\"ยกเลิก\" icon=\"pi pi-times\" @click=\"closeAddDialog\" severity=\"secondary\" />\n        <Button label=\"เพิ่ม\" icon=\"pi pi-check\" @click=\"addLeaveType\" :loading=\"adding\" />\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useToast } from 'primevue/usetoast'\nimport axios from 'axios'\n\nconst toast = useToast()\nconst users = ref([])\nconst showAddLeaveTypeDialog = ref(false)\nconst adding = ref(false)\nconst newLeaveType = ref({\n  label: '',\n  value: '',\n  quota: 0\n})\n\nonMounted(() => {\n  loadUsers()\n})\n\nconst loadUsers = async () => {\n  try {\n    const token = localStorage.getItem('soc_token')\n    const usersRes = await axios.get('/api/users', {\n      headers: { Authorization: `Bearer ${token}` }\n    })\n    \n    users.value = await Promise.all(usersRes.data.map(async (user) => {\n      try {\n        const quotaRes = await axios.get(`/api/leave/quota/${user.id}`)\n        const quotaData = quotaRes.data\n        \n        return {\n          ...user,\n          sick_quota: quotaData.sick?.quota || 0,\n          sick_used: quotaData.sick?.usedDays || 0,\n          sick_remaining: quotaData.sick?.remainingDays || 0,\n          personal_quota: quotaData.personal?.quota || 0,\n          personal_used: quotaData.personal?.usedDays || 0,\n          personal_remaining: quotaData.personal?.remainingDays || 0,\n          vacation_quota: quotaData.vacation?.quota || 0,\n          vacation_used: quotaData.vacation?.usedDays || 0,\n          vacation_remaining: quotaData.vacation?.remainingDays || 0\n        }\n      } catch (error) {\n        console.error(`Error loading quota for user ${user.id}:`, error)\n        return {\n          ...user,\n          sick_quota: 0,\n          sick_used: 0,\n          sick_remaining: 0,\n          personal_quota: 0,\n          personal_used: 0,\n          personal_remaining: 0,\n          vacation_quota: 0,\n          vacation_used: 0,\n          vacation_remaining: 0\n        }\n      }\n    }))\n  } catch (error) {\n    toast.add({\n      severity: 'error',\n      summary: 'เกิดข้อผิดพลาด',\n      detail: 'ไม่สามารถโหลดข้อมูลได้',\n      life: 3000\n    })\n  }\n}\n\nconst closeAddDialog = () => {\n  showAddLeaveTypeDialog.value = false\n  newLeaveType.value = {\n    label: '',\n    value: '',\n    quota: 0\n  }\n}\n\nconst addLeaveType = async () => {\n  if (!newLeaveType.value.label || !newLeaveType.value.value || newLeaveType.value.quota < 0) {\n    toast.add({\n      severity: 'error',\n      summary: 'ข้อผิดพลาด',\n      detail: 'กรุณากรอกข้อมูลให้ครบถ้วน',\n      life: 3000\n    })\n    return\n  }\n\n  // Validate value format (lowercase letters and underscore only)\n  if (!/^[a-z_]+$/.test(newLeaveType.value.value)) {\n    toast.add({\n      severity: 'error',\n      summary: 'ข้อผิดพลาด',\n      detail: 'รหัสประเภทต้องเป็นตัวอักษรภาษาอังกฤษพิมพ์เล็กและขีดล่าง (_) เท่านั้น',\n      life: 3000\n    })\n    return\n  }\n\n  adding.value = true\n  try {\n    await axios.post('/api/leave/leave-types', {\n      label: newLeaveType.value.label,\n      value: newLeaveType.value.value,\n      default_quota: newLeaveType.value.quota\n    })\n\n    toast.add({\n      severity: 'success',\n      summary: 'สำเร็จ',\n      detail: 'เพิ่มประเภทการลาใหม่เรียบร้อยแล้ว',\n      life: 3000\n    })\n\n    closeAddDialog()\n    loadUsers()\n  } catch (error) {\n    console.error('Add leave type error:', error)\n    toast.add({\n      severity: 'error',\n      summary: 'เกิดข้อผิดพลาด',\n      detail: error.response?.data?.error || 'ไม่สามารถเพิ่มประเภทการลาได้',\n      life: 3000\n    })\n  } finally {\n    adding.value = false\n  }\n}\n</script>\n\n<style scoped>\n.leave-management-container {\n  padding: 1rem;\n  max-width: 1400px;\n  margin: 0 auto;\n}\n\n.header-card {\n  background: linear-gradient(135deg, #4A90E2, #D73527);\n  color: white;\n  border: none;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.header-content {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n\n.back-btn {\n  color: white !important;\n}\n\n.header-title {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.header-title i {\n  font-size: 1.5rem;\n}\n\n.header-title h1 {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 600;\n}\n\n.table-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.table-header h3 {\n  margin: 0;\n  color: #2c3e50;\n}\n\n.table-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.table-header h3 {\n  margin: 0;\n  color: #2c3e50;\n}\n\n.leave-type-form {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  padding: 1rem 0;\n}\n\n.leave-type-form .field {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.leave-type-form label {\n  font-weight: 600;\n  color: #2c3e50;\n}\n\n.leave-type-form small {\n  color: #6c757d;\n  font-size: 0.8rem;\n}\n\n.quota-cell {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.quota-cell small {\n  font-size: 0.85rem;\n  color: #6c757d;\n}\n\n@media (max-width: 768px) {\n  .leave-management-container {\n    padding: 0.5rem;\n  }\n\n  .table-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 1rem;\n  }\n\n  .table-header button {\n    width: 100%;\n  }\n}\n</style>\n"],"mappings":";;AAsFA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAI;AACnC,SAASC,QAAQ,QAAQ,mBAAkB;AAC3C,OAAOC,KAAK,MAAM,OAAM;;;;;;;IAExB,MAAMC,KAAK,GAAGF,QAAQ,CAAC;IACvB,MAAMG,KAAK,GAAGL,GAAG,CAAC,EAAE;IACpB,MAAMM,sBAAsB,GAAGN,GAAG,CAAC,KAAK;IACxC,MAAMO,MAAM,GAAGP,GAAG,CAAC,KAAK;IACxB,MAAMQ,YAAY,GAAGR,GAAG,CAAC;MACvBS,KAAK,EAAE,EAAE;MACTC,KAAK,EAAE,EAAE;MACTC,KAAK,EAAE;IACT,CAAC;IAEDV,SAAS,CAAC,MAAM;MACdW,SAAS,CAAC;IACZ,CAAC;IAED,MAAMA,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAI;QACF,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW;QAC9C,MAAMC,QAAQ,GAAG,MAAMb,KAAK,CAACc,GAAG,CAAC,YAAY,EAAE;UAC7CC,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUN,KAAK;UAAG;QAC9C,CAAC;QAEDR,KAAK,CAACK,KAAK,GAAG,MAAMU,OAAO,CAACC,GAAG,CAACL,QAAQ,CAACM,IAAI,CAACC,GAAG,CAAC,MAAOC,IAAI,IAAK;UAChE,IAAI;YACF,MAAMC,QAAQ,GAAG,MAAMtB,KAAK,CAACc,GAAG,CAAC,oBAAoBO,IAAI,CAACE,EAAE,EAAE;YAC9D,MAAMC,SAAS,GAAGF,QAAQ,CAACH,IAAG;YAE9B,OAAO;cACL,GAAGE,IAAI;cACPI,UAAU,EAAED,SAAS,CAACE,IAAI,EAAElB,KAAK,IAAI,CAAC;cACtCmB,SAAS,EAAEH,SAAS,CAACE,IAAI,EAAEE,QAAQ,IAAI,CAAC;cACxCC,cAAc,EAAEL,SAAS,CAACE,IAAI,EAAEI,aAAa,IAAI,CAAC;cAClDC,cAAc,EAAEP,SAAS,CAACQ,QAAQ,EAAExB,KAAK,IAAI,CAAC;cAC9CyB,aAAa,EAAET,SAAS,CAACQ,QAAQ,EAAEJ,QAAQ,IAAI,CAAC;cAChDM,kBAAkB,EAAEV,SAAS,CAACQ,QAAQ,EAAEF,aAAa,IAAI,CAAC;cAC1DK,cAAc,EAAEX,SAAS,CAACY,QAAQ,EAAE5B,KAAK,IAAI,CAAC;cAC9C6B,aAAa,EAAEb,SAAS,CAACY,QAAQ,EAAER,QAAQ,IAAI,CAAC;cAChDU,kBAAkB,EAAEd,SAAS,CAACY,QAAQ,EAAEN,aAAa,IAAI;YAC3D;UACF,CAAC,CAAC,OAAOS,KAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAAC,gCAAgClB,IAAI,CAACE,EAAE,GAAG,EAAEgB,KAAK;YAC/D,OAAO;cACL,GAAGlB,IAAI;cACPI,UAAU,EAAE,CAAC;cACbE,SAAS,EAAE,CAAC;cACZE,cAAc,EAAE,CAAC;cACjBE,cAAc,EAAE,CAAC;cACjBE,aAAa,EAAE,CAAC;cAChBC,kBAAkB,EAAE,CAAC;cACrBC,cAAc,EAAE,CAAC;cACjBE,aAAa,EAAE,CAAC;cAChBC,kBAAkB,EAAE;YACtB;UACF;QACF,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdtC,KAAK,CAACwC,GAAG,CAAC;UACRC,QAAQ,EAAE,OAAO;UACjBC,OAAO,EAAE,gBAAgB;UACzBC,MAAM,EAAE,wBAAwB;UAChCC,IAAI,EAAE;QACR,CAAC;MACH;IACF;IAEA,MAAMC,cAAc,GAAGA,CAAA,KAAM;MAC3B3C,sBAAsB,CAACI,KAAK,GAAG,KAAI;MACnCF,YAAY,CAACE,KAAK,GAAG;QACnBD,KAAK,EAAE,EAAE;QACTC,KAAK,EAAE,EAAE;QACTC,KAAK,EAAE;MACT;IACF;IAEA,MAAMuC,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAAC1C,YAAY,CAACE,KAAK,CAACD,KAAK,IAAI,CAACD,YAAY,CAACE,KAAK,CAACA,KAAK,IAAIF,YAAY,CAACE,KAAK,CAACC,KAAK,GAAG,CAAC,EAAE;QAC1FP,KAAK,CAACwC,GAAG,CAAC;UACRC,QAAQ,EAAE,OAAO;UACjBC,OAAO,EAAE,YAAY;UACrBC,MAAM,EAAE,2BAA2B;UACnCC,IAAI,EAAE;QACR,CAAC;QACD;MACF;;MAEA;MACA,IAAI,CAAC,WAAW,CAACG,IAAI,CAAC3C,YAAY,CAACE,KAAK,CAACA,KAAK,CAAC,EAAE;QAC/CN,KAAK,CAACwC,GAAG,CAAC;UACRC,QAAQ,EAAE,OAAO;UACjBC,OAAO,EAAE,YAAY;UACrBC,MAAM,EAAE,sEAAsE;UAC9EC,IAAI,EAAE;QACR,CAAC;QACD;MACF;MAEAzC,MAAM,CAACG,KAAK,GAAG,IAAG;MAClB,IAAI;QACF,MAAMP,KAAK,CAACiD,IAAI,CAAC,wBAAwB,EAAE;UACzC3C,KAAK,EAAED,YAAY,CAACE,KAAK,CAACD,KAAK;UAC/BC,KAAK,EAAEF,YAAY,CAACE,KAAK,CAACA,KAAK;UAC/B2C,aAAa,EAAE7C,YAAY,CAACE,KAAK,CAACC;QACpC,CAAC;QAEDP,KAAK,CAACwC,GAAG,CAAC;UACRC,QAAQ,EAAE,SAAS;UACnBC,OAAO,EAAE,QAAQ;UACjBC,MAAM,EAAE,mCAAmC;UAC3CC,IAAI,EAAE;QACR,CAAC;QAEDC,cAAc,CAAC;QACfrC,SAAS,CAAC;MACZ,CAAC,CAAC,OAAO8B,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK;QAC5CtC,KAAK,CAACwC,GAAG,CAAC;UACRC,QAAQ,EAAE,OAAO;UACjBC,OAAO,EAAE,gBAAgB;UACzBC,MAAM,EAAEL,KAAK,CAACY,QAAQ,EAAEhC,IAAI,EAAEoB,KAAK,IAAI,8BAA8B;UACrEM,IAAI,EAAE;QACR,CAAC;MACH,CAAC,SAAS;QACRzC,MAAM,CAACG,KAAK,GAAG,KAAI;MACrB;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}