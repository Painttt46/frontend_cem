{"ast":null,"code":"import { ref, onMounted, computed } from 'vue';\nimport { useToast } from 'primevue/usetoast';\nimport axios from '@/utils/axiosConfig';\nexport default {\n  __name: 'LeaveApprovalSettings',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const toast = useToast();\n    const level1Approvers = ref([]);\n    const level2Approvers = ref([]);\n    const allUsers = ref([]);\n    const newApproverLevel1 = ref(null);\n    const newApproverLevel2 = ref(null);\n    const availableUsers = computed(() => {\n      return allUsers.value.map(u => ({\n        id: u.id,\n        name: `${u.firstname} ${u.lastname} (${u.position || 'ไม่ระบุตำแหน่ง'})`\n      }));\n    });\n    const loadSettings = async () => {\n      try {\n        const res = await axios.get('/api/settings/leave-approval');\n        level1Approvers.value = res.data.level1 || [];\n        level2Approvers.value = res.data.level2 || [];\n      } catch {// ignore\n      }\n    };\n    const loadUsers = async () => {\n      try {\n        const res = await axios.get('/api/users');\n        allUsers.value = res.data.filter(u => u.is_active);\n      } catch {// ignore\n      }\n    };\n    const addApprover = async level => {\n      const userId = level === 1 ? newApproverLevel1.value : newApproverLevel2.value;\n      if (!userId) return;\n      try {\n        await axios.post('/api/settings/leave-approval', {\n          approval_level: level,\n          user_id: userId,\n          receive_email: true,\n          can_approve: true\n        });\n        toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'เพิ่มผู้อนุมัติแล้ว',\n          life: 3000\n        });\n        if (level === 1) newApproverLevel1.value = null;else newApproverLevel2.value = null;\n        await loadSettings();\n      } catch (err) {\n        toast.add({\n          severity: 'error',\n          summary: 'ผิดพลาด',\n          detail: err.response?.data?.error || 'ไม่สามารถเพิ่มได้',\n          life: 3000\n        });\n      }\n    };\n    const updateApprover = async (level, data) => {\n      try {\n        await axios.put(`/api/settings/leave-approval/${level}/${data.user_id}`, {\n          receive_email: data.receive_email,\n          can_approve: data.can_approve\n        });\n        toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'อัพเดทแล้ว',\n          life: 2000\n        });\n      } catch {\n        // ignore\n        toast.add({\n          severity: 'error',\n          summary: 'ผิดพลาด',\n          detail: 'ไม่สามารถอัพเดทได้',\n          life: 3000\n        });\n      }\n    };\n    const removeApprover = async (level, userId) => {\n      try {\n        await axios.delete(`/api/settings/leave-approval/${level}/${userId}`);\n        toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'ลบผู้อนุมัติแล้ว',\n          life: 3000\n        });\n        await loadSettings();\n      } catch {\n        // ignore\n        toast.add({\n          severity: 'error',\n          summary: 'ผิดพลาด',\n          detail: 'ไม่สามารถลบได้',\n          life: 3000\n        });\n      }\n    };\n    onMounted(() => {\n      loadSettings();\n      loadUsers();\n    });\n    const __returned__ = {\n      toast,\n      level1Approvers,\n      level2Approvers,\n      allUsers,\n      newApproverLevel1,\n      newApproverLevel2,\n      availableUsers,\n      loadSettings,\n      loadUsers,\n      addApprover,\n      updateApprover,\n      removeApprover,\n      ref,\n      onMounted,\n      computed,\n      get useToast() {\n        return useToast;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","useToast","axios","toast","level1Approvers","level2Approvers","allUsers","newApproverLevel1","newApproverLevel2","availableUsers","value","map","u","id","name","firstname","lastname","position","loadSettings","res","get","data","level1","level2","loadUsers","filter","is_active","addApprover","level","userId","post","approval_level","user_id","receive_email","can_approve","add","severity","summary","detail","life","err","response","error","updateApprover","put","removeApprover","delete"],"sources":["D:/frontend_cem/src/views/management/LeaveApprovalSettings.vue"],"sourcesContent":["<template>\n  <div class=\"settings-container\">\n    <Toast />\n    \n    <!-- Header -->\n    <Card class=\"header-card mb-4\">\n      <template #content>\n        <div class=\"header-content\">\n          <Button icon=\"pi pi-arrow-left\" text rounded @click=\"$router.push('/management/settings')\" class=\"back-btn\" />\n          <div class=\"header-title\">\n            <i class=\"pi pi-users\"></i>\n            <h1>ตั้งค่าผู้อนุมัติการลา</h1>\n          </div>\n        </div>\n      </template>\n    </Card>\n\n    <div class=\"approval-levels\">\n      <!-- Level 1: HR -->\n      <Card class=\"level-card\">\n        <template #header>\n          <div class=\"level-header level-1\">\n            <i class=\"pi pi-user-edit\"></i>\n            <span>ขั้นที่ 1: HR อนุมัติ</span>\n          </div>\n        </template>\n        <template #content>\n          <p class=\"level-desc\">เมื่อมีคำขอลาใหม่ ระบบจะส่ง Email แจ้งผู้ที่กำหนดไว้</p>\n          \n          <div class=\"add-approver\">\n            <Dropdown v-model=\"newApproverLevel1\" :options=\"availableUsers\" optionLabel=\"name\" optionValue=\"id\" \n              placeholder=\"เลือกผู้อนุมัติ\" class=\"w-full\" filter />\n            <Button icon=\"pi pi-plus\" label=\"เพิ่ม\" @click=\"addApprover(1)\" :disabled=\"!newApproverLevel1\" />\n          </div>\n\n          <DataTable :value=\"level1Approvers\" class=\"mt-3\" stripedRows>\n            <Column field=\"user_name\" header=\"ชื่อ-นามสกุล\" />\n            <Column field=\"position\" header=\"ตำแหน่ง\" />\n            <Column field=\"email\" header=\"Email\" />\n            <Column header=\"รับ Email\">\n              <template #body=\"{ data }\">\n                <InputSwitch v-model=\"data.receive_email\" @change=\"updateApprover(1, data)\" />\n              </template>\n            </Column>\n            <Column header=\"สิทธิ์อนุมัติ\">\n              <template #body=\"{ data }\">\n                <InputSwitch v-model=\"data.can_approve\" @change=\"updateApprover(1, data)\" />\n              </template>\n            </Column>\n            <Column header=\"\">\n              <template #body=\"{ data }\">\n                <Button icon=\"pi pi-trash\" severity=\"danger\" text @click=\"removeApprover(1, data.user_id)\" />\n              </template>\n            </Column>\n          </DataTable>\n        </template>\n      </Card>\n\n      <!-- Level 2: Manager -->\n      <Card class=\"level-card\">\n        <template #header>\n          <div class=\"level-header level-2\">\n            <i class=\"pi pi-verified\"></i>\n            <span>ขั้นที่ 2: หัวหน้างาน อนุมัติ</span>\n          </div>\n        </template>\n        <template #content>\n          <p class=\"level-desc\">หลังจาก หัวหน้างาน อนุมัติขั้นที่ 1 ระบบจะส่ง Email แจ้งผู้บริหารที่กำหนดไว้</p>\n          \n          <div class=\"add-approver\">\n            <Dropdown v-model=\"newApproverLevel2\" :options=\"availableUsers\" optionLabel=\"name\" optionValue=\"id\" \n              placeholder=\"เลือกผู้อนุมัติ\" class=\"w-full\" filter />\n            <Button icon=\"pi pi-plus\" label=\"เพิ่ม\" @click=\"addApprover(2)\" :disabled=\"!newApproverLevel2\" />\n          </div>\n\n          <DataTable :value=\"level2Approvers\" class=\"mt-3\" stripedRows>\n            <Column field=\"user_name\" header=\"ชื่อ-นามสกุล\" />\n            <Column field=\"position\" header=\"ตำแหน่ง\" />\n            <Column field=\"email\" header=\"Email\" />\n            <Column header=\"รับ Email\">\n              <template #body=\"{ data }\">\n                <InputSwitch v-model=\"data.receive_email\" @change=\"updateApprover(2, data)\" />\n              </template>\n            </Column>\n            <Column header=\"สิทธิ์อนุมัติ\">\n              <template #body=\"{ data }\">\n                <InputSwitch v-model=\"data.can_approve\" @change=\"updateApprover(2, data)\" />\n              </template>\n            </Column>\n            <Column header=\"\">\n              <template #body=\"{ data }\">\n                <Button icon=\"pi pi-trash\" severity=\"danger\" text @click=\"removeApprover(2, data.user_id)\" />\n              </template>\n            </Column>\n          </DataTable>\n        </template>\n      </Card>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue'\nimport { useToast } from 'primevue/usetoast'\nimport axios from '@/utils/axiosConfig'\n\nconst toast = useToast()\n\nconst level1Approvers = ref([])\nconst level2Approvers = ref([])\nconst allUsers = ref([])\nconst newApproverLevel1 = ref(null)\nconst newApproverLevel2 = ref(null)\n\nconst availableUsers = computed(() => {\n  return allUsers.value.map(u => ({\n    id: u.id,\n    name: `${u.firstname} ${u.lastname} (${u.position || 'ไม่ระบุตำแหน่ง'})`\n  }))\n})\n\nconst loadSettings = async () => {\n  try {\n    const res = await axios.get('/api/settings/leave-approval')\n    level1Approvers.value = res.data.level1 || []\n    level2Approvers.value = res.data.level2 || []\n  } catch { // ignore\n    \n  }\n}\n\nconst loadUsers = async () => {\n  try {\n    const res = await axios.get('/api/users')\n    allUsers.value = res.data.filter(u => u.is_active)\n  } catch { // ignore\n    \n  }\n}\n\nconst addApprover = async (level) => {\n  const userId = level === 1 ? newApproverLevel1.value : newApproverLevel2.value\n  if (!userId) return\n\n  try {\n    await axios.post('/api/settings/leave-approval', {\n      approval_level: level,\n      user_id: userId,\n      receive_email: true,\n      can_approve: true\n    })\n    \n    toast.add({ severity: 'success', summary: 'สำเร็จ', detail: 'เพิ่มผู้อนุมัติแล้ว', life: 3000 })\n    \n    if (level === 1) newApproverLevel1.value = null\n    else newApproverLevel2.value = null\n    \n    await loadSettings()\n  } catch (err) {\n    toast.add({ severity: 'error', summary: 'ผิดพลาด', detail: err.response?.data?.error || 'ไม่สามารถเพิ่มได้', life: 3000 })\n  }\n}\n\nconst updateApprover = async (level, data) => {\n  try {\n    await axios.put(`/api/settings/leave-approval/${level}/${data.user_id}`, {\n      receive_email: data.receive_email,\n      can_approve: data.can_approve\n    })\n    toast.add({ severity: 'success', summary: 'สำเร็จ', detail: 'อัพเดทแล้ว', life: 2000 })\n  } catch { // ignore\n    toast.add({ severity: 'error', summary: 'ผิดพลาด', detail: 'ไม่สามารถอัพเดทได้', life: 3000 })\n  }\n}\n\nconst removeApprover = async (level, userId) => {\n  try {\n    await axios.delete(`/api/settings/leave-approval/${level}/${userId}`)\n    toast.add({ severity: 'success', summary: 'สำเร็จ', detail: 'ลบผู้อนุมัติแล้ว', life: 3000 })\n    await loadSettings()\n  } catch { // ignore\n    toast.add({ severity: 'error', summary: 'ผิดพลาด', detail: 'ไม่สามารถลบได้', life: 3000 })\n  }\n}\n\nonMounted(() => {\n  loadSettings()\n  loadUsers()\n})\n</script>\n\n<style scoped>\n.settings-container {\n  padding: 1rem;\n  padding-bottom: 0;\n  max-width: 100%;\n  margin: 0 auto;\n  background: #e5e7eb;\n  height: 100%;\n  overflow: auto;\n}\n\n.header-card {\n  background: linear-gradient(135deg, #4A90E2, #D73527);\n  color: white;\n  border: none;\n}\n\n.header-content {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n\n.back-btn {\n  color: white !important;\n}\n\n.header-title {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.header-title i {\n  font-size: 1.5rem;\n}\n\n.header-title h1 {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 600;\n}\n\n.approval-levels {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n.level-card {\n  border-radius: 12px;\n  overflow: hidden;\n}\n\n.level-header {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1rem 1.5rem;\n  color: white;\n  font-weight: 600;\n  font-size: 1.1rem;\n}\n\n.level-header i {\n  font-size: 1.25rem;\n}\n\n.level-1 {\n  background: linear-gradient(135deg, #3b82f6, #1d4ed8);\n}\n\n.level-2 {\n  background: linear-gradient(135deg, #10b981, #059669);\n}\n\n.level-desc {\n  color: #6b7280;\n  margin-bottom: 1rem;\n}\n\n.add-approver {\n  display: flex;\n  gap: 0.5rem;\n  align-items: center;\n}\n\n.add-approver .p-dropdown {\n  flex: 1;\n}\n\n@media (max-width: 768px) {\n  .add-approver {\n    flex-direction: column;\n  }\n  \n  .add-approver .p-button {\n    width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}