{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, onMounted } from 'vue';\nimport { useToast } from 'primevue/usetoast';\nimport axios from 'axios';\nexport default {\n  __name: 'LeaveManagement',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const toast = useToast();\n    const users = ref([]);\n    const saving = ref(false);\n    const showQuotaDialog = ref(false);\n    const selectedUser = ref(null);\n    onMounted(() => {\n      loadUsers();\n    });\n    const loadUsers = async () => {\n      try {\n        const token = localStorage.getItem('soc_token');\n        const [usersRes, leaveRes] = await Promise.all([axios.get('/api/users', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get('/api/leave', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n\n        // Calculate used leave days for each user\n        const leaveData = leaveRes.data;\n        users.value = usersRes.data.map(user => {\n          const userLeaves = leaveData.filter(leave => leave.user_id === user.id && leave.status === 'approved');\n          const sick_used = userLeaves.filter(l => l.leave_type === 'sick').reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0);\n          const personal_used = userLeaves.filter(l => l.leave_type === 'personal').reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0);\n          const vacation_used = userLeaves.filter(l => l.leave_type === 'vacation').reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0);\n          return {\n            ...user,\n            sick_leave_quota: user.sick_leave_quota || 30,\n            personal_leave_quota: user.personal_leave_quota || 10,\n            vacation_leave_quota: user.vacation_leave_quota || 10,\n            sick_used,\n            personal_used,\n            vacation_used\n          };\n        });\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: 'ไม่สามารถโหลดข้อมูลได้',\n          life: 3000\n        });\n      }\n    };\n    const openQuotaDialog = user => {\n      selectedUser.value = {\n        ...user\n      };\n      showQuotaDialog.value = true;\n    };\n    const saveQuota = async () => {\n      saving.value = true;\n      try {\n        const token = localStorage.getItem('soc_token');\n        await axios.put(`/api/users/${selectedUser.value.id}/leave-quota`, {\n          sick_leave_quota: selectedUser.value.sick_leave_quota,\n          personal_leave_quota: selectedUser.value.personal_leave_quota,\n          vacation_leave_quota: selectedUser.value.vacation_leave_quota\n        }, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        toast.add({\n          severity: 'success',\n          summary: 'สำเร็จ',\n          detail: 'บันทึกโควต้าการลาเรียบร้อยแล้ว',\n          life: 3000\n        });\n        showQuotaDialog.value = false;\n        loadUsers();\n      } catch (error) {\n        toast.add({\n          severity: 'error',\n          summary: 'เกิดข้อผิดพลาด',\n          detail: 'ไม่สามารถบันทึกข้อมูลได้',\n          life: 3000\n        });\n      } finally {\n        saving.value = false;\n      }\n    };\n    const __returned__ = {\n      toast,\n      users,\n      saving,\n      showQuotaDialog,\n      selectedUser,\n      loadUsers,\n      openQuotaDialog,\n      saveQuota,\n      ref,\n      onMounted,\n      get useToast() {\n        return useToast;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useToast","axios","toast","users","saving","showQuotaDialog","selectedUser","loadUsers","token","localStorage","getItem","usersRes","leaveRes","Promise","all","get","headers","Authorization","leaveData","data","value","map","user","userLeaves","filter","leave","user_id","id","status","sick_used","l","leave_type","reduce","sum","parseFloat","days","personal_used","vacation_used","sick_leave_quota","personal_leave_quota","vacation_leave_quota","error","add","severity","summary","detail","life","openQuotaDialog","saveQuota","put"],"sources":["D:/FULLACC/frontend_cem-main/src/views/management/LeaveManagement.vue"],"sourcesContent":["<template>\n  <div class=\"leave-management-container\">\n    <Toast />\n    \n    <!-- Header -->\n    <Card class=\"header-card mb-4\">\n      <template #content>\n        <div class=\"header-content\">\n          <Button icon=\"pi pi-arrow-left\" text rounded @click=\"$router.push('/management')\" class=\"back-btn\" />\n          <div class=\"header-title\">\n            <i class=\"pi pi-calendar-times\"></i>\n            <h1>จัดการการลางาน</h1>\n          </div>\n        </div>\n      </template>\n    </Card>\n\n    <!-- User Leave Quota Table -->\n    <Card>\n      <template #content>\n        <DataTable :value=\"users\" :paginator=\"true\" :rows=\"10\" stripedRows class=\"p-datatable-sm\">\n          <Column field=\"firstname\" header=\"ชื่อ\" :sortable=\"true\">\n            <template #body=\"{ data }\">\n              {{ data.firstname }} {{ data.lastname }}\n            </template>\n          </Column>\n          <Column field=\"department\" header=\"แผนก\" :sortable=\"true\" />\n          <Column field=\"position\" header=\"ตำแหน่ง\" :sortable=\"true\" />\n          <Column header=\"ลาป่วย\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>ใช้ไป: {{ data.sick_used || 0 }} วัน</small>\n                <small>คงเหลือ: {{ (data.sick_leave_quota || 30) - (data.sick_used || 0) }} วัน</small>\n              </div>\n            </template>\n          </Column>\n          <Column header=\"ลากิจ\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>ใช้ไป: {{ data.personal_used || 0 }} วัน</small>\n                <small>คงเหลือ: {{ (data.personal_leave_quota || 10) - (data.personal_used || 0) }} วัน</small>\n              </div>\n            </template>\n          </Column>\n          <Column header=\"ลาพักร้อน\" style=\"width: 150px\">\n            <template #body=\"{ data }\">\n              <div class=\"quota-cell\">\n                <small>ใช้ไป: {{ data.vacation_used || 0 }} วัน</small>\n                <small>คงเหลือ: {{ (data.vacation_leave_quota || 10) - (data.vacation_used || 0) }} วัน</small>\n              </div>\n            </template>\n          </Column>\n          <Column header=\"ตั้งค่าโควต้า\" style=\"width: 120px\">\n            <template #body=\"{ data }\">\n              <Button icon=\"pi pi-cog\" size=\"small\" @click=\"openQuotaDialog(data)\" />\n            </template>\n          </Column>\n        </DataTable>\n      </template>\n    </Card>\n\n    <!-- Quota Edit Dialog -->\n    <Dialog v-model:visible=\"showQuotaDialog\" header=\"ตั้งค่าโควต้าการลา\" :modal=\"true\" :draggable=\"false\" style=\"width: 500px\">\n      <div class=\"quota-form\" v-if=\"selectedUser\">\n        <h4>{{ selectedUser.firstname }} {{ selectedUser.lastname }}</h4>\n        <div class=\"field\">\n          <label>ลาป่วย (วัน/ปี)</label>\n          <InputNumber v-model=\"selectedUser.sick_leave_quota\" :min=\"0\" :max=\"365\" showButtons class=\"w-full\" />\n        </div>\n        <div class=\"field\">\n          <label>ลากิจ (วัน/ปี)</label>\n          <InputNumber v-model=\"selectedUser.personal_leave_quota\" :min=\"0\" :max=\"365\" showButtons class=\"w-full\" />\n        </div>\n        <div class=\"field\">\n          <label>ลาพักร้อน (วัน/ปี)</label>\n          <InputNumber v-model=\"selectedUser.vacation_leave_quota\" :min=\"0\" :max=\"365\" showButtons class=\"w-full\" />\n        </div>\n      </div>\n      <template #footer>\n        <Button label=\"ยกเลิก\" icon=\"pi pi-times\" @click=\"showQuotaDialog = false\" severity=\"secondary\" />\n        <Button label=\"บันทึก\" icon=\"pi pi-check\" @click=\"saveQuota\" :loading=\"saving\" />\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { useToast } from 'primevue/usetoast'\nimport axios from 'axios'\n\nconst toast = useToast()\nconst users = ref([])\nconst saving = ref(false)\nconst showQuotaDialog = ref(false)\nconst selectedUser = ref(null)\n\nonMounted(() => {\n  loadUsers()\n})\n\nconst loadUsers = async () => {\n  try {\n    const token = localStorage.getItem('soc_token')\n    const [usersRes, leaveRes] = await Promise.all([\n      axios.get('/api/users', {\n        headers: { Authorization: `Bearer ${token}` }\n      }),\n      axios.get('/api/leave', {\n        headers: { Authorization: `Bearer ${token}` }\n      })\n    ])\n    \n    // Calculate used leave days for each user\n    const leaveData = leaveRes.data\n    \n    users.value = usersRes.data.map(user => {\n      const userLeaves = leaveData.filter(leave => \n        leave.user_id === user.id && leave.status === 'approved'\n      )\n      \n      const sick_used = userLeaves\n        .filter(l => l.leave_type === 'sick')\n        .reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0)\n      \n      const personal_used = userLeaves\n        .filter(l => l.leave_type === 'personal')\n        .reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0)\n      \n      const vacation_used = userLeaves\n        .filter(l => l.leave_type === 'vacation')\n        .reduce((sum, l) => sum + (parseFloat(l.days) || 0), 0)\n      \n      return {\n        ...user,\n        sick_leave_quota: user.sick_leave_quota || 30,\n        personal_leave_quota: user.personal_leave_quota || 10,\n        vacation_leave_quota: user.vacation_leave_quota || 10,\n        sick_used,\n        personal_used,\n        vacation_used\n      }\n    })\n  } catch (error) {\n    toast.add({\n      severity: 'error',\n      summary: 'เกิดข้อผิดพลาด',\n      detail: 'ไม่สามารถโหลดข้อมูลได้',\n      life: 3000\n    })\n  }\n}\n\nconst openQuotaDialog = (user) => {\n  selectedUser.value = { ...user }\n  showQuotaDialog.value = true\n}\n\nconst saveQuota = async () => {\n  saving.value = true\n  try {\n    const token = localStorage.getItem('soc_token')\n    \n    await axios.put(`/api/users/${selectedUser.value.id}/leave-quota`, {\n      sick_leave_quota: selectedUser.value.sick_leave_quota,\n      personal_leave_quota: selectedUser.value.personal_leave_quota,\n      vacation_leave_quota: selectedUser.value.vacation_leave_quota\n    }, {\n      headers: { Authorization: `Bearer ${token}` }\n    })\n\n    toast.add({\n      severity: 'success',\n      summary: 'สำเร็จ',\n      detail: 'บันทึกโควต้าการลาเรียบร้อยแล้ว',\n      life: 3000\n    })\n    \n    showQuotaDialog.value = false\n    loadUsers()\n  } catch (error) {\n    toast.add({\n      severity: 'error',\n      summary: 'เกิดข้อผิดพลาด',\n      detail: 'ไม่สามารถบันทึกข้อมูลได้',\n      life: 3000\n    })\n  } finally {\n    saving.value = false\n  }\n}\n</script>\n\n<style scoped>\n.leave-management-container {\n  padding: 1rem;\n  max-width: 1400px;\n  margin: 0 auto;\n}\n\n.header-card {\n  background: linear-gradient(135deg, #4A90E2, #D73527);\n  color: white;\n  border: none;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.header-content {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n\n.back-btn {\n  color: white !important;\n}\n\n.header-title {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n}\n\n.header-title i {\n  font-size: 1.5rem;\n}\n\n.header-title h1 {\n  margin: 0;\n  font-size: 1.5rem;\n  font-weight: 600;\n}\n\n.table-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.table-header h3 {\n  margin: 0;\n  color: #2c3e50;\n}\n\n.quota-cell {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n}\n\n.quota-cell small {\n  font-size: 0.85rem;\n  color: #6c757d;\n}\n\n.quota-form {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  padding: 1rem 0;\n}\n\n.quota-form h4 {\n  margin: 0 0 1rem 0;\n  color: #2c3e50;\n}\n\n.quota-form .field {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.quota-form label {\n  font-weight: 600;\n  color: #2c3e50;\n}\n\n@media (max-width: 768px) {\n  .leave-management-container {\n    padding: 0.5rem;\n  }\n\n  .table-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 1rem;\n  }\n\n  .table-header button {\n    width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}